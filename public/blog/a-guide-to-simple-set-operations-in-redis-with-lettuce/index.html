<!DOCTYPE html>
<html lang="en-US" class="scroll-smooth dark">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>

<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>A Guide to Simple Set Operations in Redis with Lettuce</title>
<meta
  name="description"
  content="There are, as of this writing, about 15 distinct operations available to someone wanting to work with sets in redis. This article seeks to cover some of the more basic ones using a reactive lettuce client, and a follow up article will seek to deal with explaining some of the more common operations against multiple sets, rather than a single set in this case."
/>
<link rel="canonical" href="http://localhost:1313/blog/a-guide-to-simple-set-operations-in-redis-with-lettuce/" />
<link rel="robots" href="/robots.txt" />

<link rel="icon" type="image/x-icon" href="/img/nficon.png" />



<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });</script>

<link rel="stylesheet" href="http://localhost:1313/css/app.css" /></head>

  <body class="max-w-screen-md mx-auto px-2.5">
    <div class="header">
      <header class="flex flex-col sm:flex-row items-center gap-5 sm:gap-10 pt-16 py-12">
   


<div class="flex-none w-20 h-20 rounded-full overflow-hidden">
  <a href="http://localhost:1313/">
    <img
      srcset="/img/profile-picture_hu4241499301404582006.jpg 80w"
      src="/img/profile-picture.jpg"
      width="386"
      height="345"
      alt="Nick Fisher&#39;s tech blog"
    />
  </a>
</div>

  
  <div class="flex flex-col gap-5">
    <a href="http://localhost:1313/">
  <h1 id="site-title">Nick Fisher&#39;s tech blog</h1>
</a>
 
    <nav>
  <ul>
     
    
    <li>
      <a href="/" class="">
        home
      </a>
    </li>
    
    <li>
      <a href="/blog" class="">
        blog
      </a>
    </li>
    
    <li>
      <a href="/about" class="">
        about
      </a>
    </li>
    
    <li>
      <a href="/tags" class="">
        Tags
      </a>
    </li>
    
  </ul>
</nav>

  </div>
</header>

      <button class="toggle-theme" aria-label="Toggle Theme" title="Toggle Theme" onclick="toggleTheme()">
  <span class="theme-icon light"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
</svg> </span>
  <span class="theme-icon dark"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
</svg> </span>
</button>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const theme = localStorage.getItem('theme');

    if (!theme || theme === 'light') {
      setTheme('light');
    } else {
      setTheme(theme);
    }
  });

  function setTheme(theme) {
    const html = document.querySelector('html');
    localStorage.setItem('theme', theme);

    if (theme === 'light') {
      if (html.classList.contains('dark')) {
        document.querySelector('html').classList.remove('dark');
      }

      document.querySelector('.theme-icon.light').style.display = 'none';
      document.querySelector('.theme-icon.dark').style.display = 'block';
    } else {
      if (!html.classList.contains('dark')) {
        document.querySelector('html').classList.add('dark');
      }

      document.querySelector('.theme-icon.dark').style.display = 'none';
      document.querySelector('.theme-icon.light').style.display = 'block';
    }
  }

  function toggleTheme() {
    const theme = localStorage.getItem('theme');

    if (theme === 'light') {
      setTheme('dark');
    } else {
      setTheme('light');
    }
  }
</script>
    </div>
  
    <main id="content">

<article class="flex flex-col gap-10">
  <header class="flex flex-col gap-2">
    <h2 class="title-large">A Guide to Simple Set Operations in Redis with Lettuce</h2>

    <div class="meta">
      
      <time datetime="2021-04-17 08:09:37 &#43;0000 UTC" title='Sat, Apr 17, 2021, 8:09 AM UTC'>
        17/04/2021 - Estimated reading time: 3 minutes
      </time>

       
      
    </div>
  </header>

  

  <section><p>There are, as of this writing, about <a href="https://redis.io/commands/#set">15 distinct operations available to someone wanting to work with sets in redis</a>. This article seeks to cover some of the more basic ones using a reactive lettuce client, and <a href="https://nickolasfisher.com/blog/A-Guide-to-Operating-on-Multiple-Sets-in-Redis-with-Lettuce">a follow up article</a> will seek to deal with explaining some of the more common operations against multiple sets, rather than a single set in this case.</p>
<p>To start with, you'll want to make sure that you have either <a href="https://nickolasfisher.com/blog/How-to-use-a-Redis-Test-Container-with-LettuceSpring-Boot-Webflux">setup a redis test container for a lettuce client</a> or <a href="https://nickolasfisher.com/blog/How-to-use-Embedded-Redis-to-Test-a-Lettuce-Client-in-Spring-Boot-Webflux">setup embedded redis for a lettuce client</a>, which will make this article much easier to follow along with. The source code for what follows <a href="https://github.com/nfisher23/reactive-programming-webflux">can be found on Github</a>.</p>
<h3 id="sadd-smembers-srem">sadd, smembers, srem</h3>
<p>The first thing we'll cover is adding elements to a set, viewing the members in that set, and removing elements from that set.</p>
<p><strong>sadd</strong> adds elements to a set only if they don't already exist, and returns the number of elements in a set that were added, <strong>smembers</strong> returns all the elements, and <strong>srem</strong> removes elements only if they exist, returning the number that was removed:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    @Test
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">sAdd_and_sRem</span>() {
</span></span><span style="display:flex;"><span>        String setKey <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">&amp;</span>#34;set<span style="color:#ff79c6">-</span>key<span style="color:#ff79c6">-</span>1<span style="color:#ff79c6">&amp;</span>#34;;
</span></span><span style="display:flex;"><span>        Mono<span style="color:#ff79c6">&amp;</span>lt;Long<span style="color:#ff79c6">&amp;</span>gt; saddMono <span style="color:#ff79c6">=</span> redisReactiveCommands.<span style="color:#50fa7b">sadd</span>(setKey, <span style="color:#ff79c6">&amp;</span>#34;value<span style="color:#ff79c6">-</span>1<span style="color:#ff79c6">&amp;</span>#34;, <span style="color:#ff79c6">&amp;</span>#34;value<span style="color:#ff79c6">-</span>2<span style="color:#ff79c6">&amp;</span>#34;);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        StepVerifier.<span style="color:#50fa7b">create</span>(saddMono)
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">expectNextMatches</span>(numberOfElementsAdded <span style="color:#ff79c6">-&amp;</span>gt; 2L <span style="color:#ff79c6">==</span> numberOfElementsAdded)
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">verifyComplete</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Mono<span style="color:#ff79c6">&amp;</span>lt;Long<span style="color:#ff79c6">&amp;</span>gt; saddOneRepeatingValueMono <span style="color:#ff79c6">=</span> redisReactiveCommands.<span style="color:#50fa7b">sadd</span>(setKey, <span style="color:#ff79c6">&amp;</span>#34;value<span style="color:#ff79c6">-</span>1<span style="color:#ff79c6">&amp;</span>#34;, <span style="color:#ff79c6">&amp;</span>#34;value<span style="color:#ff79c6">-</span>3<span style="color:#ff79c6">&amp;</span>#34;);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        StepVerifier.<span style="color:#50fa7b">create</span>(saddOneRepeatingValueMono)
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">expectNextMatches</span>(numberOfElementsAdded <span style="color:#ff79c6">-&amp;</span>gt; 1L <span style="color:#ff79c6">==</span> numberOfElementsAdded)
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">verifyComplete</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Mono<span style="color:#ff79c6">&amp;</span>lt;List<span style="color:#ff79c6">&amp;</span>lt;String<span style="color:#ff79c6">&amp;</span>gt;<span style="color:#ff79c6">&amp;</span>gt; smembersCollectionMono <span style="color:#ff79c6">=</span> redisReactiveCommands.<span style="color:#50fa7b">smembers</span>(setKey).<span style="color:#50fa7b">collectList</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        StepVerifier.<span style="color:#50fa7b">create</span>(smembersCollectionMono)
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">expectNextMatches</span>(setMembers <span style="color:#ff79c6">-&amp;</span>gt; setMembers.<span style="color:#50fa7b">size</span>() <span style="color:#ff79c6">==</span> 3 <span style="color:#ff79c6">&amp;</span>amp;<span style="color:#ff79c6">&amp;</span>amp; setMembers.<span style="color:#50fa7b">contains</span>(<span style="color:#ff79c6">&amp;</span>#34;value<span style="color:#ff79c6">-</span>3<span style="color:#ff79c6">&amp;</span>#34;))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">verifyComplete</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Mono<span style="color:#ff79c6">&amp;</span>lt;Long<span style="color:#ff79c6">&amp;</span>gt; sremValue3Mono <span style="color:#ff79c6">=</span> redisReactiveCommands.<span style="color:#50fa7b">srem</span>(setKey, <span style="color:#ff79c6">&amp;</span>#34;value<span style="color:#ff79c6">-</span>3<span style="color:#ff79c6">&amp;</span>#34;);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        StepVerifier.<span style="color:#50fa7b">create</span>(sremValue3Mono)
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">expectNextMatches</span>(numRemoved <span style="color:#ff79c6">-&amp;</span>gt; numRemoved <span style="color:#ff79c6">==</span> 1L)
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">verifyComplete</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        StepVerifier.<span style="color:#50fa7b">create</span>(smembersCollectionMono)
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">expectNextMatches</span>(setMembers <span style="color:#ff79c6">-&amp;</span>gt; setMembers.<span style="color:#50fa7b">size</span>() <span style="color:#ff79c6">==</span> 2 <span style="color:#ff79c6">&amp;</span>amp;<span style="color:#ff79c6">&amp;</span>amp; <span style="color:#ff79c6">!</span>setMembers.<span style="color:#50fa7b">contains</span>(<span style="color:#ff79c6">&amp;</span>#34;value<span style="color:#ff79c6">-</span>3<span style="color:#ff79c6">&amp;</span>#34;));
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>This code is pretty straightforward, we're adding an element that already exists [&quot;value-1&quot;] and one that doesn't [&quot;value-3&quot;] in the original set, so we see 1 element added in the response. We then view the members, remove an element [&quot;value-3&quot;], then view the members again. We make assertions every step of that way and this test passes those assertions.</p>
<h3 id="sismember">sismember</h3>
<p>Another operation you're likely to care quite a bit about is <strong>sismember</strong>. This operation tells you whether an element exists in the set and is an O[1] operation:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    @Test
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">sisMember</span>() {
</span></span><span style="display:flex;"><span>        String setKey <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">&amp;</span>#34;set<span style="color:#ff79c6">-</span>key<span style="color:#ff79c6">-</span>1<span style="color:#ff79c6">&amp;</span>#34;;
</span></span><span style="display:flex;"><span>        Mono<span style="color:#ff79c6">&amp;</span>lt;Long<span style="color:#ff79c6">&amp;</span>gt; saddMono <span style="color:#ff79c6">=</span> redisReactiveCommands.<span style="color:#50fa7b">sadd</span>(setKey, <span style="color:#ff79c6">&amp;</span>#34;value<span style="color:#ff79c6">-</span>1<span style="color:#ff79c6">&amp;</span>#34;, <span style="color:#ff79c6">&amp;</span>#34;value<span style="color:#ff79c6">-</span>2<span style="color:#ff79c6">&amp;</span>#34;);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        StepVerifier.<span style="color:#50fa7b">create</span>(saddMono)
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">expectNextMatches</span>(numberOfElementsAdded <span style="color:#ff79c6">-&amp;</span>gt; 2L <span style="color:#ff79c6">==</span> numberOfElementsAdded)
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">verifyComplete</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Mono<span style="color:#ff79c6">&amp;</span>lt;Boolean<span style="color:#ff79c6">&amp;</span>gt; shouldNotExistInSetMono <span style="color:#ff79c6">=</span> redisReactiveCommands.<span style="color:#50fa7b">sismember</span>(setKey, <span style="color:#ff79c6">&amp;</span>#34;value<span style="color:#ff79c6">-</span>3<span style="color:#ff79c6">&amp;</span>#34;);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        StepVerifier.<span style="color:#50fa7b">create</span>(shouldNotExistInSetMono)
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">expectNext</span>(<span style="color:#ff79c6">false</span>)
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">verifyComplete</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Mono<span style="color:#ff79c6">&amp;</span>lt;Boolean<span style="color:#ff79c6">&amp;</span>gt; shouldExistInSetMono <span style="color:#ff79c6">=</span> redisReactiveCommands.<span style="color:#50fa7b">sismember</span>(setKey, <span style="color:#ff79c6">&amp;</span>#34;value<span style="color:#ff79c6">-</span>2<span style="color:#ff79c6">&amp;</span>#34;);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        StepVerifier.<span style="color:#50fa7b">create</span>(shouldExistInSetMono)
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">expectNext</span>(<span style="color:#ff79c6">true</span>)
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">verifyComplete</span>();
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>Here we add two elements to a set to start with [&quot;value-1&quot; and &quot;value-2&quot;], then verify that using <strong>sismember</strong> does indeed verify that an element not in the set returns <strong>false</strong>, then an element that is actually in the set returns <strong>true</strong>.</p>
<p>And with that, you should be good to go.</p>
</section>

  
    
  

    
  


  <footer>
    
      <div class="pb-14 taxonomy-list tags-list">
      
        <a href="/tags/java/" alt="Java">
          Java
        </a>
      
        <a href="/tags/spring/" alt="Spring">
          Spring
        </a>
      
        <a href="/tags/reactive/" alt="Reactive">
          Reactive
        </a>
      
        <a href="/tags/webflux/" alt="Webflux">
          Webflux
        </a>
      
        <a href="/tags/lettuce/" alt="Lettuce">
          Lettuce
        </a>
      
        <a href="/tags/redis/" alt="Redis">
          Redis
        </a>
      
      </div>
    
  </footer>
</article>


    </main><footer class="pt-5 pb-10 grid gap-3 sm:grid-cols-2">
    <div class="text-xs font-semibold text-gray-500 order-2 sm:order-1">
  © 2018-2025 —
  <a href="http://localhost:1313/">Nick Fisher&#39;s tech blog</a> 
</div>

    <div class="order-1 sm:order-2">
  <ul class="flex sm:justify-end gap-5">
    
    
    <li>    
      <a href="https://www.linkedin.com/in/nick-fisher-software/" target="_blank" rel="noopener noreferrer">LinkedIn</a>
    </li>
    
    <li>    
      <a href="https://github.com/nfisher23" target="_blank" rel="noopener noreferrer">GitHub</a>
    </li>
    
    
  </ul>
</div>

</footer></body>
</html>
