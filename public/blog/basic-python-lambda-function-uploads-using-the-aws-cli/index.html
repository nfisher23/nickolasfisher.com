<!DOCTYPE html>
<html lang="en-US" class="scroll-smooth dark">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>

<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Basic Python Lambda Function Uploads using the AWS CLI</title>
<meta
  name="description"
  content="AWS Lambda functions were the first &quot;serverless&quot; way to run code. Of course, there are still servers, but the point is that you can nearly forget about managing those servers and all of that is owned by AWS."
/>
<link rel="canonical" href="http://localhost:1313/blog/basic-python-lambda-function-uploads-using-the-aws-cli/" />
<link rel="robots" href="/robots.txt" />

<link rel="icon" type="image/x-icon" href="/icons/favicon.ico" />



<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });</script>

<link rel="stylesheet" href="http://localhost:1313/css/app.css" /></head>

  <body class="max-w-screen-md mx-auto px-2.5">
    <div class="header">
      <header class="flex flex-col sm:flex-row items-center gap-5 sm:gap-10 pt-16 py-12">
   


<div class="flex-none w-20 h-20 rounded-full overflow-hidden">
  <a href="http://localhost:1313/">
    <img
      srcset="/img/profile-picture_hu4241499301404582006.jpg 80w"
      src="/img/profile-picture.jpg"
      width="386"
      height="345"
      alt="Nick Fisher&#39;s tech blog"
    />
  </a>
</div>

  
  <div class="flex flex-col gap-5">
    <a href="http://localhost:1313/">
  <h1 id="site-title">Nick Fisher&#39;s tech blog</h1>
</a>
 
    <nav>
  <ul>
     
    
    <li>
      <a href="/" class="">
        Home
      </a>
    </li>
    
    <li>
      <a href="/blog" class="">
        Blog
      </a>
    </li>
    
    <li>
      <a href="/about" class="">
        About me
      </a>
    </li>
    
    <li>
      <a href="/categories" class="">
        Categories
      </a>
    </li>
    
    <li>
      <a href="/tags" class="">
        Tags
      </a>
    </li>
    
  </ul>
</nav>

  </div>
</header>

      <button class="toggle-theme" aria-label="Toggle Theme" title="Toggle Theme" onclick="toggleTheme()">
  <span class="theme-icon light"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
</svg> </span>
  <span class="theme-icon dark"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
</svg> </span>
</button>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const theme = localStorage.getItem('theme');

    if (!theme || theme === 'light') {
      setTheme('light');
    } else {
      setTheme(theme);
    }
  });

  function setTheme(theme) {
    const html = document.querySelector('html');
    localStorage.setItem('theme', theme);

    if (theme === 'light') {
      if (html.classList.contains('dark')) {
        document.querySelector('html').classList.remove('dark');
      }

      document.querySelector('.theme-icon.light').style.display = 'none';
      document.querySelector('.theme-icon.dark').style.display = 'block';
    } else {
      if (!html.classList.contains('dark')) {
        document.querySelector('html').classList.add('dark');
      }

      document.querySelector('.theme-icon.dark').style.display = 'none';
      document.querySelector('.theme-icon.light').style.display = 'block';
    }
  }

  function toggleTheme() {
    const theme = localStorage.getItem('theme');

    if (theme === 'light') {
      setTheme('dark');
    } else {
      setTheme('light');
    }
  }
</script>
    </div>
  
    <main id="content">

<article class="flex flex-col gap-10">
  <header class="flex flex-col gap-2">
    <h2 class="title-large">Basic Python Lambda Function Uploads using the AWS CLI</h2>

    <div class="meta">
      
      <time datetime="2021-02-01 00:00:00 &#43;0000 UTC" title='Mon, Feb 1, 2021, 12:00 AM UTC'>
        01/02/2021 - Estimated reading time: 2 minutes
      </time>

       
      
    </div>
  </header>

  

  <section><p>AWS Lambda functions were the first &quot;serverless&quot; way to run code. Of course, there are still servers, but the point is that you can nearly forget about managing those servers and all of that is owned by AWS.</p>
<p>Lambda functions are called functions because that's literally what you upload to AWS: a function that takes an <strong>event</strong> and <strong>context</strong>. The event will just be a JSON representation of something that happens on the system [the structure of the event depends on what is invoking the lambda function], and the context contains a bunch of metadata about the invocation that you usually don't really care about.</p>
<p>A simple lambda function [that we'll be using in this article] could look like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#ff79c6">import</span> logging
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> math
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">import</span> json
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>logger <span style="color:#ff79c6">=</span> logging<span style="color:#ff79c6">.</span>getLogger()
</span></span><span style="display:flex;"><span>logger<span style="color:#ff79c6">.</span>setLevel(logging<span style="color:#ff79c6">.</span>INFO)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">def</span> <span style="color:#50fa7b">lambda_handler</span>(event, context):
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&amp;</span><span style="color:#6272a4">#34;&amp;#34;&amp;#34;</span>
</span></span><span style="display:flex;"><span>    Politely respond <span style="color:#ff79c6">with</span> the same event
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">&amp;</span><span style="color:#6272a4">#34;&amp;#34;&amp;#34;</span>
</span></span><span style="display:flex;"><span>    logger<span style="color:#ff79c6">.</span>info(<span style="color:#ff79c6">&amp;</span><span style="color:#6272a4">#39;Event: %s&amp;#39;, event)</span>
</span></span><span style="display:flex;"><span>    logger<span style="color:#ff79c6">.</span>info(<span style="color:#ff79c6">&amp;</span><span style="color:#6272a4">#39;context: %s&amp;#39;, context.__dict__)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    event[<span style="color:#ff79c6">&amp;</span><span style="color:#6272a4">#39;hello&amp;#39;] = &amp;#34;well hello there&amp;#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> event
</span></span></code></pre></div><p>This function just logs the event and context, then adds a &quot;hello&quot; key to the event before echo-ing it back to whatever invokes it.</p>
<h2 id="setup-localstack">Setup Localstack</h2>
<p>Because it's much simpler to get started with [no need to create an AWS account] and because I don't want you spending money accidentally, we're going to use <a href="https://github.com/localstack/localstack">localstack</a> to mock out our AWS interactions. Localstack supports lambdas in a variety of use cases quite well.</p>
<p>To setup your localstack infrastructure, which we'll just run as a container on your machine, you'll want docker and docker-compose installed. Then you can use this <strong>docker-compose.yaml</strong>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ff79c6">version</span>: <span style="color:#ff79c6">&amp;#39;2.1&amp;#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">services</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">localstack</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">container_name</span>: <span style="color:#ff79c6">&amp;#34;${LOCALSTACK_DOCKER_NAME-localstack_main}&amp;#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">image</span>: localstack/localstack
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">ports</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ff79c6">&amp;#34;4566-4599:4566-4599&amp;#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ff79c6">&amp;#34;${PORT_WEB_UI-8080}:${PORT_WEB_UI-8080}&amp;#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">environment</span>:
</span></span><span style="display:flex;"><span>      - SERVICES=${SERVICES- }
</span></span><span style="display:flex;"><span>      - DEBUG=${DEBUG- }
</span></span><span style="display:flex;"><span>      - DATA_DIR=${DATA_DIR- }
</span></span><span style="display:flex;"><span>      - PORT_WEB_UI=${PORT_WEB_UI- }
</span></span><span style="display:flex;"><span>      - LAMBDA_EXECUTOR=${LAMBDA_EXECUTOR- }
</span></span><span style="display:flex;"><span>      - KINESIS_ERROR_PROBABILITY=${KINESIS_ERROR_PROBABILITY- }
</span></span><span style="display:flex;"><span>      - DOCKER_HOST=unix:///var/run/docker.sock
</span></span><span style="display:flex;"><span>      - HOST_TMP_FOLDER=${TMPDIR}
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">volumes</span>:
</span></span><span style="display:flex;"><span>      - <span style="color:#ff79c6">&amp;#34;${TMPDIR:-/tmp/localstack}:/tmp/localstack&amp;#34;</span>
</span></span><span style="display:flex;"><span>      - <span style="color:#ff79c6">&amp;#34;/var/run/docker.sock:/var/run/docker.sock&amp;#34;</span>
</span></span></code></pre></div><p>Then simply navigate to where you've placed the file in your filesystem and run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ docker-compose up
</span></span></code></pre></div><h2 id="deploy-and-run-our-python-lambda-function">Deploy and run our Python Lambda Function</h2>
<p>To actually start using our lambda function now that we have our infrastructure and code ready, we will first need to create an IAM role to run the lambda, then attach a policy to that role to allow it to operate as a lambda. We could optionally create our own policy, but AWS has a bunch of policies ready for us to already use, and for this article we'll just reuse it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"></code></pre></div></section>

  
    
  

    
  


  <footer>
    
  </footer>
</article>


    </main><footer class="pt-5 pb-10 grid gap-3 sm:grid-cols-2">
    <div class="text-xs font-semibold text-gray-500 order-2 sm:order-1">
  © 2018-2025 —
  <a href="http://localhost:1313/">Nick Fisher&#39;s tech blog</a> 
</div>

    <div class="order-1 sm:order-2">
  <ul class="flex sm:justify-end gap-5">
    
    
    <li>    
      <a href="https://www.linkedin.com/in/nick-fisher-software/" target="_blank" rel="noopener noreferrer">LinkedIn</a>
    </li>
    
    <li>    
      <a href="https://github.com/nfisher23" target="_blank" rel="noopener noreferrer">GitHub</a>
    </li>
    
    
  </ul>
</div>

</footer></body>
</html>
