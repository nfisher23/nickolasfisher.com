<!doctype html><html lang=en-US class="scroll-smooth dark"><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>DynamoDB Streams and Python: A Working Introduction</title>
<meta name=description content="DynamoDB Streams is AWS&rsquo;s home grown Change Data Capture [CDC] mechanism, which allows the consumer of the stream to see records probably in approximately the order they were created [it&rsquo;s basically impossible, at scale, to guarantee that all records across all partitions will somehow stream the data in exactly the same order that it was written]. This is a pretty fantastic feature because it allows us to reliably do &mdash;something&mdash; after we add new data, update existing data, or delete existing data. As long as all the stream records are read and processed, we can ensure at least once processing on data changes and then go sleep soundly at night knowing that there is one less edge case in our application. Combine that with the natural scale that DynamoDB provides via its leaderless architecture and you can build this thing once and probably never have to worry about it handling more load ever again."><link rel=canonical href=https://www.nickolasfisher.com/blog/dynamodb-streams-and-python-a-working-introduction/><link rel=robots href=/robots.txt><link rel=icon type=image/x-icon href=/img/nficon.png><script type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type=text/x-mathjax-config>MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });</script><link rel=stylesheet href="https://www.nickolasfisher.com/css/app.min.dee9c4afb37cb95c5d39c976614ef6f95398bcba4b6e73066c44de2a3a6543ed.css"></head><body class="max-w-screen-md mx-auto px-2.5"><div class=header><header class="flex flex-col sm:flex-row items-center gap-5 sm:gap-10 pt-16 py-12"><div class="flex-none w-20 h-20 rounded-full overflow-hidden"><a href=https://www.nickolasfisher.com/><img srcset="/img/profile-picture_hu4241499301404582006.jpg 80w" src=/img/profile-picture.jpg width=386 height=345 alt="Nick Fisher's tech blog"></a></div><div class="flex flex-col gap-5"><a href=https://www.nickolasfisher.com/><h1 id=site-title>Nick Fisher's tech blog</h1></a><nav><ul><li><a href=/>home</a></li><li><a href=/blog>blog</a></li><li><a href=/about>about</a></li><li><a href=/tags>Tags</a></li></ul></nav></div></header><button class=toggle-theme aria-label="Toggle Theme" title="Toggle Theme" onclick=toggleTheme()>
<span class="theme-icon light"><svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75.0 11-7.5.0 3.75 3.75.0 017.5.0z"/></svg> </span><span class="theme-icon dark"><svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718.0 0118 15.75c-5.385.0-9.75-4.365-9.75-9.75.0-1.33.266-2.597.748-3.752A9.753 9.753.0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753.0 009.002-5.998z"/></svg> </span></button>
<script>document.addEventListener("DOMContentLoaded",function(){const e=localStorage.getItem("theme");setTheme(!e||e==="light"?"light":e)});function setTheme(e){const t=document.querySelector("html");localStorage.setItem("theme",e),e==="light"?(t.classList.contains("dark")&&document.querySelector("html").classList.remove("dark"),document.querySelector(".theme-icon.light").style.display="none",document.querySelector(".theme-icon.dark").style.display="block"):(t.classList.contains("dark")||document.querySelector("html").classList.add("dark"),document.querySelector(".theme-icon.dark").style.display="none",document.querySelector(".theme-icon.light").style.display="block")}function toggleTheme(){const e=localStorage.getItem("theme");setTheme(e==="light"?"dark":"light")}</script></div><main id=content><article class="flex flex-col gap-10"><header class="flex flex-col gap-2"><h2 class=title-large>DynamoDB Streams and Python: A Working Introduction</h2><div class=meta><time datetime="2020-07-26 21:54:59 +0000 UTC" title='Sun, Jul 26, 2020, 9:54 PM UTC'>26/07/2020 - Estimated reading time: 4 minutes</time></div></header><section><p>DynamoDB Streams is AWS&rsquo;s home grown <a href=https://en.wikipedia.org/wiki/Change_data_capture>Change Data Capture [CDC]</a> mechanism, which allows the consumer of the stream to see records probably in approximately the order they were created [it&rsquo;s basically impossible, at scale, to guarantee that all records across all partitions will somehow stream the data in exactly the same order that it was written]. This is a pretty fantastic feature because it allows us to reliably do <em>&mdash;something&mdash;</em> after we add new data, update existing data, or delete existing data. As long as all the stream records are read and processed, we can ensure at least once processing on data changes and then go sleep soundly at night knowing that there is one less edge case in our application. Combine that with the natural scale that DynamoDB provides via its leaderless architecture and you can build this thing once and probably never have to worry about it handling more load ever again.</p><p>This post is basically a hands on introduction to streams, using a bit of bash and python to read through stream records in our local environment. No AWS infrastructure or fear of a high bill required.</p><h2 id=local-dynamodb-and-data-setup>Local DynamoDB And Data Setup</h2><p>Start by setting up a local dynamo container. I&rsquo;m going to use docker compose [ <strong>docker-compose.yml</strong>]:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#ff79c6>version</span>: <span style=color:#f1fa8c>&#39;3.7&#39;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>dynamodb-local</span>:
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>image</span>: amazon/dynamodb-local
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>container_name</span>: dynamodb-local
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#f1fa8c>&#34;8000:8000&#34;</span>
</span></span></code></pre></div><p>You can start up the container now with:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker-compose up -d
</span></span></code></pre></div><p>Now I&rsquo;m going to use the AWS CLI to set up some data, creating our familiar Phones table [with streams enabled! Writing only the key to the stream in this case] and inserting some also familiar data:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>aws --endpoint-url http://localhost:8000 --region<span style=color:#ff79c6>=</span>us-west-2 dynamodb create-table <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>  --billing-mode PAY_PER_REQUEST <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>  --table-name Phones <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>  --attribute-definitions <span style=color:#8be9fd;font-style:italic>AttributeName</span><span style=color:#ff79c6>=</span>Company,AttributeType<span style=color:#ff79c6>=</span>S <span style=color:#8be9fd;font-style:italic>AttributeName</span><span style=color:#ff79c6>=</span>Model,AttributeType<span style=color:#ff79c6>=</span>S <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>  --key-schema <span style=color:#8be9fd;font-style:italic>AttributeName</span><span style=color:#ff79c6>=</span>Company,KeyType<span style=color:#ff79c6>=</span>HASH <span style=color:#8be9fd;font-style:italic>AttributeName</span><span style=color:#ff79c6>=</span>Model,KeyType<span style=color:#ff79c6>=</span>RANGE <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>  --stream-specification <span style=color:#8be9fd;font-style:italic>StreamEnabled</span><span style=color:#ff79c6>=</span>true,StreamViewType<span style=color:#ff79c6>=</span>KEYS_ONLY
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>TEMPLATE</span><span style=color:#ff79c6>=</span><span style=color:#ff79c6>$(</span>cat <span style=color:#f1fa8c>&lt;&lt;&#39;EOF&#39;
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>{
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    &#34;Company&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        &#34;S&#34;: &#34;%s&#34;
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    },
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    &#34;Model&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        &#34;S&#34;: &#34;%s&#34;
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    },
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    &#34;Colors&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        &#34;SS&#34;: [
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>            &#34;Green&#34;,
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>            &#34;Blue&#34;,
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>            &#34;Orange&#34;
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        ]
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    },
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    &#34;Size&#34;: {
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>        &#34;N&#34;: &#34;%s&#34;
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>    }
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>}
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c>EOF</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>put_dynamo_local<span style=color:#ff79c6>()</span> <span style=color:#ff79c6>{</span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>ITEM</span><span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;</span><span style=color:#8be9fd;font-style:italic>$1</span><span style=color:#f1fa8c>&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4># echo $ITEM = json_pp</span>
</span></span><span style=display:flex><span>    <span style=color:#6272a4># return 0</span>
</span></span><span style=display:flex><span>    aws --endpoint-url http://localhost:8000 --region<span style=color:#ff79c6>=</span>us-west-2 dynamodb put-item <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>      --table-name Phones <span style=color:#f1fa8c>\
</span></span></span><span style=display:flex><span><span style=color:#f1fa8c></span>      --item <span style=color:#f1fa8c>&#34;</span><span style=color:#8be9fd;font-style:italic>$ITEM</span><span style=color:#f1fa8c>&#34;</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>MOTO_COOL</span><span style=color:#ff79c6>=</span><span style=color:#ff79c6>$(</span><span style=color:#8be9fd;font-style:italic>printf</span> <span style=color:#f1fa8c>&#34;</span><span style=color:#8be9fd;font-style:italic>$TEMPLATE</span><span style=color:#f1fa8c>&#34;</span> <span style=color:#f1fa8c>&#34;Motorola&#34;</span> <span style=color:#f1fa8c>&#34;Cool Phone&#34;</span> <span style=color:#f1fa8c>&#34;12&#34;</span><span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>MOTO_LAME</span><span style=color:#ff79c6>=</span><span style=color:#ff79c6>$(</span><span style=color:#8be9fd;font-style:italic>printf</span> <span style=color:#f1fa8c>&#34;</span><span style=color:#8be9fd;font-style:italic>$TEMPLATE</span><span style=color:#f1fa8c>&#34;</span> <span style=color:#f1fa8c>&#34;Motorola&#34;</span> <span style=color:#f1fa8c>&#34;Lame Phone&#34;</span> <span style=color:#f1fa8c>&#34;9&#34;</span><span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>GOOGL_NICE</span><span style=color:#ff79c6>=</span><span style=color:#ff79c6>$(</span><span style=color:#8be9fd;font-style:italic>printf</span> <span style=color:#f1fa8c>&#34;</span><span style=color:#8be9fd;font-style:italic>$TEMPLATE</span><span style=color:#f1fa8c>&#34;</span> <span style=color:#f1fa8c>&#34;Goole&#34;</span> <span style=color:#f1fa8c>&#34;Awesome Phone&#34;</span> <span style=color:#f1fa8c>&#34;8&#34;</span><span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>GOOGL_MEAN</span><span style=color:#ff79c6>=</span><span style=color:#ff79c6>$(</span><span style=color:#8be9fd;font-style:italic>printf</span> <span style=color:#f1fa8c>&#34;</span><span style=color:#8be9fd;font-style:italic>$TEMPLATE</span><span style=color:#f1fa8c>&#34;</span> <span style=color:#f1fa8c>&#34;Google&#34;</span> <span style=color:#f1fa8c>&#34;Confusing Phone&#34;</span> <span style=color:#f1fa8c>&#34;18&#34;</span><span style=color:#ff79c6>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>put_dynamo_local <span style=color:#f1fa8c>&#34;</span><span style=color:#8be9fd;font-style:italic>$MOTO_COOL</span><span style=color:#f1fa8c>&#34;</span>
</span></span><span style=display:flex><span>put_dynamo_local <span style=color:#f1fa8c>&#34;</span><span style=color:#8be9fd;font-style:italic>$MOTO_LAME</span><span style=color:#f1fa8c>&#34;</span>
</span></span><span style=display:flex><span>put_dynamo_local <span style=color:#f1fa8c>&#34;</span><span style=color:#8be9fd;font-style:italic>$GOOGL_NICE</span><span style=color:#f1fa8c>&#34;</span>
</span></span><span style=display:flex><span>put_dynamo_local <span style=color:#f1fa8c>&#34;</span><span style=color:#8be9fd;font-style:italic>$GOOGL_MEAN</span><span style=color:#f1fa8c>&#34;</span>
</span></span></code></pre></div><p>At this point, we have four items in our table and the data setup is complete. You can refer to <a href=https://nickolasfisher.com/blog/DynamoDB-Basics-A-Hands-On-Tutorial>a previous post on introducing DynamoDB</a> that goes into a bit more detail on how that code works if that helps you along.</p><h2 id=a-python-script-to-process-it>A Python Script to Process It</h2><p>Now that we have data, let&rsquo;s figure out how to process it.</p><p>I elected to use python3 and the <a href=https://boto3.amazonaws.com/v1/documentation/api/latest/index.html>AWS SDK for python</a> to actually process the stream records. There are a few key things to mention:</p><ul><li>There are two different types of boto3 &ldquo;client&rdquo; that we care about here: <a href=https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/dynamodb.html>DynamoDB</a> and <a href=https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/dynamodbstreams.html>DynamoDBStreams</a>. In this case I used the dynamoDB client to get enough information to start using the appropriate stream via its ARN.</li><li>The concept of a Stream shard is important: Each &ldquo;shard&rdquo; is like a group of stream records and let&rsquo;s you iterate through them in whatever order you want [e.g. start at the latest record, start at the earliest record, start at the first record after xxx, whatever]. You can only read stream records from a shard.</li></ul><p>I also just use a wrapper class around boto3 to make my life a little easier, here&rsquo;s the code:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#ff79c6>import</span> boto3
</span></span><span style=display:flex><span><span style=color:#ff79c6>import</span> json
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>def</span> <span style=color:#50fa7b>get_local_client</span>(resource_name):
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> boto3<span style=color:#ff79c6>.</span>client(resource_name,
</span></span><span style=display:flex><span>                        aws_access_key_id<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;FAKE&#34;</span>,
</span></span><span style=display:flex><span>                        aws_secret_access_key<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#34;FAKE&#34;</span>,
</span></span><span style=display:flex><span>                        endpoint_url<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;http://localhost:8000&#39;</span>,
</span></span><span style=display:flex><span>                        region_name<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;us-west-2&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>class</span> <span style=color:#50fa7b>BotoWrapper</span>(<span style=color:#8be9fd;font-style:italic>object</span>):
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>def</span> __init__(self):
</span></span><span style=display:flex><span>        self<span style=color:#ff79c6>.</span>local_dynamodb_client <span style=color:#ff79c6>=</span> get_local_client(<span style=color:#f1fa8c>&#39;dynamodb&#39;</span>)
</span></span><span style=display:flex><span>        self<span style=color:#ff79c6>.</span>local_dynamodb_streams_client <span style=color:#ff79c6>=</span> get_local_client(<span style=color:#f1fa8c>&#39;dynamodbstreams&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>def</span> <span style=color:#50fa7b>get_stream_arn</span>(self):
</span></span><span style=display:flex><span>        describe_table_response <span style=color:#ff79c6>=</span> self<span style=color:#ff79c6>.</span>local_dynamodb_client<span style=color:#ff79c6>.</span>describe_table(TableName<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;Phones&#39;</span>)
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> describe_table_response[<span style=color:#f1fa8c>&#39;Table&#39;</span>][<span style=color:#f1fa8c>&#39;LatestStreamArn&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>def</span> <span style=color:#50fa7b>get_shard_object_array</span>(self, stream_arn):
</span></span><span style=display:flex><span>        describe_stream_response <span style=color:#ff79c6>=</span> self<span style=color:#ff79c6>.</span>local_dynamodb_streams_client<span style=color:#ff79c6>.</span>describe_stream(StreamArn<span style=color:#ff79c6>=</span>stream_arn)
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> describe_stream_response[<span style=color:#f1fa8c>&#39;StreamDescription&#39;</span>][<span style=color:#f1fa8c>&#39;Shards&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>def</span> <span style=color:#50fa7b>get_data_from_shard</span>(self, shard_iterator):
</span></span><span style=display:flex><span>        records_in_response <span style=color:#ff79c6>=</span> self<span style=color:#ff79c6>.</span>local_dynamodb_streams_client<span style=color:#ff79c6>.</span>get_records(ShardIterator<span style=color:#ff79c6>=</span>shard_iterator, Limit<span style=color:#ff79c6>=</span><span style=color:#bd93f9>1000</span>)
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> records_in_response[<span style=color:#f1fa8c>&#39;Records&#39;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>def</span> <span style=color:#50fa7b>run_example</span>(self):
</span></span><span style=display:flex><span>        stream_arn <span style=color:#ff79c6>=</span> self<span style=color:#ff79c6>.</span>get_stream_arn()
</span></span><span style=display:flex><span>        shards <span style=color:#ff79c6>=</span> self<span style=color:#ff79c6>.</span>get_shard_object_array(stream_arn)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>for</span> shard <span style=color:#ff79c6>in</span> shards:
</span></span><span style=display:flex><span>            iterator <span style=color:#ff79c6>=</span> self<span style=color:#ff79c6>.</span>local_dynamodb_streams_client<span style=color:#ff79c6>.</span>get_shard_iterator(
</span></span><span style=display:flex><span>                StreamArn<span style=color:#ff79c6>=</span>stream_arn,
</span></span><span style=display:flex><span>                ShardId<span style=color:#ff79c6>=</span>shard[<span style=color:#f1fa8c>&#39;ShardId&#39;</span>],
</span></span><span style=display:flex><span>                ShardIteratorType<span style=color:#ff79c6>=</span><span style=color:#f1fa8c>&#39;TRIM_HORIZON&#39;</span>
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>            records <span style=color:#ff79c6>=</span> self<span style=color:#ff79c6>.</span>get_data_from_shard(iterator[<span style=color:#f1fa8c>&#39;ShardIterator&#39;</span>])
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>for</span> record <span style=color:#ff79c6>in</span> records:
</span></span><span style=display:flex><span>                <span style=color:#8be9fd;font-style:italic>print</span>(<span style=color:#f1fa8c>&#34;####  DYNAMO RECORD  ####&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#8be9fd;font-style:italic>print</span>(<span style=color:#f1fa8c>&#34;&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#8be9fd;font-style:italic>print</span>(json<span style=color:#ff79c6>.</span>dumps(record,
</span></span><span style=display:flex><span>                                 sort_keys<span style=color:#ff79c6>=</span><span style=color:#ff79c6>True</span>,
</span></span><span style=display:flex><span>                                 indent<span style=color:#ff79c6>=</span><span style=color:#bd93f9>4</span>,
</span></span><span style=display:flex><span>                                 default<span style=color:#ff79c6>=</span><span style=color:#8be9fd;font-style:italic>str</span>))
</span></span><span style=display:flex><span>                <span style=color:#8be9fd;font-style:italic>print</span>(<span style=color:#f1fa8c>&#34;&#34;</span>)
</span></span><span style=display:flex><span>                <span style=color:#8be9fd;font-style:italic>print</span>(<span style=color:#f1fa8c>&#34;&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>if</span> __name__ <span style=color:#ff79c6>==</span> <span style=color:#f1fa8c>&#39;__main__&#39;</span>:
</span></span><span style=display:flex><span>    boto_wrapper <span style=color:#ff79c6>=</span> BotoWrapper()
</span></span><span style=display:flex><span>    boto_wrapper<span style=color:#ff79c6>.</span>run_example()
</span></span></code></pre></div><p>To actually run this, make sure you have boto3 installed with:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>pip3 install boto3
</span></span></code></pre></div><p>Then you should be able to run this with:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>python3 read-stream.py
</span></span></code></pre></div><p>When I run this, I see four stream records as expected, and one of them looks like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>&#34;awsRegion&#34;</span>: <span style=color:#f1fa8c>&#34;ddblocal&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>&#34;dynamodb&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&#34;ApproximateCreationDateTime&#34;</span>: <span style=color:#f1fa8c>&#34;2020-08-02 14:24:00-07:00&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&#34;Keys&#34;</span>: {
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&#34;Company&#34;</span>: {
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>&#34;S&#34;</span>: <span style=color:#f1fa8c>&#34;Motorola&#34;</span>
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&#34;Model&#34;</span>: {
</span></span><span style=display:flex><span>                <span style=color:#ff79c6>&#34;S&#34;</span>: <span style=color:#f1fa8c>&#34;Cool Phone&#34;</span>
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&#34;SequenceNumber&#34;</span>: <span style=color:#f1fa8c>&#34;000000000000000000001&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&#34;SizeBytes&#34;</span>: <span style=color:#bd93f9>30</span>,
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&#34;StreamViewType&#34;</span>: <span style=color:#f1fa8c>&#34;KEYS_ONLY&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>&#34;eventID&#34;</span>: <span style=color:#f1fa8c>&#34;74fbc7ae-ae3f-417b-a3fa-4325d6a676b0&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>&#34;eventName&#34;</span>: <span style=color:#f1fa8c>&#34;INSERT&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>&#34;eventSource&#34;</span>: <span style=color:#f1fa8c>&#34;aws:dynamodb&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>&#34;eventVersion&#34;</span>: <span style=color:#f1fa8c>&#34;1.1&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Feel free to have a look at other <a href=https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/dynamodbstreams.html>DynamoDBStreams API operations</a> available to you as a python developer.</p><p>Finally, if you&rsquo;re actually going to be running this at scale, I would recommend you use an AWS Lambda triggering on a stream record or the Kinesis adapter&ndash;almost for sure you will save both time and money doing so. This was primarily meant as an exercise to understand how streams work and to enable easy local development.</p></section><footer><div class="pb-14 taxonomy-list tags-list"><a href=/tags/distributed-systems/ alt="Distributed Systems">Distributed Systems
</a><a href=/tags/devops/ alt=DevOps>DevOps
</a><a href=/tags/aws/ alt=Aws>Aws
</a><a href=/tags/dynamodb/ alt=Dynamodb>Dynamodb</a></div></footer></article></main><footer class="pt-5 pb-10 grid gap-3 sm:grid-cols-2"><div class="text-xs font-semibold text-gray-500 order-2 sm:order-1">© 2018-2025 —
<a href=https://www.nickolasfisher.com/>Nick Fisher's tech blog</a></div><div class="order-1 sm:order-2"><ul class="flex sm:justify-end gap-5"><li><a href=https://www.linkedin.com/in/nick-fisher-software/ target=_blank rel="noopener noreferrer">LinkedIn</a></li><li><a href=https://github.com/nfisher23 target=_blank rel="noopener noreferrer">GitHub</a></li></ul></div></footer></body></html>