<!DOCTYPE html>
<html lang="en-US" class="scroll-smooth dark">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>

<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>How to Configure Reactive Netty in Spring Boot, in Depth</title>
<meta
  name="description"
  content="Spring Boot&#39;s WebFlux programming model is pretty neat, but there isn&#39;t a lot by way of explaining how to best leverage it to get the results you need. I wrote this blog post after tinkering with the configuration of Reactor Netty on Spring Boot."
/>
<link rel="canonical" href="http://localhost:1313/blog/how-to-configure-reactive-netty-in-spring-boot-in-depth/" />
<link rel="robots" href="/robots.txt" />

<link rel="icon" type="image/x-icon" href="/icons/favicon.ico" />



<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });</script>

<link rel="stylesheet" href="http://localhost:1313/css/app.css" /></head>

  <body class="max-w-screen-md mx-auto px-2.5">
    <div class="header">
      <header class="flex flex-col sm:flex-row items-center gap-5 sm:gap-10 pt-16 py-12">
   


<div class="flex-none w-20 h-20 rounded-full overflow-hidden">
  <a href="http://localhost:1313/">
    <img
      srcset="/img/profile-picture_hu4241499301404582006.jpg 80w"
      src="/img/profile-picture.jpg"
      width="386"
      height="345"
      alt="Nick Fisher&#39;s tech blog"
    />
  </a>
</div>

  
  <div class="flex flex-col gap-5">
    <a href="http://localhost:1313/">
  <h1 id="site-title">Nick Fisher&#39;s tech blog</h1>
</a>
 
    <nav>
  <ul>
     
    
    <li>
      <a href="/" class="">
        Home
      </a>
    </li>
    
    <li>
      <a href="/blog" class="">
        Blog
      </a>
    </li>
    
    <li>
      <a href="/about" class="">
        About me
      </a>
    </li>
    
    <li>
      <a href="/categories" class="">
        Categories
      </a>
    </li>
    
    <li>
      <a href="/tags" class="">
        Tags
      </a>
    </li>
    
  </ul>
</nav>

  </div>
</header>

      <button class="toggle-theme" aria-label="Toggle Theme" title="Toggle Theme" onclick="toggleTheme()">
  <span class="theme-icon light"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
</svg> </span>
  <span class="theme-icon dark"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
</svg> </span>
</button>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const theme = localStorage.getItem('theme');

    if (!theme || theme === 'light') {
      setTheme('light');
    } else {
      setTheme(theme);
    }
  });

  function setTheme(theme) {
    const html = document.querySelector('html');
    localStorage.setItem('theme', theme);

    if (theme === 'light') {
      if (html.classList.contains('dark')) {
        document.querySelector('html').classList.remove('dark');
      }

      document.querySelector('.theme-icon.light').style.display = 'none';
      document.querySelector('.theme-icon.dark').style.display = 'block';
    } else {
      if (!html.classList.contains('dark')) {
        document.querySelector('html').classList.add('dark');
      }

      document.querySelector('.theme-icon.dark').style.display = 'none';
      document.querySelector('.theme-icon.light').style.display = 'block';
    }
  }

  function toggleTheme() {
    const theme = localStorage.getItem('theme');

    if (theme === 'light') {
      setTheme('dark');
    } else {
      setTheme('light');
    }
  }
</script>
    </div>
  
    <main id="content">

<article class="flex flex-col gap-10">
  <header class="flex flex-col gap-2">
    <h2 class="title-large">How to Configure Reactive Netty in Spring Boot, in Depth</h2>

    <div class="meta">
      
      <time datetime="2019-07-06 14:30:43 &#43;0000 UTC" title='Sat, Jul 6, 2019, 2:30 PM UTC'>
        06/07/2019 - Estimated reading time: 3 minutes
      </time>

       
      
    </div>
  </header>

  

  <section><p><a href="https://docs.spring.io/spring/docs/current/spring-framework-reference/web-reactive.html">Spring Boot's WebFlux programming model</a> is pretty neat, but there isn't a lot by way of explaining how to best leverage it to get the results you need. I wrote this blog post after tinkering with the configuration of Reactor Netty on Spring Boot.</p>
<p>The first point, before we begin, to realize about the event loop model is that we want to reuse threads across all operations, and then insure that those operations utilize non-blocking behavior. This is contrary to the asynchronous and blocking behavior in the past (e.g. Servlets), where we often want to designate specific thread pools for specific actions and reduce the probability that one misbehaving process or operation brings down the entire application. That idea is called the <a href="https://docs.microsoft.com/en-us/azure/architecture/patterns/bulkhead">bulkhead pattern</a>, and it does not apply here. If that's confusing to you (which it is to most people at first), follow up with the blog post directly after this one for a more in depth example and discussion.</p>
<p>With that in mind, the first thing we're going to want to do is reuse an event loop group, which I'll demonstrate below.</p>
<h3 id="create-the-reactive-webflux-app">Create the Reactive WebFlux App</h3>
<p>Go to the <a href="https://start.spring.io/">spring initializr</a>, select WebFlux, and unzip to your desired directory. By default, it comes with Reactor Netty.</p>
<p>From our discussion above, it makes sense to have one event loop group, which represents a group of threads that all consume work from a queue, pick it up, and try to release that work as quickly as possible in a non-blocking way. We can choose from most of the classes that implement Netty's <a href="https://netty.io/4.0/api/io/netty/channel/EventLoopGroup.html">EventLoopGroup</a>, or if we are feeling ambitious we could hand roll our own. I will choose <a href="https://netty.io/4.0/api/io/netty/channel/nio/NioEventLoopGroup.html">NioEventLoopGroup</a> and create a bean, so that the entry point looks like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@SpringBootApplication
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">ReactiveexApplication</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">main</span>(String<span style="color:#ff79c6">[]</span> args) <span style="color:#8be9fd;font-style:italic">throws</span> InterruptedException {
</span></span><span style="display:flex;"><span>        SpringApplication.<span style="color:#50fa7b">run</span>(ReactiveexApplication.<span style="color:#50fa7b">class</span>, args);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Bean
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> NioEventLoopGroup <span style="color:#50fa7b">nioEventLoopGroup</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">new</span> NioEventLoopGroup(20);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>To customize the web server, we will have to provide a <code>NettyReactiveWebServerFactory</code> bean and use the event loop group we have already defined:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    @Bean
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> NettyReactiveWebServerFactory <span style="color:#50fa7b">factory</span>(NioEventLoopGroup eventLoopGroup) {
</span></span><span style="display:flex;"><span>        NettyReactiveWebServerFactory factory <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> NettyReactiveWebServerFactory();
</span></span><span style="display:flex;"><span>        factory.<span style="color:#50fa7b">setServerCustomizers</span>(Collections.<span style="color:#50fa7b">singletonList</span>(<span style="color:#ff79c6">new</span> NettyServerCustomizer() {
</span></span><span style="display:flex;"><span>            @Override
</span></span><span style="display:flex;"><span>            <span style="color:#8be9fd;font-style:italic">public</span> HttpServer <span style="color:#50fa7b">apply</span>(HttpServer httpServer) {
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">return</span> httpServer.<span style="color:#50fa7b">tcpConfiguration</span>(tcpServer <span style="color:#ff79c6">-&amp;</span>gt;
</span></span><span style="display:flex;"><span>                                tcpServer.<span style="color:#50fa7b">bootstrap</span>(serverBootstrap <span style="color:#ff79c6">-&amp;</span>gt; serverBootstrap.<span style="color:#50fa7b">group</span>(eventLoopGroup)
</span></span><span style="display:flex;"><span>                                                        .<span style="color:#50fa7b">channel</span>(NioServerSocketChannel.<span style="color:#50fa7b">class</span>)));
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }));
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> factory;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>To customize the <code>WebClient</code> we will have to register a <code>ReactorResourceFactory</code> that intentionally does not use the global resources, since we are defining our own:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    @Bean
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> ReactorResourceFactory <span style="color:#50fa7b">reactorResourceFactory</span>(NioEventLoopGroup eventLoopGroup) {
</span></span><span style="display:flex;"><span>        ReactorResourceFactory f<span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> ReactorResourceFactory();
</span></span><span style="display:flex;"><span>        f.<span style="color:#50fa7b">setLoopResources</span>(<span style="color:#ff79c6">new</span> LoopResources() {
</span></span><span style="display:flex;"><span>            @Override
</span></span><span style="display:flex;"><span>            <span style="color:#8be9fd;font-style:italic">public</span> EventLoopGroup <span style="color:#50fa7b">onServer</span>(<span style="color:#8be9fd">boolean</span> b) {
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">return</span> eventLoopGroup;
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>        f.<span style="color:#50fa7b">setUseGlobalResources</span>(<span style="color:#ff79c6">false</span>);
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> f;
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>We will use this <code>ReactorResourceFactory</code> to register a <code>ReactorClientHttpConnector</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    @Bean
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> ReactorClientHttpConnector <span style="color:#50fa7b">reactorClientHttpConnector</span>(ReactorResourceFactory r) {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">new</span> ReactorClientHttpConnector(r, m <span style="color:#ff79c6">-&amp;</span>gt; m);
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>Finally, anytime we want our <code>WebClient</code> to participate in our custom defined thread pool, we can use this bean as the client connector:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    @Bean
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> WebClient <span style="color:#50fa7b">webClient</span>(ReactorClientHttpConnector r) {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> WebClient.<span style="color:#50fa7b">builder</span>().<span style="color:#50fa7b">baseUrl</span>(<span style="color:#ff79c6">&amp;</span>#34;http:<span style="color:#6272a4">//localhost:9000&amp;#34;).clientConnector(r).build();</span>
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div></section>

  
    
  

    
  


  <footer>
    
  </footer>
</article>


    </main><footer class="pt-5 pb-10 grid gap-3 sm:grid-cols-2">
    <div class="text-xs font-semibold text-gray-500 order-2 sm:order-1">
  © 2018-2025 —
  <a href="http://localhost:1313/">Nick Fisher&#39;s tech blog</a> 
</div>

    <div class="order-1 sm:order-2">
  <ul class="flex sm:justify-end gap-5">
    
    
    <li>    
      <a href="https://www.linkedin.com/in/nick-fisher-software/" target="_blank" rel="noopener noreferrer">LinkedIn</a>
    </li>
    
    <li>    
      <a href="https://github.com/nfisher23" target="_blank" rel="noopener noreferrer">GitHub</a>
    </li>
    
    
  </ul>
</div>

</footer></body>
</html>
