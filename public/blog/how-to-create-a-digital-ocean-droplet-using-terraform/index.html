<!DOCTYPE html>
<html lang="en-US" class="scroll-smooth dark">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>

<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>How to Create a Digital Ocean Droplet using Terraform</title>
<meta
  name="description"
  content="The source code for this post can be found on Github.
Terraform lets you define your infrastructure, e.g. a virtual machine, in code. Used properly, this saves you a lot of time, makes infra easier to manage, and will generally limit your ability to do something dumb, like delete or modify something your infrastructure is dependent on."
/>
<link rel="canonical" href="http://localhost:1313/blog/how-to-create-a-digital-ocean-droplet-using-terraform/" />
<link rel="robots" href="/robots.txt" />

<link rel="icon" type="image/x-icon" href="/img/nficon.png" />



<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });</script>

<link rel="stylesheet" href="http://localhost:1313/css/app.css" /></head>

  <body class="max-w-screen-md mx-auto px-2.5">
    <div class="header">
      <header class="flex flex-col sm:flex-row items-center gap-5 sm:gap-10 pt-16 py-12">
   


<div class="flex-none w-20 h-20 rounded-full overflow-hidden">
  <a href="http://localhost:1313/">
    <img
      srcset="/img/profile-picture_hu4241499301404582006.jpg 80w"
      src="/img/profile-picture.jpg"
      width="386"
      height="345"
      alt="Nick Fisher&#39;s tech blog"
    />
  </a>
</div>

  
  <div class="flex flex-col gap-5">
    <a href="http://localhost:1313/">
  <h1 id="site-title">Nick Fisher&#39;s tech blog</h1>
</a>
 
    <nav>
  <ul>
     
    
    <li>
      <a href="/" class="">
        home
      </a>
    </li>
    
    <li>
      <a href="/blog" class="">
        blog
      </a>
    </li>
    
    <li>
      <a href="/about" class="">
        about
      </a>
    </li>
    
    <li>
      <a href="/tags" class="">
        Tags
      </a>
    </li>
    
  </ul>
</nav>

  </div>
</header>

      <button class="toggle-theme" aria-label="Toggle Theme" title="Toggle Theme" onclick="toggleTheme()">
  <span class="theme-icon light"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
</svg> </span>
  <span class="theme-icon dark"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
</svg> </span>
</button>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const theme = localStorage.getItem('theme');

    if (!theme || theme === 'light') {
      setTheme('light');
    } else {
      setTheme(theme);
    }
  });

  function setTheme(theme) {
    const html = document.querySelector('html');
    localStorage.setItem('theme', theme);

    if (theme === 'light') {
      if (html.classList.contains('dark')) {
        document.querySelector('html').classList.remove('dark');
      }

      document.querySelector('.theme-icon.light').style.display = 'none';
      document.querySelector('.theme-icon.dark').style.display = 'block';
    } else {
      if (!html.classList.contains('dark')) {
        document.querySelector('html').classList.add('dark');
      }

      document.querySelector('.theme-icon.dark').style.display = 'none';
      document.querySelector('.theme-icon.light').style.display = 'block';
    }
  }

  function toggleTheme() {
    const theme = localStorage.getItem('theme');

    if (theme === 'light') {
      setTheme('dark');
    } else {
      setTheme('light');
    }
  }
</script>
    </div>
  
    <main id="content">

<article class="flex flex-col gap-10">
  <header class="flex flex-col gap-2">
    <h2 class="title-large">How to Create a Digital Ocean Droplet using Terraform</h2>

    <div class="meta">
      
      <time datetime="2020-05-17 18:26:02 &#43;0000 UTC" title='Sun, May 17, 2020, 6:26 PM UTC'>
        17/05/2020 - Estimated reading time: 3 minutes
      </time>

       
      
    </div>
  </header>

  

  <section><p>The source code for this post can be found <a href="https://github.com/nfisher23/digitalocean-terraform-examples">on Github</a>.</p>
<p>Terraform lets you define your infrastructure, e.g. a virtual machine, in code. Used properly, this saves you a lot of time, makes infra easier to manage, and will generally limit your ability to do something dumb, like delete or modify something your infrastructure is dependent on.</p>
<p>The official <a href="https://www.terraform.io/docs/providers/do/index.html">digital ocean terraform provider</a> makes this pretty straightforward. In this article, we will:</p>
<ol>
<li>
<p>Get the prerequisites for using the DO terraform provider out of the way</p>
</li>
<li>
<p>Add your ssh key to your digital ocean account using terraform</p>
</li>
<li>
<p>Create a droplet</p>
</li>
<li>
<p>Provision nginx on that droplet</p>
</li>
</ol>
<h2 id="getting-it-done">Getting it Done</h2>
<p>To begin with, you will need a digital ocean api key. You can get one by going to the digital ocean control panel, clicking &quot;API&quot; under &quot;Account&quot; in the lower left hand corner, then &quot;Generate New Token.&quot; I would recommend you use a sophisticated secrets management tool like <a href="https://spideroak.com/encryptr/">Encryptr</a> to keep the api token safe, since you're only going to get to see the token immediately after you create it.</p>
<p>Once you have the key, you need to set an environment variable in your shell like so:</p>
<pre tabindex="0"><code>export DIGITALOCEAN_ACCESS_TOKEN=&amp;lt;your-token-here&amp;gt;
</code></pre><p>If you've already set up your digital ocean cli before then you could try <a href="https://mikefarah.gitbook.io/yq/">a yaml bash tool called yq</a> to set it for you:</p>
<pre tabindex="0"><code>export DIGITALOCEAN_ACCESS_TOKEN=$(cat ~/.config/doctl/config.yaml |  yq r - access-token)
</code></pre><h3 id="reuse-existing-ssh-key">Reuse Existing SSH Key</h3>
<p>If you already have a ssh key that you uploaded to digital ocean in some other way, you can import it as terraform data, so that your terraform configuration can look like this (in this case, I'm using an old thinkpad retrofitted with linux, so I have an ssh key I've named &quot;thinkpad&quot;):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-hcl" data-lang="hcl"><span style="display:flex;"><span><span style="color:#ff79c6">provider</span> &amp;<span style="color:#6272a4">#34;digitalocean&amp;#34; {
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  // <span style="color:#ff79c6">token</span> <span style="color:#ff79c6">automatically</span> <span style="color:#ff79c6">picked</span> <span style="color:#ff79c6">up</span> <span style="color:#ff79c6">using</span> <span style="color:#ff79c6">env</span> <span style="color:#ff79c6">variable</span> <span style="color:#ff79c6">DIGITALOCEAN_ACCESS_TOKEN</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">variable</span> &amp;<span style="color:#6272a4">#34;region&amp;#34; {
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  default <span style="color:#ff79c6">=</span> &amp;<span style="color:#6272a4">#34;sfo2&amp;#34;
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">data</span> <span style="color:#ff79c6">digitalocean_ssh_key</span> &amp;<span style="color:#6272a4">#34;my_ssh_key&amp;#34; {
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  name <span style="color:#ff79c6">=</span> &amp;<span style="color:#6272a4">#34;thinkpad&amp;#34;
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">resource</span> &amp;<span style="color:#6272a4">#34;digitalocean_droplet&amp;#34; &amp;#34;atest&amp;#34; {
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  image      <span style="color:#ff79c6">=</span> &amp;<span style="color:#6272a4">#34;ubuntu-18-04-x64&amp;#34;
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  name       <span style="color:#ff79c6">=</span> &amp;<span style="color:#6272a4">#34;test&amp;#34;
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  region     <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">var</span>.<span style="color:#ff79c6">region</span>
</span></span><span style="display:flex;"><span>  size       <span style="color:#ff79c6">=</span> &amp;<span style="color:#6272a4">#34;s-1vcpu-2gb&amp;#34;
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  ssh_keys   <span style="color:#ff79c6">=</span> [<span style="color:#ff79c6">data</span>.<span style="color:#ff79c6">digitalocean_ssh_key</span>.<span style="color:#ff79c6">my_ssh_key</span>.<span style="color:#ff79c6">id</span>]
</span></span><span style="display:flex;"><span>  monitoring <span style="color:#ff79c6">=</span> <span style="color:#8be9fd">true</span>
</span></span><span style="display:flex;"><span>  private_networking <span style="color:#ff79c6">=</span> <span style="color:#8be9fd">true</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">output</span> &amp;<span style="color:#6272a4">#34;droplet_ip_address&amp;#34; {
</span></span></span><span style="display:flex;"><span><span style="color:#6272a4"></span>  value <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">digitalocean_droplet</span>.<span style="color:#ff79c6">atest</span>.<span style="color:#ff79c6">ipv4_address</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="create-ssh-key">Create SSH Key</h2>
<p>If you want to upload your ssh key to digital ocean in this terraform configuration as well, then you can set this up as:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>provider &amp;#34;digitalocean&amp;#34; {
</span></span><span style="display:flex;"><span>  // token automatically picked up using env variable DIGITALOCEAN_ACCESS_TOKEN
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>variable &amp;#34;region&amp;#34; {
</span></span><span style="display:flex;"><span>  default = &amp;#34;sfo2&amp;#34;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>resource &amp;#34;digitalocean_ssh_key&amp;#34; &amp;#34;my_ssh_key&amp;#34; {
</span></span><span style="display:flex;"><span>  name = &amp;#34;new_ssh_key&amp;#34;
</span></span><span style="display:flex;"><span>  public_key = file(&amp;#34;~/.ssh/id_rsa.pub&amp;#34;)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>resource &amp;#34;digitalocean_droplet&amp;#34; &amp;#34;atest&amp;#34; {
</span></span><span style="display:flex;"><span>  image      = &amp;#34;ubuntu-18-04-x64&amp;#34;
</span></span><span style="display:flex;"><span>  name       = &amp;#34;test&amp;#34;
</span></span><span style="display:flex;"><span>  region     = var.region
</span></span><span style="display:flex;"><span>  size       = &amp;#34;s-1vcpu-2gb&amp;#34;
</span></span><span style="display:flex;"><span>  ssh_keys   = [digitalocean_ssh_key.my_ssh_key.id]
</span></span><span style="display:flex;"><span>  monitoring = true
</span></span><span style="display:flex;"><span>  private_networking = true
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>output &amp;#34;droplet_ip_address&amp;#34; {
</span></span><span style="display:flex;"><span>  value = digitalocean_droplet.atest.ipv4_address
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>With your chosen terraform configuration in place, navigate to the directory where this is set up and run:</p>
<pre tabindex="0"><code>$ terraform init
$ terraform apply
</code></pre><p>Then type &quot;yes&quot; on prompt, and you should see two resources being created.</p>
<h3 id="installing-nginx">Installing Nginx</h3>
<p>Once it is up and running, you should be able to install nginx on this server with the following set of commands:</p>
<pre tabindex="0"><code>$ export IP_ADDR=$(terraform output droplet_ip_address)
$ ssh root@$IP_ADDR &amp;#34;sudo apt-get update &amp;amp;&amp;amp; sudo apt-get install -y nginx&amp;#34;
</code></pre><p>To view the IP address in your shell:</p>
<pre tabindex="0"><code>$ echo $IP_ADDR
</code></pre><p>You should now be able to navigate on your browser to that IP address and see the canned nginx homepage.</p>
</section>

  
    
  

    
  


  <footer>
    
      <div class="pb-14 taxonomy-list tags-list">
      
        <a href="/tags/bash/" alt="Bash">
          Bash
        </a>
      
        <a href="/tags/devops/" alt="DevOps">
          DevOps
        </a>
      
        <a href="/tags/digital-ocean/" alt="Digital Ocean">
          Digital Ocean
        </a>
      
        <a href="/tags/terraform/" alt="Terraform">
          Terraform
        </a>
      
      </div>
    
  </footer>
</article>


    </main><footer class="pt-5 pb-10 grid gap-3 sm:grid-cols-2">
    <div class="text-xs font-semibold text-gray-500 order-2 sm:order-1">
  © 2018-2025 —
  <a href="http://localhost:1313/">Nick Fisher&#39;s tech blog</a> 
</div>

    <div class="order-1 sm:order-2">
  <ul class="flex sm:justify-end gap-5">
    
    
    <li>    
      <a href="https://www.linkedin.com/in/nick-fisher-software/" target="_blank" rel="noopener noreferrer">LinkedIn</a>
    </li>
    
    <li>    
      <a href="https://github.com/nfisher23" target="_blank" rel="noopener noreferrer">GitHub</a>
    </li>
    
    
  </ul>
</div>

</footer></body>
</html>
