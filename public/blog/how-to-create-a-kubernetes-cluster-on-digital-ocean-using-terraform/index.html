<!DOCTYPE html>
<html lang="en-US" class="scroll-smooth dark">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>

<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>How To Create a Kubernetes Cluster on Digital Ocean using Terraform</title>
<meta
  name="description"
  content="The source code for this post can be found on Github.
Kubernetes has democratized the cloud more than any piece of software before or since. What used to be proprietary APIs by AWS, Azure, or GCP for things like auto scaling groups, load balancers, or virtual machines is now abstracted away behind never ending yaml configuration. Combine this wonderful abstraction with the pricing model of Digital Ocean and you&#39;ve got all the makings of a developer party."
/>
<link rel="canonical" href="http://localhost:1313/blog/how-to-create-a-kubernetes-cluster-on-digital-ocean-using-terraform/" />
<link rel="robots" href="/robots.txt" />

<link rel="icon" type="image/x-icon" href="/icons/favicon.ico" />



<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });</script>

<link rel="stylesheet" href="http://localhost:1313/css/app.css" /></head>

  <body class="max-w-screen-md mx-auto px-2.5">
    <div class="header">
      <header class="flex flex-col sm:flex-row items-center gap-5 sm:gap-10 pt-16 py-12">
   


<div class="flex-none w-20 h-20 rounded-full overflow-hidden">
  <a href="http://localhost:1313/">
    <img
      srcset="/img/profile-picture_hu4241499301404582006.jpg 80w"
      src="/img/profile-picture.jpg"
      width="386"
      height="345"
      alt="Nick Fisher&#39;s tech blog"
    />
  </a>
</div>

  
  <div class="flex flex-col gap-5">
    <a href="http://localhost:1313/">
  <h1 id="site-title">Nick Fisher&#39;s tech blog</h1>
</a>
 
    <nav>
  <ul>
     
    
    <li>
      <a href="/" class="">
        Home
      </a>
    </li>
    
    <li>
      <a href="/blog" class="">
        Blog
      </a>
    </li>
    
    <li>
      <a href="/about" class="">
        About me
      </a>
    </li>
    
    <li>
      <a href="/categories" class="">
        Categories
      </a>
    </li>
    
    <li>
      <a href="/tags" class="">
        Tags
      </a>
    </li>
    
  </ul>
</nav>

  </div>
</header>

      <button class="toggle-theme" aria-label="Toggle Theme" title="Toggle Theme" onclick="toggleTheme()">
  <span class="theme-icon light"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
</svg> </span>
  <span class="theme-icon dark"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
</svg> </span>
</button>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const theme = localStorage.getItem('theme');

    if (!theme || theme === 'light') {
      setTheme('light');
    } else {
      setTheme(theme);
    }
  });

  function setTheme(theme) {
    const html = document.querySelector('html');
    localStorage.setItem('theme', theme);

    if (theme === 'light') {
      if (html.classList.contains('dark')) {
        document.querySelector('html').classList.remove('dark');
      }

      document.querySelector('.theme-icon.light').style.display = 'none';
      document.querySelector('.theme-icon.dark').style.display = 'block';
    } else {
      if (!html.classList.contains('dark')) {
        document.querySelector('html').classList.add('dark');
      }

      document.querySelector('.theme-icon.dark').style.display = 'none';
      document.querySelector('.theme-icon.light').style.display = 'block';
    }
  }

  function toggleTheme() {
    const theme = localStorage.getItem('theme');

    if (theme === 'light') {
      setTheme('dark');
    } else {
      setTheme('light');
    }
  }
</script>
    </div>
  
    <main id="content">

<article class="flex flex-col gap-10">
  <header class="flex flex-col gap-2">
    <h2 class="title-large">How To Create a Kubernetes Cluster on Digital Ocean using Terraform</h2>

    <div class="meta">
      
      <time datetime="2020-05-17 21:58:17 &#43;0000 UTC" title='Sun, May 17, 2020, 9:58 PM UTC'>
        17/05/2020 - Estimated reading time: 2 minutes
      </time>

       
      
    </div>
  </header>

  

  <section><p>The source code for this post can be found <a href="https://github.com/nfisher23/digitalocean-terraform-examples/tree/master/kubernetes">on Github</a>.</p>
<p>Kubernetes has democratized the cloud more than any piece of software before or since. What used to be proprietary APIs by AWS, Azure, or GCP for things like auto scaling groups, load balancers, or virtual machines is now abstracted away behind never ending yaml configuration. Combine this wonderful abstraction with the pricing model of <a href="https://www.digitalocean.com/">Digital Ocean</a> and you've got all the makings of a developer party.</p>
<p>To spin up a simple digital ocean kubernetes cluster to play around with, I decided to use terraform:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>provider &amp;#34;digitalocean&amp;#34; {
</span></span><span style="display:flex;"><span>  // token automatically picked up using env variables
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>variable &amp;#34;region&amp;#34; {
</span></span><span style="display:flex;"><span>  <span style="color:#6272a4"># `doctl kubernetes options regions` for full list</span>
</span></span><span style="display:flex;"><span>  default = &amp;#34;sfo3&amp;#34;
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>data &amp;#34;digitalocean_kubernetes_versions&amp;#34; &amp;#34;do_k8s_versions&amp;#34; {}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>output &amp;#34;k8s-versions&amp;#34; {
</span></span><span style="display:flex;"><span>  value = data.digitalocean_kubernetes_versions.do_k8s_versions.latest_version
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>resource &amp;#34;digitalocean_kubernetes_cluster&amp;#34; &amp;#34;hellok8s&amp;#34; {
</span></span><span style="display:flex;"><span>  name    = &amp;#34;hellok8s&amp;#34;
</span></span><span style="display:flex;"><span>  region  = var.region
</span></span><span style="display:flex;"><span>  <span style="color:#6272a4"># Or grab the latest version slug from `doctl kubernetes options versions`</span>
</span></span><span style="display:flex;"><span>  version = data.digitalocean_kubernetes_versions.do_k8s_versions.latest_version
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  node_pool {
</span></span><span style="display:flex;"><span>    name       = &amp;#34;worker-pool&amp;#34;
</span></span><span style="display:flex;"><span>    size       = &amp;#34;s-2vcpu-2gb&amp;#34;
</span></span><span style="display:flex;"><span>    node_count = 1
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>You'll need to set an environment variable for terraform to pick up the credentials necessary to actually run this [DIGITALOCEAN_ACCESS_TOKEN]. Here, I'm using a <a href="https://www.terraform.io/docs/providers/do/d/kubernetes_versions.html">terraform data source</a> to provide the version to use, since digital ocean changes the versions that they are supporting on a regular basis. This kubernetes cluster will not be dynamically spinning up and down DO infrastructure, instead it will have a single worker node. I also have elected to use the third San Fransisco data center. If you want to find out what data centers can support this, you can run:</p>
<pre tabindex="0"><code>$ doctl kubernetes options regions
</code></pre><p>If you navigate to the directory where the above file (I called it <strong>kubs.tf</strong>) is located, run:</p>
<pre tabindex="0"><code>$ terraform apply
</code></pre><p>And wait about five minutes, it will finally come up. If you go and <a href="https://github.com/digitalocean/doctl">configure doctl, the command line client for digital ocean</a>, then you should be able to see your cluster with:</p>
<pre tabindex="0"><code>$ doctl kubernetes cluster list
ID                                      Name        Region    Version        Auto Upgrade    Status     Node Pools
02522c88-9c46-4a4e-9776-a7e1e229b13a    hellok8s    sfo3      1.17.5-do.0    false           running    worker-pool
</code></pre><p>You can save the context for the <a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/">kubectl cli utility</a> with:</p>
<pre tabindex="0"><code>$ doctl kubernetes cluster kubeconfig save hellok8s
</code></pre><p>Then you should be able to start running kubernetes commands:</p>
<pre tabindex="0"><code>$ kubectl get deployments -A
NAMESPACE     NAME                   READY   UP-TO-DATE   AVAILABLE   AGE
kube-system   cilium-operator        1/1     1            1           18m
kube-system   coredns                2/2     2            2           18m
kube-system   kubelet-rubber-stamp   1/1     1            1           18m
</code></pre><p>And you're good to go.</p>
</section>

  
    
  

    
  


  <footer>
    
  </footer>
</article>


    </main><footer class="pt-5 pb-10 grid gap-3 sm:grid-cols-2">
    <div class="text-xs font-semibold text-gray-500 order-2 sm:order-1">
  © 2018-2025 —
  <a href="http://localhost:1313/">Nick Fisher&#39;s tech blog</a> 
</div>

    <div class="order-1 sm:order-2">
  <ul class="flex sm:justify-end gap-5">
    
    
    <li>    
      <a href="https://www.linkedin.com/in/nick-fisher-software/" target="_blank" rel="noopener noreferrer">LinkedIn</a>
    </li>
    
    <li>    
      <a href="https://github.com/nfisher23" target="_blank" rel="noopener noreferrer">GitHub</a>
    </li>
    
    
  </ul>
</div>

</footer></body>
</html>
