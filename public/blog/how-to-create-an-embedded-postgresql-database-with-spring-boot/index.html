<!DOCTYPE html>
<html lang="en-US" class="scroll-smooth dark">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>

<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>How to Create an Embedded PostgreSQL Database With Spring Boot</title>
<meta
  name="description"
  content="You can see the sample code for this post on GitHub.
PostgreSQL is still my favorite database, and if a project I&#39;m working on makes sense as a relational database model, it&#39;s always what I reach for."
/>
<link rel="canonical" href="http://localhost:1313/blog/how-to-create-an-embedded-postgresql-database-with-spring-boot/" />
<link rel="robots" href="/robots.txt" />

<link rel="icon" type="image/x-icon" href="/icons/favicon.ico" />



<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });</script>

<link rel="stylesheet" href="http://localhost:1313/css/app.css" /></head>

  <body class="max-w-screen-md mx-auto px-2.5">
    <div class="header">
      <header class="flex flex-col sm:flex-row items-center gap-5 sm:gap-10 pt-16 py-12">
   


<div class="flex-none w-20 h-20 rounded-full overflow-hidden">
  <a href="http://localhost:1313/">
    <img
      srcset="/img/profile-picture_hu4241499301404582006.jpg 80w"
      src="/img/profile-picture.jpg"
      width="386"
      height="345"
      alt="Nick Fisher&#39;s tech blog"
    />
  </a>
</div>

  
  <div class="flex flex-col gap-5">
    <a href="http://localhost:1313/">
  <h1 id="site-title">Nick Fisher&#39;s tech blog</h1>
</a>
 
    <nav>
  <ul>
     
    
    <li>
      <a href="/" class="">
        home
      </a>
    </li>
    
    <li>
      <a href="/blog" class="">
        blog
      </a>
    </li>
    
    <li>
      <a href="/about" class="">
        about
      </a>
    </li>
    
    <li>
      <a href="/tags" class="">
        Tags
      </a>
    </li>
    
  </ul>
</nav>

  </div>
</header>

      <button class="toggle-theme" aria-label="Toggle Theme" title="Toggle Theme" onclick="toggleTheme()">
  <span class="theme-icon light"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
</svg> </span>
  <span class="theme-icon dark"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
</svg> </span>
</button>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const theme = localStorage.getItem('theme');

    if (!theme || theme === 'light') {
      setTheme('light');
    } else {
      setTheme(theme);
    }
  });

  function setTheme(theme) {
    const html = document.querySelector('html');
    localStorage.setItem('theme', theme);

    if (theme === 'light') {
      if (html.classList.contains('dark')) {
        document.querySelector('html').classList.remove('dark');
      }

      document.querySelector('.theme-icon.light').style.display = 'none';
      document.querySelector('.theme-icon.dark').style.display = 'block';
    } else {
      if (!html.classList.contains('dark')) {
        document.querySelector('html').classList.add('dark');
      }

      document.querySelector('.theme-icon.dark').style.display = 'none';
      document.querySelector('.theme-icon.light').style.display = 'block';
    }
  }

  function toggleTheme() {
    const theme = localStorage.getItem('theme');

    if (theme === 'light') {
      setTheme('dark');
    } else {
      setTheme('light');
    }
  }
</script>
    </div>
  
    <main id="content">

<article class="flex flex-col gap-10">
  <header class="flex flex-col gap-2">
    <h2 class="title-large">How to Create an Embedded PostgreSQL Database With Spring Boot</h2>

    <div class="meta">
      
      <time datetime="2019-04-20 15:28:25 &#43;0000 UTC" title='Sat, Apr 20, 2019, 3:28 PM UTC'>
        20/04/2019 - Estimated reading time: 2 minutes
      </time>

       
      
    </div>
  </header>

  

  <section><p>You can see the sample code for this post <a href="https://github.com/nfisher23/postgres-flyway-example">on GitHub</a>.</p>
<p><a href="https://www.postgresql.org/">PostgreSQL</a> is still my favorite database, and if a project I'm working on makes sense as a relational database model, it's always what I reach for.</p>
<p>Automating database tests, and maintaining consistency between environments, is one of the biggest pain points between working locally and deploying to higher environments. In particular, when you need to take advantage of native features of the database you're using (since consistency between vendors on some of the finer details is nearly a pipe-dream at this point), using a general in memory database (like H2) just doesn't cut it.</p>
<p>To start using a PostgreSQL in memory database (with <em>as little</em> spring boot magic as possible), you will first need to ensure that you have a PostgreSQL dependency. If you're using Maven, that's:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>&amp;lt;dependency&amp;gt;
</span></span><span style="display:flex;"><span>    &amp;lt;groupId&amp;gt;org.postgresql&amp;lt;/groupId&amp;gt;
</span></span><span style="display:flex;"><span>    &amp;lt;artifactId&amp;gt;postgresql&amp;lt;/artifactId&amp;gt;
</span></span><span style="display:flex;"><span>    &amp;lt;scope&amp;gt;runtime&amp;lt;/scope&amp;gt;
</span></span><span style="display:flex;"><span>&amp;lt;/dependency&amp;gt;
</span></span></code></pre></div><p>We can then resort to using <a href="https://github.com/opentable/otj-pg-embedded">opentable</a> as the in memory engine by adding another dependency:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>&amp;lt;dependency&amp;gt;
</span></span><span style="display:flex;"><span>    &amp;lt;groupId&amp;gt;com.opentable.components&amp;lt;/groupId&amp;gt;
</span></span><span style="display:flex;"><span>    &amp;lt;artifactId&amp;gt;otj-pg-embedded&amp;lt;/artifactId&amp;gt;
</span></span><span style="display:flex;"><span>    &amp;lt;version&amp;gt;0.13.1&amp;lt;/version&amp;gt;
</span></span><span style="display:flex;"><span>    &amp;lt;scope&amp;gt;compile&amp;lt;/scope&amp;gt;
</span></span><span style="display:flex;"><span>&amp;lt;/dependency&amp;gt;
</span></span></code></pre></div><p>Finally, wherever we want the embedded database, we can spin it up with default settings like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#ff79c6">package</span> com.nickolasfisher.flywaystuff;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>... imports ...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@Configuration
</span></span><span style="display:flex;"><span>@ComponentScan
</span></span><span style="display:flex;"><span>@Profile(<span style="color:#ff79c6">&amp;</span>#34;dev<span style="color:#ff79c6">&amp;</span>#34;)
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">DevConfig</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Bean
</span></span><span style="display:flex;"><span>    @Primary
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> DataSource <span style="color:#50fa7b">inMemoryDS</span>() <span style="color:#8be9fd;font-style:italic">throws</span> Exception {
</span></span><span style="display:flex;"><span>        DataSource embeddedPostgresDS <span style="color:#ff79c6">=</span> EmbeddedPostgres.<span style="color:#50fa7b">builder</span>()
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">start</span>().<span style="color:#50fa7b">getPostgresDatabase</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> embeddedPostgresDS;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Next up, we'll look at using <a href="https://flywaydb.org/">Flyway</a> to run idempotent database migration scripts against our database on application startup, giving the application flexible and full control over the state of the schemas it owns.</p>
</section>

  
    
  

    
  


  <footer>
    
      <div class="pb-14 taxonomy-list tags-list">
      
        <a href="/tags/java/" alt="Java">
          Java
        </a>
      
        <a href="/tags/spring/" alt="Spring">
          Spring
        </a>
      
        <a href="/tags/devops/" alt="DevOps">
          DevOps
        </a>
      
        <a href="/tags/postgresql/" alt="PostgreSQL">
          PostgreSQL
        </a>
      
      </div>
    
  </footer>
</article>


    </main><footer class="pt-5 pb-10 grid gap-3 sm:grid-cols-2">
    <div class="text-xs font-semibold text-gray-500 order-2 sm:order-1">
  © 2018-2025 —
  <a href="http://localhost:1313/">Nick Fisher&#39;s tech blog</a> 
</div>

    <div class="order-1 sm:order-2">
  <ul class="flex sm:justify-end gap-5">
    
    
    <li>    
      <a href="https://www.linkedin.com/in/nick-fisher-software/" target="_blank" rel="noopener noreferrer">LinkedIn</a>
    </li>
    
    <li>    
      <a href="https://github.com/nfisher23" target="_blank" rel="noopener noreferrer">GitHub</a>
    </li>
    
    
  </ul>
</div>

</footer></body>
</html>
