<!DOCTYPE html>
<html lang="en-US" class="scroll-smooth dark">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>

<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>How To Make a Basic Working Contact Form With ASP .NET Core MVC and MailKit</title>
<meta
  name="description"
  content="Modern day website owners prefer not to leave their email address open and exploitable on the internet.
Enter the Contact page, which will usually have some basic fields for the visitor of the site to fill out like
Name, Email Address, Phone, and Message to send to someone who can help them out."
/>
<link rel="canonical" href="http://localhost:1313/blog/how-to-make-a-basic-working-contact-form-with-asp-net-core-mvc-and-mailkit/" />
<link rel="robots" href="/robots.txt" />

<link rel="icon" type="image/x-icon" href="/icons/favicon.ico" />



<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });</script>

<link rel="stylesheet" href="http://localhost:1313/css/app.css" /></head>

  <body class="max-w-screen-md mx-auto px-2.5">
    <div class="header">
      <header class="flex flex-col sm:flex-row items-center gap-5 sm:gap-10 pt-16 py-12">
   


<div class="flex-none w-20 h-20 rounded-full overflow-hidden">
  <a href="http://localhost:1313/">
    <img
      srcset="/img/profile-picture_hu4241499301404582006.jpg 80w"
      src="/img/profile-picture.jpg"
      width="386"
      height="345"
      alt="Nick Fisher&#39;s tech blog"
    />
  </a>
</div>

  
  <div class="flex flex-col gap-5">
    <a href="http://localhost:1313/">
  <h1 id="site-title">Nick Fisher&#39;s tech blog</h1>
</a>
 
    <nav>
  <ul>
     
    
    <li>
      <a href="/" class="">
        home
      </a>
    </li>
    
    <li>
      <a href="/blog" class="">
        blog
      </a>
    </li>
    
    <li>
      <a href="/about" class="">
        about
      </a>
    </li>
    
    <li>
      <a href="/tags" class="">
        Tags
      </a>
    </li>
    
  </ul>
</nav>

  </div>
</header>

      <button class="toggle-theme" aria-label="Toggle Theme" title="Toggle Theme" onclick="toggleTheme()">
  <span class="theme-icon light"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
</svg> </span>
  <span class="theme-icon dark"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
</svg> </span>
</button>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const theme = localStorage.getItem('theme');

    if (!theme || theme === 'light') {
      setTheme('light');
    } else {
      setTheme(theme);
    }
  });

  function setTheme(theme) {
    const html = document.querySelector('html');
    localStorage.setItem('theme', theme);

    if (theme === 'light') {
      if (html.classList.contains('dark')) {
        document.querySelector('html').classList.remove('dark');
      }

      document.querySelector('.theme-icon.light').style.display = 'none';
      document.querySelector('.theme-icon.dark').style.display = 'block';
    } else {
      if (!html.classList.contains('dark')) {
        document.querySelector('html').classList.add('dark');
      }

      document.querySelector('.theme-icon.dark').style.display = 'none';
      document.querySelector('.theme-icon.light').style.display = 'block';
    }
  }

  function toggleTheme() {
    const theme = localStorage.getItem('theme');

    if (theme === 'light') {
      setTheme('dark');
    } else {
      setTheme('light');
    }
  }
</script>
    </div>
  
    <main id="content">

<article class="flex flex-col gap-10">
  <header class="flex flex-col gap-2">
    <h2 class="title-large">How To Make a Basic Working Contact Form With ASP .NET Core MVC and MailKit</h2>

    <div class="meta">
      
      <time datetime="2018-08-04 00:00:00 &#43;0000 UTC" title='Sat, Aug 4, 2018, 12:00 AM UTC'>
        04/08/2018 - Estimated reading time: 6 minutes
      </time>

       
      
    </div>
  </header>

  

  <section><p>Modern day website owners prefer not to leave their email address open and exploitable on the internet.
Enter the Contact page, which will usually have some basic fields for the visitor of the site to fill out like
Name, Email Address, Phone, and Message to send to someone who can help them out.</p>
<p>Enough talk. Let's code up a working contact form with ASP .NET Core MVC!</p>
<p>Let's start with the front-end. Open up Visual Studio, and create a new ASP .Net Core Web Application project. I'm calling mine BasicContactForm.
When prompted, choose the <strong>Empty</strong> project template. Then ensure your startup class looks like this:</p>
<pre tabindex="0"><code>using Microsoft.AspNetCore.Builder;
using Microsoft.AspNetCore.Hosting;
using Microsoft.Extensions.DependencyInjection;

namespace BasicContactForm
{
    public class Startup
    {
        public void ConfigureServices(IServiceCollection services)
        {
            services.AddMvc();
        }

        public void Configure(IApplicationBuilder app, IHostingEnvironment env)
        {
            app.UseMvcWithDefaultRoute();
        }
    }
}
</code></pre><p>We'll first need a model for the contact form to bind to, so add a <strong>Models Folder</strong> and add a class called <strong>ContactFormModel</strong>.
It's a real simple container class like so:</p>
<pre tabindex="0"><code>namespace BasicContactForm.Models
{
    public class ContactFormModel
    {
        public string Name { get; set; }
        public string Email { get; set; }
        public string Message { get; set; }
    }
}
</code></pre><p>The default route we configured in <code>Startup</code> is Home/Index, so to work with that we have to create a <strong>Controllers Folder</strong> and
place a class called <strong>HomeController</strong> inside it like so (we'll add the post method in a minute for the form):</p>
<pre tabindex="0"><code>using Microsoft.AspNetCore.Mvc;

namespace BasicContactForm.Controllers
{
    public class HomeController : Controller
    {
        [HttpGet]
        public ViewResult Index()
        {
            return View();
        }
    }
}
</code></pre><p>Now we need a <strong>Views Folder</strong> with a <strong>Home Folder</strong> inside the Views Folder. Then add a Razor page (cshtml) titled Index.cshtml, inside the Home Folder, like so:</p>
<pre tabindex="0"><code>@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers
@model BasicContactForm.Models.ContactFormModel

&amp;lt;h3&amp;gt;Basic Contact Form&amp;lt;/h3&amp;gt;
&amp;lt;form asp-action=&amp;#34;Index&amp;#34; asp-controller=&amp;#34;Home&amp;#34; method=&amp;#34;post&amp;#34;&amp;gt;
    &amp;lt;div&amp;gt;
        &amp;lt;label asp-for=&amp;#34;Name&amp;#34;&amp;gt;Please enter your name:&amp;lt;/label&amp;gt;
        &amp;lt;input type=&amp;#34;text&amp;#34; asp-for=&amp;#34;Name&amp;#34; /&amp;gt;
    &amp;lt;/div&amp;gt;
    &amp;lt;div&amp;gt;
        &amp;lt;label asp-for=&amp;#34;Email&amp;#34;&amp;gt;Please enter your email:&amp;lt;/label&amp;gt;
        &amp;lt;input type=&amp;#34;text&amp;#34; asp-for=&amp;#34;Email&amp;#34; /&amp;gt;
    &amp;lt;/div&amp;gt;
    &amp;lt;div&amp;gt;
        &amp;lt;label asp-for=&amp;#34;Message&amp;#34;&amp;gt;Please enter your message:&amp;lt;/label&amp;gt;
        &amp;lt;textarea asp-for=&amp;#34;Message&amp;#34;&amp;gt;&amp;lt;/textarea&amp;gt;
    &amp;lt;/div&amp;gt;
    &amp;lt;input type=&amp;#34;submit&amp;#34; value=&amp;#34;Send Message!&amp;#34; /&amp;gt;
&amp;lt;/form&amp;gt;
</code></pre><p>At this point you should be able to run the code and get a basic contact form. Try to submit the form and it will fail, though, because we don't have a method that consumes post requests. In a real project we'd obviously want to style the page, and we would also want to add the tag helpers for the whole project by using a <code>_ViewImports.cshtml</code>, but we'll stay focused on getting it functional for this example.</p>
<p>We will use <a href="https://github.com/jstedfast/MailKit">MailKit</a> to send an email from and to an address of our choosing on the backend. So add MailKit via Nuget. Then create
some container classes to hold Email related information like so (add them in the <code>Models</code> folder):</p>
<p>For the basic address information:</p>
<pre tabindex="0"><code>namespace BasicContactForm.Models
{
    public class EmailAddress
    {
        public string Name { get; set; }
        public string Address { get; set; }
    }
}
</code></pre><p>For the message:</p>
<pre tabindex="0"><code>using System.Collections.Generic;

namespace BasicContactForm.Models
{
    public class EmailMessage
    {
        public List&amp;lt;EmailAddress&amp;gt; ToAddresses { get; set; } = new List&amp;lt;EmailAddress&amp;gt;();
        public List&amp;lt;EmailAddress&amp;gt; FromAddresses { get; set; } = new List&amp;lt;EmailAddress&amp;gt;();
        public string Subject { get; set; }
        public string Content { get; set; }
    }
}
</code></pre><p>Finally, we need some information about the configuration of the SmtpServer. The conventional port is 587, so I've included an optional constructor argument to change that:</p>
<pre tabindex="0"><code>namespace BasicContactForm.Models
{
    public class EmailServerConfiguration
    {
        public EmailServerConfiguration(int _smtpPort = 587)
        {
            SmtpPort = _smtpPort;
        }

        public string SmtpServer { get; set; }
        public int SmtpPort { get; }
        public string SmtpUsername { get; set; }
        public string SmtpPassword { get; set; }
    }
}
</code></pre><p>MailKit is a dependency. It appears to be a very functional dependency, but since it is &quot;out of our hands,&quot; it would be wise to set up our code to not rely on its functionality going forward.
Interfaces to the rescue. We'll create an interface and take advantage of the auto-magical dependency injection feature that asp provides (later):</p>
<pre tabindex="0"><code>namespace BasicContactForm.Models
{
    public interface IEmailService
    {
        void Send(EmailMessage message);
    }
}
</code></pre><p>The MailKit implementation will take information about the server in the constructor, and we'll use the same auto-magic DI feature in a bit:</p>
<pre tabindex="0"><code>using System.Linq;
using MimeKit;

namespace BasicContactForm.Models
{
    public class MailKitEmailService : IEmailService
    {
        private readonly EmailServerConfiguration _eConfig;

        public MailKitEmailService(EmailServerConfiguration config)
        {
            _eConfig = config;
        }

        public void Send(EmailMessage msg)
        {
            var message = new MimeMessage();
            message.To.AddRange(msg.ToAddresses.Select(x =&amp;gt; new MailboxAddress(x.Name, x.Address)));
            message.From.AddRange(msg.FromAddresses.Select(x =&amp;gt; new MailboxAddress(x.Name, x.Address)));

            message.Subject = msg.Subject;

            message.Body = new TextPart(&amp;#34;plain&amp;#34;)
            {
                Text = msg.Content
            };

            using (var client = new MailKit.Net.Smtp.SmtpClient())
            {
                client.Connect(_eConfig.SmtpServer, _eConfig.SmtpPort);

                client.AuthenticationMechanisms.Remove(&amp;#34;XOAUTH2&amp;#34;);

                client.Authenticate(_eConfig.SmtpUsername, _eConfig.SmtpPassword);

                client.Send(message);
                client.Disconnect(true);
            }
        }
    }
}
</code></pre><p>To reduce a burden on future potential changes, as well as to improve testing capabilities, we'll apply the dependency injection in the startup class. It could now look like this:</p>
<pre tabindex="0"><code>using BasicContactForm.Models;
using Microsoft.AspNetCore.Builder;
using Microsoft.AspNetCore.Hosting;
using Microsoft.Extensions.DependencyInjection;

namespace BasicContactForm
{
    public class Startup
    {
        public void ConfigureServices(IServiceCollection services)
        {
            EmailServerConfiguration config = new EmailServerConfiguration
            {
                SmtpPassword = &amp;#34;Password&amp;#34;,
                SmtpServer = &amp;#34;smtp.someserver.com&amp;#34;,
                SmtpUsername = &amp;#34;awesomeemail@nickolasfisher.com&amp;#34;
            };

            EmailAddress FromEmailAddress = new EmailAddress
            {
                Address = &amp;#34;myemailaddress@somesite.com&amp;#34;,
                Name = &amp;#34;Nick Fisher&amp;#34;
            };

            services.AddSingleton&amp;lt;EmailServerConfiguration&amp;gt;(config);
            services.AddTransient&amp;lt;IEmailService, MailKitEmailService&amp;gt;();
            services.AddSingleton&amp;lt;EmailAddress&amp;gt;(FromEmailAddress);
            services.AddMvc();
        }

        public void Configure(IApplicationBuilder app, IHostingEnvironment env)
        {
            app.UseMvcWithDefaultRoute();
        }
    }
}
</code></pre><p>We will update our HomeController to consume the necessary arguments in the constructor and to send the email to wherever we want.
For this example, we'll send an email to ourselves.</p>
<pre tabindex="0"><code>using BasicContactForm.Models;
using Microsoft.AspNetCore.Mvc;
using System.Collections.Generic;

namespace BasicContactForm.Controllers
{
    public class HomeController : Controller
    {
        private EmailAddress FromAndToEmailAddress;
        private IEmailService EmailService;
        public HomeController(EmailAddress _fromAddress,
            IEmailService _emailService)
        {
            FromAndToEmailAddress = _fromAddress;
            EmailService = _emailService;
        }

        [HttpGet]
        public ViewResult Index()
        {
            return View();
        }

        [HttpPost]
        public IActionResult Index(ContactFormModel model)
        {
            if (ModelState.IsValid)
            {
                EmailMessage msgToSend = new EmailMessage
                {
                    FromAddresses = new List&amp;lt;EmailAddress&amp;gt; { FromAndToEmailAddress },
                    ToAddresses = new List&amp;lt;EmailAddress&amp;gt; { FromAndToEmailAddress },
                    Content = $&amp;#34;Here is your message: Name: {model.Name}, &amp;#34; &amp;#43;
                        $&amp;#34;Email: {model.Email}, Message: {model.Message}&amp;#34;,
                    Subject = &amp;#34;Contact Form - BasicContactForm App&amp;#34;
                };

                EmailService.Send(msgToSend);
                return RedirectToAction(&amp;#34;Index&amp;#34;);
            }
            else
            {
                return Index();
            }
        }
    }
}
</code></pre><p>Enter valid server credentials in the startup class and we're good to go! A few notes:</p>
<ol>
<li>
<p>If you're using gmail, you will have to <a href="https://support.google.com/accounts/answer/6010255?hl=en">let less secure apps use your account</a>.
Alternatively, you can jump through some more hoops to make your app more secure. In production it's probably wise to choose the latter.</p>
</li>
<li>
<p>If you are testing locally, antivirus software can often intercept the initial secure handshake that MailKit tries to make. In my case, I disabled Avast while testing
and the emails went through without a hitch.</p>
</li>
<li>
<p>Consider handing off to another thread to actually send the email as it can take some time depending on the environment/resources available.</p>
</li>
<li>
<p>In practice, you will want to redirect to a different page, usually a &quot;thanks for contacting us&quot; page, which will tell the user that their message was received.</p>
</li>
<li>
<p>I would recommend having an appsettings.Development.json file and an appsettings.Production.json file, each with emails you don't regularly use do regularly use, respectively.
This will allow you to test locally, and when you publish to production it will load the new settings.</p>
</li>
</ol>
<p>I hope you enjoyed this post. Please get ahold of me if you need clarification or if you think I've made an error.</p>
</section>

  
    
  

    
  


  <footer>
    
      <div class="pb-14 taxonomy-list tags-list">
      
        <a href="/tags/c%23/" alt="C#">
          C#
        </a>
      
        <a href="/tags/.net-core-mvc/" alt=".NET Core MVC">
          .NET Core MVC
        </a>
      
      </div>
    
  </footer>
</article>


    </main><footer class="pt-5 pb-10 grid gap-3 sm:grid-cols-2">
    <div class="text-xs font-semibold text-gray-500 order-2 sm:order-1">
  © 2018-2025 —
  <a href="http://localhost:1313/">Nick Fisher&#39;s tech blog</a> 
</div>

    <div class="order-1 sm:order-2">
  <ul class="flex sm:justify-end gap-5">
    
    
    <li>    
      <a href="https://www.linkedin.com/in/nick-fisher-software/" target="_blank" rel="noopener noreferrer">LinkedIn</a>
    </li>
    
    <li>    
      <a href="https://github.com/nfisher23" target="_blank" rel="noopener noreferrer">GitHub</a>
    </li>
    
    
  </ul>
</div>

</footer></body>
</html>
