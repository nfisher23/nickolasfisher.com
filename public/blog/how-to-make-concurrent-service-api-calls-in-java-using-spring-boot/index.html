<!doctype html><html lang=en-US class="scroll-smooth dark"><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>How to Make Concurrent Service API Calls in Java Using Spring Boot</title>
<meta name=description content="The source code for this post can be found on GitHub.
When you&rsquo;re in a microservice environment, it often makes sense to make some calls to multiple services at the same time. This allows for the time an operation needs to complete to be reduced from the sum of all the time spent waiting to the maximum time spent over the span of calls."><link rel=canonical href=https://www.nickolasfisher.com/blog/how-to-make-concurrent-service-api-calls-in-java-using-spring-boot/><link rel=robots href=/robots.txt><link rel=icon type=image/x-icon href=/img/nficon.png><script type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type=text/x-mathjax-config>MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });</script><link rel=stylesheet href="https://www.nickolasfisher.com/css/app.min.dee9c4afb37cb95c5d39c976614ef6f95398bcba4b6e73066c44de2a3a6543ed.css"></head><body class="max-w-screen-md mx-auto px-2.5"><div class=header><header class="flex flex-col sm:flex-row items-center gap-5 sm:gap-10 pt-16 py-12"><div class="flex-none w-20 h-20 rounded-full overflow-hidden"><a href=https://www.nickolasfisher.com/><img srcset="/img/profile-picture_hu4241499301404582006.jpg 80w" src=/img/profile-picture.jpg width=386 height=345 alt="Nick Fisher's tech blog"></a></div><div class="flex flex-col gap-5"><a href=https://www.nickolasfisher.com/><h1 id=site-title>Nick Fisher's tech blog</h1></a><nav><ul><li><a href=/>home</a></li><li><a href=/blog>blog</a></li><li><a href=/about>about</a></li><li><a href=/tags>Tags</a></li></ul></nav></div></header><button class=toggle-theme aria-label="Toggle Theme" title="Toggle Theme" onclick=toggleTheme()>
<span class="theme-icon light"><svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75.0 11-7.5.0 3.75 3.75.0 017.5.0z"/></svg> </span><span class="theme-icon dark"><svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718.0 0118 15.75c-5.385.0-9.75-4.365-9.75-9.75.0-1.33.266-2.597.748-3.752A9.753 9.753.0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753.0 009.002-5.998z"/></svg> </span></button>
<script>document.addEventListener("DOMContentLoaded",function(){const e=localStorage.getItem("theme");setTheme(!e||e==="light"?"light":e)});function setTheme(e){const t=document.querySelector("html");localStorage.setItem("theme",e),e==="light"?(t.classList.contains("dark")&&document.querySelector("html").classList.remove("dark"),document.querySelector(".theme-icon.light").style.display="none",document.querySelector(".theme-icon.dark").style.display="block"):(t.classList.contains("dark")||document.querySelector("html").classList.add("dark"),document.querySelector(".theme-icon.dark").style.display="none",document.querySelector(".theme-icon.light").style.display="block")}function toggleTheme(){const e=localStorage.getItem("theme");setTheme(e==="light"?"dark":"light")}</script></div><main id=content><article class="flex flex-col gap-10"><header class="flex flex-col gap-2"><h2 class=title-large>How to Make Concurrent Service API Calls in Java Using Spring Boot</h2><div class=meta><time datetime="2019-06-22 20:48:30 +0000 UTC" title='Sat, Jun 22, 2019, 8:48 PM UTC'>22/06/2019 - Estimated reading time: 4 minutes</time></div></header><section><p>The source code for this post can be found <a href=https://github.com/nfisher23/java-concurrency-examples/tree/master>on GitHub</a>.</p><p>When you&rsquo;re in a microservice environment, it often makes sense to make some calls to multiple services at the same time. This allows for the time an operation needs to complete to be reduced from the <em>sum</em> of all the time spent waiting to the <em>maximum</em> time spent over the span of calls.</p><p>For example, let&rsquo;s say you make three calls in one service, and let&rsquo;s further say that all three can be called in any order. If:</p><ul><li>Call #1 takes 500ms</li><li>Call #2 takes 700ms</li><li>Call #3 takes 300ms</li></ul><p>Then, if you do not make those calls concurrently, then you will have to wait 500 + 700 + 300 = 1500ms. If, however, you make all three at the same time and wait for them to complete before returning, you will only incur the cost of waiting for the longest service. In this case, that is Call #2, and means you will have to wait a total of 700ms.</p><p>To demo one way to accomplish this in Spring Boot, we&rsquo;ll start by creating a service that simulates a long running process. We&rsquo;ve done something similar to this in the post on <a href=https://nickolasfisher.com/blog/How-to-Use-Nginxs-Caching-to-Improve-Site-Responsiveness>caching in Nginx</a>. Go to the <a href=https://start.spring.io/>spring initializr</a> and select the &ldquo;Web&rdquo; dependency. In the resulting file, change the server port to be on 9000 by modifying the <strong>application.properties</strong>:</p><pre tabindex=0><code>server.port=9000
</code></pre><p>Then modify the entry point to look like this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>@SpringBootApplication
</span></span><span style=display:flex><span>@RestController
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd;font-style:italic>class</span> <span style=color:#50fa7b>SlowApplication</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd;font-style:italic>static</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>main</span>(String<span style=color:#ff79c6>[]</span> args) {
</span></span><span style=display:flex><span>        SpringApplication.<span style=color:#50fa7b>run</span>(SlowApplication.<span style=color:#50fa7b>class</span>, args);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    @GetMapping(<span style=color:#f1fa8c>&#34;/slow&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>public</span> String <span style=color:#50fa7b>slow</span>() <span style=color:#8be9fd;font-style:italic>throws</span> InterruptedException {
</span></span><span style=display:flex><span>        Thread.<span style=color:#50fa7b>sleep</span>(2000);
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> <span style=color:#f1fa8c>&#34;{\&#34;hello\&#34;:\&#34;hello\&#34;}&#34;</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This returns a very simple JSON object after a time delay of two seconds, simulating a service that takes awhile to respond.</p><h3 id=making-concurrent-calls>Making Concurrent Calls</h3><p>Now we&rsquo;ll create a service to consume this simple slow server, sending off a few calls and waiting for all of them to complete before returning.</p><p>Go back to the spring initializer, and select no additional dependencies. We&rsquo;ll illustrate this with a command line runner.</p><p>You will need to add a few to your <strong>pom.xml</strong>, if your using maven:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=display:flex><span>        <span style=color:#ff79c6>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&lt;groupId&gt;</span>com.fasterxml.jackson.core<span style=color:#ff79c6>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&lt;artifactId&gt;</span>jackson-databind<span style=color:#ff79c6>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&lt;/dependency&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&lt;dependency&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&lt;groupId&gt;</span>org.springframework<span style=color:#ff79c6>&lt;/groupId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&lt;artifactId&gt;</span>spring-web<span style=color:#ff79c6>&lt;/artifactId&gt;</span>
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>&lt;version&gt;</span>5.1.8.RELEASE<span style=color:#ff79c6>&lt;/version&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>&lt;/dependency&gt;</span>
</span></span></code></pre></div><p>We will use the rest template to send calls to the other service, and we will use Jackson to deserialize the response for us.</p><p>We will need an <a href=https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/concurrent/Executor.html>executor</a> to spin up threads that our application can use, and we also need to add an <strong>@EnableAsync</strong> annotation to the entrypoint:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>@SpringBootApplication
</span></span><span style=display:flex><span>@EnableAsync
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd;font-style:italic>class</span> <span style=color:#50fa7b>ConcurrentcallsApplication</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd;font-style:italic>static</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>main</span>(String<span style=color:#ff79c6>[]</span> args) {
</span></span><span style=display:flex><span>        SpringApplication.<span style=color:#50fa7b>run</span>(ConcurrentcallsApplication.<span style=color:#50fa7b>class</span>, args);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    @Bean
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>public</span> RestTemplate <span style=color:#50fa7b>restTemplate</span>() {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>new</span> RestTemplate();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    @Bean
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>public</span> Executor <span style=color:#50fa7b>executor</span>() {
</span></span><span style=display:flex><span>        ThreadPoolTaskExecutor executor <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> ThreadPoolTaskExecutor();
</span></span><span style=display:flex><span>        executor.<span style=color:#50fa7b>setCorePoolSize</span>(5);
</span></span><span style=display:flex><span>        executor.<span style=color:#50fa7b>setMaxPoolSize</span>(5);
</span></span><span style=display:flex><span>        executor.<span style=color:#50fa7b>setQueueCapacity</span>(500);
</span></span><span style=display:flex><span>        executor.<span style=color:#50fa7b>initialize</span>();
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> executor;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>We can then create a service class that will make calls to our other, &ldquo;slow&rdquo; microservice:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>@Service
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd;font-style:italic>class</span> <span style=color:#50fa7b>SlowServiceCaller</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    @Autowired
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>private</span> RestTemplate restTemplate;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    @Async
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>public</span> CompletableFuture<span style=color:#ff79c6>&lt;</span>JsonNode<span style=color:#ff79c6>&gt;</span> <span style=color:#50fa7b>callOtherService</span>() {
</span></span><span style=display:flex><span>        String localSlowServiceEndpoint <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;http://localhost:9000/slow&#34;</span>;
</span></span><span style=display:flex><span>        JsonNode responseObj <span style=color:#ff79c6>=</span> restTemplate.<span style=color:#50fa7b>getForObject</span>(localSlowServiceEndpoint, JsonNode.<span style=color:#50fa7b>class</span>);
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> CompletableFuture.<span style=color:#50fa7b>completedFuture</span>(responseObj);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>With this configuration, Spring will inject a proxy for every time <strong>SlowServiceCaller.callOtherService()</strong> is called, ensuring that the previously defined <strong>Executor</strong> is responsible for executing the calls. As long as we return a <strong>CompletableFuture</strong> here, it doesn&rsquo;t necessarily matter what we do. This could be a database query, this could be a compute-intensive process using in memory data, or any other potentially long running process. Here, obviously, we&rsquo;re firing off a network call.</p><p>To demonstrate this, we&rsquo;ll fire up a <strong>CommandLineRunner</strong> like so:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>@Component
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd;font-style:italic>class</span> <span style=color:#50fa7b>ConcurrentRunner</span> <span style=color:#8be9fd;font-style:italic>implements</span> CommandLineRunner {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    @Autowired
</span></span><span style=display:flex><span>    SlowServiceCaller slowServiceCaller;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    @Override
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>run</span>(String... args) <span style=color:#8be9fd;font-style:italic>throws</span> Exception {
</span></span><span style=display:flex><span>        Instant start <span style=color:#ff79c6>=</span> Instant.<span style=color:#50fa7b>now</span>();
</span></span><span style=display:flex><span>        List<span style=color:#ff79c6>&lt;</span>CompletableFuture<span style=color:#ff79c6>&lt;</span>JsonNode<span style=color:#ff79c6>&gt;&gt;</span> allFutures <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> ArrayList<span style=color:#ff79c6>&lt;&gt;</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>for</span> (<span style=color:#8be9fd>int</span> i <span style=color:#ff79c6>=</span> 0; i <span style=color:#ff79c6>&lt;</span> 10; i<span style=color:#ff79c6>++</span>) {
</span></span><span style=display:flex><span>            allFutures.<span style=color:#50fa7b>add</span>(slowServiceCaller.<span style=color:#50fa7b>callOtherService</span>());
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        CompletableFuture.<span style=color:#50fa7b>allOf</span>(allFutures.<span style=color:#50fa7b>toArray</span>(<span style=color:#ff79c6>new</span> CompletableFuture<span style=color:#ff79c6>[</span>0<span style=color:#ff79c6>]</span>)).<span style=color:#50fa7b>join</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>for</span> (<span style=color:#8be9fd>int</span> i <span style=color:#ff79c6>=</span> 0; i <span style=color:#ff79c6>&lt;</span> 10; i<span style=color:#ff79c6>++</span>) {
</span></span><span style=display:flex><span>            System.<span style=color:#50fa7b>out</span>.<span style=color:#50fa7b>println</span>(<span style=color:#f1fa8c>&#34;response: &#34;</span> <span style=color:#ff79c6>+</span> allFutures.<span style=color:#50fa7b>get</span>(i).<span style=color:#50fa7b>get</span>().<span style=color:#50fa7b>toString</span>());
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        System.<span style=color:#50fa7b>out</span>.<span style=color:#50fa7b>println</span>(<span style=color:#f1fa8c>&#34;Total time: &#34;</span> <span style=color:#ff79c6>+</span> Duration.<span style=color:#50fa7b>between</span>(start, Instant.<span style=color:#50fa7b>now</span>()).<span style=color:#50fa7b>getSeconds</span>());
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Now, if you are sure to start up the slow service from before, you should see five calls get made in a batch, then another five calls after the threads release.</p><p>What do we expect to see here? Well, we have 5 threads in this process, and we know that the endpoint we are hitting will take about two seconds to respond. So, we should see a total time to completion of 4 seconds. Indeed, my stdout shows:</p><pre tabindex=0><code>response: {&#34;hello&#34;:&#34;hello&#34;}
response: {&#34;hello&#34;:&#34;hello&#34;}
response: {&#34;hello&#34;:&#34;hello&#34;}
response: {&#34;hello&#34;:&#34;hello&#34;}
response: {&#34;hello&#34;:&#34;hello&#34;}
response: {&#34;hello&#34;:&#34;hello&#34;}
response: {&#34;hello&#34;:&#34;hello&#34;}
response: {&#34;hello&#34;:&#34;hello&#34;}
response: {&#34;hello&#34;:&#34;hello&#34;}
response: {&#34;hello&#34;:&#34;hello&#34;}
Total time: 4
</code></pre><p><strong>Further Suggested Reading:</strong></p><ul><li><a href=https://spring.io/guides/gs/async-method/>Async Calls in Spring Boot</a></li></ul></section><footer><div class="pb-14 taxonomy-list tags-list"><a href=/tags/java/ alt=Java>Java
</a><a href=/tags/spring/ alt=Spring>Spring
</a><a href=/tags/concurrency/ alt=Concurrency>Concurrency</a></div></footer></article></main><footer class="pt-5 pb-10 grid gap-3 sm:grid-cols-2"><div class="text-xs font-semibold text-gray-500 order-2 sm:order-1">© 2018-2025 —
<a href=https://www.nickolasfisher.com/>Nick Fisher's tech blog</a></div><div class="order-1 sm:order-2"><ul class="flex sm:justify-end gap-5"><li><a href=https://www.linkedin.com/in/nick-fisher-software/ target=_blank rel="noopener noreferrer">LinkedIn</a></li><li><a href=https://github.com/nfisher23 target=_blank rel="noopener noreferrer">GitHub</a></li></ul></div></footer></body></html>