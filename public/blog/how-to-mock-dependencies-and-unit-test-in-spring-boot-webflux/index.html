<!DOCTYPE html>
<html lang="en-US" class="scroll-smooth dark">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>

<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>How to Mock Dependencies and Unit Test in Spring Boot Webflux</title>
<meta
  name="description"
  content="The source code for this post can be found on Github.
The most straightforward way to write unit tests in spring boot webflux is to leverage project reactor&#39;s StepVerifier. StepVerifier allows you to pull each item in a Flux or the only potential item in a Mono and make assertions about each item as it&#39;s pulled through the chain, or make assertions about certain errors that should be thrown in the process. I&#39;m going to quickly walk you through an example integrating mockito with it and webflux."
/>
<link rel="canonical" href="http://localhost:1313/blog/how-to-mock-dependencies-and-unit-test-in-spring-boot-webflux/" />
<link rel="robots" href="/robots.txt" />

<link rel="icon" type="image/x-icon" href="/img/nficon.png" />



<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });</script>

<link rel="stylesheet" href="http://localhost:1313/css/app.css" /></head>

  <body class="max-w-screen-md mx-auto px-2.5">
    <div class="header">
      <header class="flex flex-col sm:flex-row items-center gap-5 sm:gap-10 pt-16 py-12">
   


<div class="flex-none w-20 h-20 rounded-full overflow-hidden">
  <a href="http://localhost:1313/">
    <img
      srcset="/img/profile-picture_hu4241499301404582006.jpg 80w"
      src="/img/profile-picture.jpg"
      width="386"
      height="345"
      alt="Nick Fisher&#39;s tech blog"
    />
  </a>
</div>

  
  <div class="flex flex-col gap-5">
    <a href="http://localhost:1313/">
  <h1 id="site-title">Nick Fisher&#39;s tech blog</h1>
</a>
 
    <nav>
  <ul>
     
    
    <li>
      <a href="/" class="">
        home
      </a>
    </li>
    
    <li>
      <a href="/blog" class="">
        blog
      </a>
    </li>
    
    <li>
      <a href="/about" class="">
        about
      </a>
    </li>
    
    <li>
      <a href="/tags" class="">
        Tags
      </a>
    </li>
    
  </ul>
</nav>

  </div>
</header>

      <button class="toggle-theme" aria-label="Toggle Theme" title="Toggle Theme" onclick="toggleTheme()">
  <span class="theme-icon light"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
</svg> </span>
  <span class="theme-icon dark"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
</svg> </span>
</button>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const theme = localStorage.getItem('theme');

    if (!theme || theme === 'light') {
      setTheme('light');
    } else {
      setTheme(theme);
    }
  });

  function setTheme(theme) {
    const html = document.querySelector('html');
    localStorage.setItem('theme', theme);

    if (theme === 'light') {
      if (html.classList.contains('dark')) {
        document.querySelector('html').classList.remove('dark');
      }

      document.querySelector('.theme-icon.light').style.display = 'none';
      document.querySelector('.theme-icon.dark').style.display = 'block';
    } else {
      if (!html.classList.contains('dark')) {
        document.querySelector('html').classList.add('dark');
      }

      document.querySelector('.theme-icon.dark').style.display = 'none';
      document.querySelector('.theme-icon.light').style.display = 'block';
    }
  }

  function toggleTheme() {
    const theme = localStorage.getItem('theme');

    if (theme === 'light') {
      setTheme('dark');
    } else {
      setTheme('light');
    }
  }
</script>
    </div>
  
    <main id="content">

<article class="flex flex-col gap-10">
  <header class="flex flex-col gap-2">
    <h2 class="title-large">How to Mock Dependencies and Unit Test in Spring Boot Webflux</h2>

    <div class="meta">
      
      <time datetime="2020-08-08 22:14:53 &#43;0000 UTC" title='Sat, Aug 8, 2020, 10:14 PM UTC'>
        08/08/2020 - Estimated reading time: 4 minutes
      </time>

       
      
    </div>
  </header>

  

  <section><p>The source code for this post can be found <a href="https://github.com/nfisher23/reactive-programming-webflux/tree/master/mocking-and-unit-testing">on Github</a>.</p>
<p>The most straightforward way to write unit tests in spring boot webflux is to leverage <a href="https://projectreactor.io/docs/test/release/api/reactor/test/StepVerifier.html">project reactor's StepVerifier</a>. StepVerifier allows you to pull each item in a <strong>Flux</strong> or the only potential item in a <strong>Mono</strong> and make assertions about each item as it's pulled through the chain, or make assertions about certain errors that should be thrown in the process. I'm going to quickly walk you through an example integrating mockito with it and webflux.</p>
<h2 id="bootstrap-the-project">Bootstrap the Project</h2>
<p>We're going to make a single endpoint whose job is to filter the results from a downstream call to prevent sensitive information from travelling arbitrarily to the client.</p>
<p>Go to the <a href="https://start.spring.io/">spring initializr</a> and select the reactive web option. After you have unzipped it, let's set up our data models, service, web client config, and controller:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">DownstreamResponseDTO</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> String firstName;
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> String lastName;
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> String ssn;
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> String deepesetFear;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> String <span style="color:#50fa7b">getFirstName</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> firstName;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">setFirstName</span>(String firstName) {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">this</span>.<span style="color:#50fa7b">firstName</span> <span style="color:#ff79c6">=</span> firstName;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> String <span style="color:#50fa7b">getLastName</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> lastName;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">setLastName</span>(String lastName) {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">this</span>.<span style="color:#50fa7b">lastName</span> <span style="color:#ff79c6">=</span> lastName;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> String <span style="color:#50fa7b">getSsn</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> ssn;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">setSsn</span>(String ssn) {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">this</span>.<span style="color:#50fa7b">ssn</span> <span style="color:#ff79c6">=</span> ssn;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> String <span style="color:#50fa7b">getDeepesetFear</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> deepesetFear;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">setDeepesetFear</span>(String deepesetFear) {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">this</span>.<span style="color:#50fa7b">deepesetFear</span> <span style="color:#ff79c6">=</span> deepesetFear;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>....<span style="color:#50fa7b">different</span> file...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">PersonDTO</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> String firstName;
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> String lastName;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> String <span style="color:#50fa7b">getFirstName</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> firstName;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">setFirstName</span>(String firstName) {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">this</span>.<span style="color:#50fa7b">firstName</span> <span style="color:#ff79c6">=</span> firstName;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> String <span style="color:#50fa7b">getLastName</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> lastName;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">setLastName</span>(String lastName) {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">this</span>.<span style="color:#50fa7b">lastName</span> <span style="color:#ff79c6">=</span> lastName;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>As we can see, the downstream service will respond with the users SSN and deepest fear. Let's say for the sake of this example that our clients don't need that information. Here's our controller:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@RestController
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">MyController</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd;font-style:italic">final</span> MyService service;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#50fa7b">MyController</span>(MyService service) {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">this</span>.<span style="color:#50fa7b">service</span> <span style="color:#ff79c6">=</span> service;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @GetMapping(<span style="color:#ff79c6">&amp;</span>#34;<span style="color:#ff79c6">/</span>persons<span style="color:#ff79c6">&amp;</span>#34;)
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> Flux<span style="color:#ff79c6">&amp;</span>lt;PersonDTO<span style="color:#ff79c6">&amp;</span>gt; getPersons() {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> service.<span style="color:#50fa7b">getAllPeople</span>().<span style="color:#50fa7b">map</span>(downstreamResponseDTO <span style="color:#ff79c6">-&amp;</span>gt; {
</span></span><span style="display:flex;"><span>            PersonDTO personDTO <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> PersonDTO();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            personDTO.<span style="color:#50fa7b">setFirstName</span>(downstreamResponseDTO.<span style="color:#50fa7b">getFirstName</span>());
</span></span><span style="display:flex;"><span>            personDTO.<span style="color:#50fa7b">setLastName</span>(downstreamResponseDTO.<span style="color:#50fa7b">getLastName</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#ff79c6">return</span> personDTO;
</span></span><span style="display:flex;"><span>        });
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>And our service:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Service
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">MyService</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd;font-style:italic">final</span> WebClient webClient;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#50fa7b">MyService</span>(WebClient webClient) {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">this</span>.<span style="color:#50fa7b">webClient</span> <span style="color:#ff79c6">=</span> webClient;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> Flux<span style="color:#ff79c6">&amp;</span>lt;DownstreamResponseDTO<span style="color:#ff79c6">&amp;</span>gt; getAllPeople() {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> <span style="color:#ff79c6">this</span>.<span style="color:#50fa7b">webClient</span>.<span style="color:#50fa7b">get</span>()
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">uri</span>(<span style="color:#ff79c6">&amp;</span>#34;<span style="color:#ff79c6">/</span>legacy<span style="color:#ff79c6">/</span>persons<span style="color:#ff79c6">&amp;</span>#34;)
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">retrieve</span>()
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">bodyToFlux</span>(DownstreamResponseDTO.<span style="color:#50fa7b">class</span>);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Finally, the webclient config, which is actually not useful to this tutorial but we can include for completeness:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Configuration
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">MyConfig</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Bean
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> WebClient <span style="color:#50fa7b">webClient</span>() {
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">return</span> WebClient.<span style="color:#50fa7b">builder</span>()
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">baseUrl</span>(<span style="color:#ff79c6">&amp;</span>#34;http:<span style="color:#6272a4">//localhost:9000&amp;#34;)</span>
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">defaultHeader</span>(CONTENT_TYPE, MediaType.<span style="color:#50fa7b">APPLICATION_JSON_VALUE</span>)
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">build</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Alright. Now, to write a unit test for this, we will mock out our service layer and have it respond with some mocked out values. This is pretty straightforward to do with mockito:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">MyControllerTest</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> MyService myServiceMock;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> MyController myController;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @BeforeEach
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">setup</span>() {
</span></span><span style="display:flex;"><span>        myServiceMock <span style="color:#ff79c6">=</span> Mockito.<span style="color:#50fa7b">mock</span>(MyService.<span style="color:#50fa7b">class</span>);
</span></span><span style="display:flex;"><span>        myController <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> MyController(myServiceMock);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Test
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">verifyTransformsCorrectly</span>() {
</span></span><span style="display:flex;"><span>        DownstreamResponseDTO downstreamResponseDTO_1 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> DownstreamResponseDTO();
</span></span><span style="display:flex;"><span>        downstreamResponseDTO_1.<span style="color:#50fa7b">setFirstName</span>(<span style="color:#ff79c6">&amp;</span>#34;jack<span style="color:#ff79c6">&amp;</span>#34;);
</span></span><span style="display:flex;"><span>        downstreamResponseDTO_1.<span style="color:#50fa7b">setLastName</span>(<span style="color:#ff79c6">&amp;</span>#34;attack<span style="color:#ff79c6">&amp;</span>#34;);
</span></span><span style="display:flex;"><span>        downstreamResponseDTO_1.<span style="color:#50fa7b">setDeepesetFear</span>(<span style="color:#ff79c6">&amp;</span>#34;spiders<span style="color:#ff79c6">&amp;</span>#34;);
</span></span><span style="display:flex;"><span>        downstreamResponseDTO_1.<span style="color:#50fa7b">setSsn</span>(<span style="color:#ff79c6">&amp;</span>#34;123<span style="color:#ff79c6">-</span>45<span style="color:#ff79c6">-</span>6789<span style="color:#ff79c6">&amp;</span>#34;);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        DownstreamResponseDTO downstreamResponseDTO_2 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> DownstreamResponseDTO();
</span></span><span style="display:flex;"><span>        downstreamResponseDTO_2.<span style="color:#50fa7b">setFirstName</span>(<span style="color:#ff79c6">&amp;</span>#34;karen<span style="color:#ff79c6">&amp;</span>#34;);
</span></span><span style="display:flex;"><span>        downstreamResponseDTO_2.<span style="color:#50fa7b">setLastName</span>(<span style="color:#ff79c6">&amp;</span>#34;cool<span style="color:#ff79c6">&amp;</span>#34;);
</span></span><span style="display:flex;"><span>        downstreamResponseDTO_2.<span style="color:#50fa7b">setDeepesetFear</span>(<span style="color:#ff79c6">&amp;</span>#34;snakes<span style="color:#ff79c6">&amp;</span>#34;);
</span></span><span style="display:flex;"><span>        downstreamResponseDTO_2.<span style="color:#50fa7b">setSsn</span>(<span style="color:#ff79c6">&amp;</span>#34;000<span style="color:#ff79c6">-</span>00<span style="color:#ff79c6">-</span>0000<span style="color:#ff79c6">&amp;</span>#34;);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Mockito.<span style="color:#50fa7b">when</span>(myServiceMock.<span style="color:#50fa7b">getAllPeople</span>())
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">thenReturn</span>(Flux.<span style="color:#50fa7b">just</span>(downstreamResponseDTO_1, downstreamResponseDTO_2));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        StepVerifier.<span style="color:#50fa7b">create</span>(myController.<span style="color:#50fa7b">getPersons</span>())
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">expectNextMatches</span>(personDTO <span style="color:#ff79c6">-&amp;</span>gt; personDTO.<span style="color:#50fa7b">getLastName</span>().<span style="color:#50fa7b">equals</span>(downstreamResponseDTO_1.<span style="color:#50fa7b">getLastName</span>())
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">&amp;</span>amp;<span style="color:#ff79c6">&amp;</span>amp; personDTO.<span style="color:#50fa7b">getFirstName</span>().<span style="color:#50fa7b">equals</span>(downstreamResponseDTO_1.<span style="color:#50fa7b">getFirstName</span>()))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">expectNextMatches</span>(personDTO <span style="color:#ff79c6">-&amp;</span>gt; personDTO.<span style="color:#50fa7b">getLastName</span>().<span style="color:#50fa7b">equals</span>(downstreamResponseDTO_2.<span style="color:#50fa7b">getLastName</span>())
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">&amp;</span>amp;<span style="color:#ff79c6">&amp;</span>amp; personDTO.<span style="color:#50fa7b">getFirstName</span>().<span style="color:#50fa7b">equals</span>(downstreamResponseDTO_2.<span style="color:#50fa7b">getFirstName</span>()))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">verifyComplete</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The key parts we are looking at are towards the end of <strong>verifyTransformsCorrectly</strong>, where we first say that &quot;any call to <strong>myServiceMock.getAllPeople()</strong> will respond with
a <strong>Flux</strong> of <strong>DownstreamResponseDTO</strong> s.&quot; By putting it into the step verifier, it will handle subscribing for us and ensuring that each item gets pulled through appropriately.
We finally assert that the first and last name of the mocked out objects are indeed mapped to the correct fields on the <strong>PersonDTO</strong>.</p>
<p>That basic structure should handle 80% of your unit testing needs in webflux. If you want to run these tests you can simply:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mvn clean install
</span></span></code></pre></div><p>As a reminder, feel free to check out the <a href="https://github.com/nfisher23/reactive-programming-webflux/tree/master/mocking-and-unit-testing">source code for this post on Github</a>.</p>
<p><strong>Important Update</strong>: There is a follow up article on how to <a href="https://nickolasfisher.com/blog/How-to-Unit-Test-that-a-Reactor-Mono-was-Actually-Subscribed-to">ensure that your reactor Publisher is actually getting subscribed to</a>, rather than just the method that returns the mono being called, which I would recommend anyone new to testing in reactor read and understand.</p>
</section>

  
    
  

    
  


  <footer>
    
      <div class="pb-14 taxonomy-list tags-list">
      
        <a href="/tags/java/" alt="Java">
          Java
        </a>
      
        <a href="/tags/spring/" alt="Spring">
          Spring
        </a>
      
        <a href="/tags/reactive/" alt="Reactive">
          Reactive
        </a>
      
        <a href="/tags/webflux/" alt="Webflux">
          Webflux
        </a>
      
      </div>
    
  </footer>
</article>


    </main><footer class="pt-5 pb-10 grid gap-3 sm:grid-cols-2">
    <div class="text-xs font-semibold text-gray-500 order-2 sm:order-1">
  © 2018-2025 —
  <a href="http://localhost:1313/">Nick Fisher&#39;s tech blog</a> 
</div>

    <div class="order-1 sm:order-2">
  <ul class="flex sm:justify-end gap-5">
    
    
    <li>    
      <a href="https://www.linkedin.com/in/nick-fisher-software/" target="_blank" rel="noopener noreferrer">LinkedIn</a>
    </li>
    
    <li>    
      <a href="https://github.com/nfisher23" target="_blank" rel="noopener noreferrer">GitHub</a>
    </li>
    
    
  </ul>
</div>

</footer></body>
</html>
