<!DOCTYPE html>
<html lang="en-US" class="scroll-smooth dark">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>

<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>How to Provision a Linux VM With Kibana Using Ansible</title>
<meta
  name="description"
  content="The corresponding source code for this post is available on GitHub.
Kibana is a fancy pants web application that tries to make data in Elasticsearch user-friendly. Rounding out the previous two posts on how to install an elasticsearch cluster and how to install multiple logstash hosts, I will now show you how to stack kibana on top of them."
/>
<link rel="canonical" href="http://localhost:1313/blog/how-to-provision-a-linux-vm-with-kibana-using-ansible/" />
<link rel="robots" href="/robots.txt" />

<link rel="icon" type="image/x-icon" href="/img/nficon.png" />



<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });</script>

<link rel="stylesheet" href="http://localhost:1313/css/app.css" /></head>

  <body class="max-w-screen-md mx-auto px-2.5">
    <div class="header">
      <header class="flex flex-col sm:flex-row items-center gap-5 sm:gap-10 pt-16 py-12">
   


<div class="flex-none w-20 h-20 rounded-full overflow-hidden">
  <a href="http://localhost:1313/">
    <img
      srcset="/img/profile-picture_hu4241499301404582006.jpg 80w"
      src="/img/profile-picture.jpg"
      width="386"
      height="345"
      alt="Nick Fisher&#39;s tech blog"
    />
  </a>
</div>

  
  <div class="flex flex-col gap-5">
    <a href="http://localhost:1313/">
  <h1 id="site-title">Nick Fisher&#39;s tech blog</h1>
</a>
 
    <nav>
  <ul>
     
    
    <li>
      <a href="/" class="">
        home
      </a>
    </li>
    
    <li>
      <a href="/blog" class="">
        blog
      </a>
    </li>
    
    <li>
      <a href="/about" class="">
        about
      </a>
    </li>
    
    <li>
      <a href="/tags" class="">
        Tags
      </a>
    </li>
    
  </ul>
</nav>

  </div>
</header>

      <button class="toggle-theme" aria-label="Toggle Theme" title="Toggle Theme" onclick="toggleTheme()">
  <span class="theme-icon light"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
</svg> </span>
  <span class="theme-icon dark"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
</svg> </span>
</button>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const theme = localStorage.getItem('theme');

    if (!theme || theme === 'light') {
      setTheme('light');
    } else {
      setTheme(theme);
    }
  });

  function setTheme(theme) {
    const html = document.querySelector('html');
    localStorage.setItem('theme', theme);

    if (theme === 'light') {
      if (html.classList.contains('dark')) {
        document.querySelector('html').classList.remove('dark');
      }

      document.querySelector('.theme-icon.light').style.display = 'none';
      document.querySelector('.theme-icon.dark').style.display = 'block';
    } else {
      if (!html.classList.contains('dark')) {
        document.querySelector('html').classList.add('dark');
      }

      document.querySelector('.theme-icon.dark').style.display = 'none';
      document.querySelector('.theme-icon.light').style.display = 'block';
    }
  }

  function toggleTheme() {
    const theme = localStorage.getItem('theme');

    if (theme === 'light') {
      setTheme('dark');
    } else {
      setTheme('light');
    }
  }
</script>
    </div>
  
    <main id="content">

<article class="flex flex-col gap-10">
  <header class="flex flex-col gap-2">
    <h2 class="title-large">How to Provision a Linux VM With Kibana Using Ansible</h2>

    <div class="meta">
      
      <time datetime="2019-03-16 15:37:40 &#43;0000 UTC" title='Sat, Mar 16, 2019, 3:37 PM UTC'>
        16/03/2019 - Estimated reading time: 2 minutes
      </time>

       
      
    </div>
  </header>

  

  <section><p>The corresponding source code for this post is available <a href="https://github.com/nfisher23/some-ansible-examples">on GitHub</a>.</p>
<p><a href="https://www.elastic.co/products/kibana">Kibana</a> is a fancy pants web application that tries to make data in Elasticsearch user-friendly. Rounding out the previous two posts on <a href="https://nickolasfisher.com/blog/How-to-Provision-a-Multi-Node-Elasticsearch-Cluster-Using-Ansible">how to install an elasticsearch cluster</a> and <a href="https://nickolasfisher.com/blog/How-to-Install-Multiple-Logstash-Hosts-Using-Ansible">how to install multiple logstash hosts</a>, I will now show you how to stack kibana on top of them.</p>
<h3 id="create-the-ansible-role">Create the Ansible Role</h3>
<p>Navigate to the directory you want the ansible role to reside and type:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ molecule init role -d vagrant -r install-kibana
</span></span></code></pre></div><p>I'm using molecule to wrap vagrant and I'm calling this role install-kibana.</p>
<p>We will put kibana on a single host, 192.168.56.121. To make this happen, adjust the <em>platforms</em> section of your <strong>molecule/default/molecule.yml</strong> file to look like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ff79c6">platforms</span>:
</span></span><span style="display:flex;"><span>  - <span style="color:#ff79c6">name</span>: kibana
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">box</span>: ubuntu/xenial64
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">memory</span>: <span style="color:#bd93f9">4096</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">provider_raw_config_args</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ff79c6">&amp;#34;customize</span> [<span style="color:#ff79c6">&amp;#39;modifyvm&amp;#39;,</span> :id, &amp;#39;--uartmode1&amp;#39;, &amp;#39;disconnected&amp;#39;]&amp;#34;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">interfaces</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ff79c6">auto_config</span>: <span style="color:#ff79c6">true</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">network_name</span>: private_network
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">ip</span>: <span style="color:#bd93f9">192.168.56.121</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">type</span>: static
</span></span></code></pre></div><p>We provision this local VM with 4GB of RAM. You can bring up this VM at this point with:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ molecule create
</span></span></code></pre></div><p>First, we'll decide on the version of kibana we want to provision. To keep this compatible with the two posts mentioned above, we'll choose version 6.4.0, and update the <strong>vars/main.yml</strong> file to reflect the full name of the deb file we'll be grabbing in our playbook like so:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># vars file for install-kibana</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">kibana_deb_file</span>: kibana-6.4.0-amd64.deb
</span></span></code></pre></div><p>Our <strong>tasks/main.yml</strong> file can now look like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># tasks file for install-kibana</span>
</span></span><span style="display:flex;"><span>- <span style="color:#ff79c6">name</span>: download deb file
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">get_url</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">dest</span>: <span style="color:#ff79c6">&amp;#34;/etc/{{</span> kibana_deb_file }}&amp;#34;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">url</span>: <span style="color:#ff79c6">&amp;#34;https://artifacts.elastic.co/downloads/kibana/{{</span> kibana_deb_file }}&amp;#34;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">checksum</span>: <span style="color:#ff79c6">&amp;#34;sha512:https://artifacts.elastic.co/downloads/kibana/{{</span> kibana_deb_file }}.sha512&amp;#34;
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">become</span>: <span style="color:#ff79c6">yes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- <span style="color:#ff79c6">name</span>: install kibana from deb file
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">apt</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">deb</span>: <span style="color:#ff79c6">&amp;#34;/etc/{{</span> kibana_deb_file }}&amp;#34;
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">update_cache</span>: <span style="color:#ff79c6">yes</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">become</span>: <span style="color:#ff79c6">yes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>- <span style="color:#ff79c6">name</span>: send kibana config file
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">template</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">dest</span>: /etc/kibana/kibana.yml
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">src</span>: kibana.yml.j2
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">become</span>: <span style="color:#ff79c6">yes</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">notify</span>: restart kibana
</span></span></code></pre></div><p>You can see we're using a handler that restarts kibana, which is in the <strong>handlers/main.yml</strong> file like so:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># handlers file for install-kibana</span>
</span></span><span style="display:flex;"><span>- <span style="color:#ff79c6">name</span>: restart kibana
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">service</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">name</span>: kibana
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">state</span>: restarted
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">become</span>: <span style="color:#ff79c6">yes</span>
</span></span></code></pre></div><p>Finally, we will have to create a <strong>templates/kibana.yml.j2</strong> template, which as of right now is just a simple file:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ff79c6">elasticsearch.url</span>: <span style="color:#ff79c6">&amp;#34;http://192.168.56.102:9200&amp;#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">server.host</span>: <span style="color:#bd93f9">0.0.0.0</span>
</span></span></code></pre></div><p>Keeping it as a template makes extending it and extracting variables as the role gets more involved possible.</p>
<p>You should now be able to run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ molecule converge
</span></span></code></pre></div><p>And the playbook will install kibana successfully. Once it comes up, you should navigate to <a href="http://192.168.56.121:5601,">http://192.168.56.121:5601,</a> and you'll see kibana's home page. If you don't have any backing elasticsearch database, then you'll see an error, but bring on up at the port in the kibana.yml.j2 template and that error will go away.</p>
</section>

  
    
  

    
  


  <footer>
    
      <div class="pb-14 taxonomy-list tags-list">
      
        <a href="/tags/distributed-systems/" alt="Distributed Systems">
          Distributed Systems
        </a>
      
        <a href="/tags/vagrant/" alt="Vagrant">
          Vagrant
        </a>
      
        <a href="/tags/ansible/" alt="Ansible">
          Ansible
        </a>
      
        <a href="/tags/the-elastic-stack/" alt="The Elastic Stack">
          The Elastic Stack
        </a>
      
        <a href="/tags/devops/" alt="DevOps">
          DevOps
        </a>
      
        <a href="/tags/molecule/" alt="Molecule">
          Molecule
        </a>
      
      </div>
    
  </footer>
</article>


    </main><footer class="pt-5 pb-10 grid gap-3 sm:grid-cols-2">
    <div class="text-xs font-semibold text-gray-500 order-2 sm:order-1">
  © 2018-2025 —
  <a href="http://localhost:1313/">Nick Fisher&#39;s tech blog</a> 
</div>

    <div class="order-1 sm:order-2">
  <ul class="flex sm:justify-end gap-5">
    
    
    <li>    
      <a href="https://www.linkedin.com/in/nick-fisher-software/" target="_blank" rel="noopener noreferrer">LinkedIn</a>
    </li>
    
    <li>    
      <a href="https://github.com/nfisher23" target="_blank" rel="noopener noreferrer">GitHub</a>
    </li>
    
    
  </ul>
</div>

</footer></body>
</html>
