<!DOCTYPE html>
<html lang="en-US" class="scroll-smooth dark">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>

<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>How to Provision a Server with Java using Ansible</title>
<meta
  name="description"
  content="In my post about how to provision any version of Java using a bash script, we saw that:"
/>
<link rel="canonical" href="http://localhost:1313/blog/how-to-provision-a-server-with-java-using-ansible/" />
<link rel="robots" href="/robots.txt" />

<link rel="icon" type="image/x-icon" href="/img/nficon.png" />



<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });</script>

<link rel="stylesheet" href="http://localhost:1313/css/app.css" /></head>

  <body class="max-w-screen-md mx-auto px-2.5">
    <div class="header">
      <header class="flex flex-col sm:flex-row items-center gap-5 sm:gap-10 pt-16 py-12">
   


<div class="flex-none w-20 h-20 rounded-full overflow-hidden">
  <a href="http://localhost:1313/">
    <img
      srcset="/img/profile-picture_hu4241499301404582006.jpg 80w"
      src="/img/profile-picture.jpg"
      width="386"
      height="345"
      alt="Nick Fisher&#39;s tech blog"
    />
  </a>
</div>

  
  <div class="flex flex-col gap-5">
    <a href="http://localhost:1313/">
  <h1 id="site-title">Nick Fisher&#39;s tech blog</h1>
</a>
 
    <nav>
  <ul>
     
    
    <li>
      <a href="/" class="">
        home
      </a>
    </li>
    
    <li>
      <a href="/blog" class="">
        blog
      </a>
    </li>
    
    <li>
      <a href="/about" class="">
        about
      </a>
    </li>
    
    <li>
      <a href="/tags" class="">
        Tags
      </a>
    </li>
    
  </ul>
</nav>

  </div>
</header>

      <button class="toggle-theme" aria-label="Toggle Theme" title="Toggle Theme" onclick="toggleTheme()">
  <span class="theme-icon light"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
</svg> </span>
  <span class="theme-icon dark"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
</svg> </span>
</button>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const theme = localStorage.getItem('theme');

    if (!theme || theme === 'light') {
      setTheme('light');
    } else {
      setTheme(theme);
    }
  });

  function setTheme(theme) {
    const html = document.querySelector('html');
    localStorage.setItem('theme', theme);

    if (theme === 'light') {
      if (html.classList.contains('dark')) {
        document.querySelector('html').classList.remove('dark');
      }

      document.querySelector('.theme-icon.light').style.display = 'none';
      document.querySelector('.theme-icon.dark').style.display = 'block';
    } else {
      if (!html.classList.contains('dark')) {
        document.querySelector('html').classList.add('dark');
      }

      document.querySelector('.theme-icon.dark').style.display = 'none';
      document.querySelector('.theme-icon.light').style.display = 'block';
    }
  }

  function toggleTheme() {
    const theme = localStorage.getItem('theme');

    if (theme === 'light') {
      setTheme('dark');
    } else {
      setTheme('light');
    }
  }
</script>
    </div>
  
    <main id="content">

<article class="flex flex-col gap-10">
  <header class="flex flex-col gap-2">
    <h2 class="title-large">How to Provision a Server with Java using Ansible</h2>

    <div class="meta">
      
      <time datetime="2018-11-18 17:15:01 &#43;0000 UTC" title='Sun, Nov 18, 2018, 5:15 PM UTC'>
        18/11/2018 - Estimated reading time: 3 minutes
      </time>

       
      
    </div>
  </header>

  

  <section><p>In my post about <a href="https://nickolasfisher.com/blog/How-to-Provision-a-Linux-Server-With-Any-Version-of-Java-via-a-Bash-Script">how to provision any version of Java using a bash script</a>, we saw that:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ff79c6">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#ff79c6"></span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># Get tarball for JDK 10.0.1</span>
</span></span><span style="display:flex;"><span>wget https://download.java.net/java/GA/jdk10/10.0.1/fb4372174a714e6b8c52526dc134031e/10/openjdk-10.0.1_linux-x64_bin.tar.gz
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># make java 10 directory</span>
</span></span><span style="display:flex;"><span>mkdir -p /usr/lib/java10
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># unpack tarball</span>
</span></span><span style="display:flex;"><span>tar -C /usr/lib/java10/ -xvzf ./openjdk-10.0.1_linux-x64_bin.tar.gz
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># update alternatives</span>
</span></span><span style="display:flex;"><span>update-alternatives --install /usr/bin/java java /usr/lib/java10/jdk-10.0.1/bin/java <span style="color:#bd93f9">20000</span>
</span></span><span style="display:flex;"><span>update-alternatives --install /usr/bin/javac javac /usr/lib/java10/jdk-10.0.1/bin/javac <span style="color:#bd93f9">20000</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># verify with a version check</span>
</span></span><span style="display:flex;"><span>java -version
</span></span></code></pre></div><p>Will get you openJDK version 10.0.1 from the tarball in the link.</p>
<p>While that script works, it&rsquo;s generally a better idea to make this more maintainable. For example, if we re-run this bash script on a server that is already provisioned, it will run all of these steps again. In this case, nothing bad will actually happen, but it can lead to some sticky debug sessions when we start to move to more complicated provisioning steps.</p>
<p>We&rsquo;ll convert this bash script to an <a href="https://www.ansible.com/">ansible</a> playbook. To test this, we&rsquo;ll set up a VagrantFile like so:</p>
<pre tabindex="0"><code>Vagrant.configure(&#34;2&#34;) do |config|
  config.vm.box = &#34;ubuntu/bionic64&#34;
  config.vm.network &#34;private_network&#34;, ip: &#34;192.168.56.115&#34;

  config.vm.provider :virtualbox do |vb|
    vb.memory = 1024
    vb.cpus = 1
  end

  config.vm.provision &#34;ansible&#34; do |ansible|
    ansible.playbook = &#34;provision.yml&#34;
  end
end
</code></pre><p>We&rsquo;ll need an ansible playbook in the same directory called &ldquo;provision.yml&rdquo;. We are using Ubuntu 18 (bionic64), which does not come with python 2 installed. Since ansible defaults to python 2, one way to deal with that problem is to install it prior to running the playbook. We can&rsquo;t gather facts before installing it, because gathering facts requires, you guessed it, python 2:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- <span style="color:#ff79c6">hosts</span>: all
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">become</span>: <span style="color:#ff79c6">yes</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">gather_facts</span>: <span style="color:#ff79c6">no</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">pre_tasks</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ff79c6">name</span>: <span style="color:#f1fa8c">&#39;install python2 on ubuntu 18&#39;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">raw</span>: test -e /usr/bin/python || (apt-get -y update &amp;amp;&amp;amp; apt-get install -y python-minimal)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">tasks</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ff79c6">name</span>: Gather facts
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">setup</span>:
</span></span></code></pre></div><p>This bash command checks if we have python first, and only updates and gets python-minimal if it&rsquo;s not already there. The empty <strong>setup:</strong> command runs the gathering of facts and we can proceed like we never had to do this weird pre-provisioning step in the first place.</p>
<p>We can convert these two steps to:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#6272a4"># Get tarball for JDK 10.0.1</span>
</span></span><span style="display:flex;"><span>wget https://download.java.net/java/GA/jdk10/10.0.1/fb4372174a714e6b8c52526dc134031e/10/openjdk-10.0.1_linux-x64_bin.tar.gz
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6272a4"># make java 10 directory</span>
</span></span><span style="display:flex;"><span>mkdir -p /usr/lib/java10
</span></span></code></pre></div><p>To:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>    - <span style="color:#ff79c6">name</span>: Get Java tarball
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">get_url</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">url</span>: https://download.java.net/java/GA/jdk10/10.0.1/fb4372174a714e6b8c52526dc134031e/10/openjdk-10.0.1_linux-x64_bin.tar.gz
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">dest</span>: /etc/open-jdk10.tar.gz
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ff79c6">name</span>: make java 10 directory
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">file</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">path</span>: /usr/lib/java10
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">state</span>: directory
</span></span></code></pre></div><p>Which uses ansible&rsquo;s get_url module to download the tarball and move it to the /etc/open-jdk10.tar.gz location, only downloading it if we haven&rsquo;t already done so. We then create the directory we eventually want to put java10 into</p>
<p>We can then convert:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#6272a4"># unpack tarball</span>
</span></span><span style="display:flex;"><span>tar -C /usr/lib/java10/ -xvzf ./openjdk-10.0.1_linux-x64_bin.tar.gz
</span></span></code></pre></div><p>Into:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>    - <span style="color:#ff79c6">name</span>: unpack tarball
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">unarchive</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">dest</span>: /usr/lib/java10
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">src</span>: /etc/open-jdk10.tar.gz
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">remote_src</span>: <span style="color:#ff79c6">yes</span>
</span></span></code></pre></div><p>This unpacks the tarball and places it into the directory previously created.</p>
<p>Finally, we will update alternatives (and, as a bonus, we&rsquo;ll set the JAVA_HOME environment variable):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>    - <span style="color:#ff79c6">name</span>: update alternatives for java
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">alternatives</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">name</span>: java
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">path</span>: /usr/lib/java10/jdk-10.0.1/bin/java
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">link</span>: /usr/bin/java
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">priority</span>: <span style="color:#bd93f9">20000</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ff79c6">name</span>: set java home as environment variable
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">blockinfile</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">insertafter</span>: EOF
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">path</span>: /etc/environment
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">block</span>: export JAVA_HOME=/usr/lib/java10/jdk-10.0.1
</span></span></code></pre></div><p>The final ansible playbook looks like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span>---
</span></span><span style="display:flex;"><span>- <span style="color:#ff79c6">hosts</span>: all
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">become</span>: <span style="color:#ff79c6">yes</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">gather_facts</span>: <span style="color:#ff79c6">no</span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">pre_tasks</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ff79c6">name</span>: <span style="color:#f1fa8c">&#39;install python2 on ubuntu 18&#39;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">raw</span>: test -e /usr/bin/python || (apt-get -y update &amp;amp;&amp;amp; apt-get install -y python-minimal)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">tasks</span>:
</span></span><span style="display:flex;"><span>    - <span style="color:#ff79c6">name</span>: Gather facts
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">setup</span>:
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ff79c6">name</span>: Get Java tarball
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">get_url</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">url</span>: https://download.java.net/java/GA/jdk10/10.0.1/fb4372174a714e6b8c52526dc134031e/10/openjdk-10.0.1_linux-x64_bin.tar.gz
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">dest</span>: /etc/open-jdk10.tar.gz
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ff79c6">name</span>: make java 10 directory
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">file</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">path</span>: /usr/lib/java10
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">state</span>: directory
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ff79c6">name</span>: unpack tarball
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">unarchive</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">dest</span>: /usr/lib/java10
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">src</span>: /etc/open-jdk10.tar.gz
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">remote_src</span>: <span style="color:#ff79c6">yes</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ff79c6">name</span>: update alternatives for java
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">alternatives</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">name</span>: java
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">path</span>: /usr/lib/java10/jdk-10.0.1/bin/java
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">link</span>: /usr/bin/java
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">priority</span>: <span style="color:#bd93f9">20000</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    - <span style="color:#ff79c6">name</span>: set java home as environment variable
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">blockinfile</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">insertafter</span>: EOF
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">path</span>: /etc/environment
</span></span><span style="display:flex;"><span>        <span style="color:#ff79c6">block</span>: export JAVA_HOME=/usr/lib/java10/jdk-10.0.1
</span></span></code></pre></div><p>Happy provisioning!</p>
</section>

  
    
  

    
  


  <footer>
    
      <div class="pb-14 taxonomy-list tags-list">
      
        <a href="/tags/java/" alt="Java">
          Java
        </a>
      
        <a href="/tags/ansible/" alt="Ansible">
          Ansible
        </a>
      
        <a href="/tags/devops/" alt="DevOps">
          DevOps
        </a>
      
      </div>
    
  </footer>
</article>


    </main><footer class="pt-5 pb-10 grid gap-3 sm:grid-cols-2">
    <div class="text-xs font-semibold text-gray-500 order-2 sm:order-1">
  © 2018-2025 —
  <a href="http://localhost:1313/">Nick Fisher&#39;s tech blog</a> 
</div>

    <div class="order-1 sm:order-2">
  <ul class="flex sm:justify-end gap-5">
    
    
    <li>    
      <a href="https://www.linkedin.com/in/nick-fisher-software/" target="_blank" rel="noopener noreferrer">LinkedIn</a>
    </li>
    
    <li>    
      <a href="https://github.com/nfisher23" target="_blank" rel="noopener noreferrer">GitHub</a>
    </li>
    
    
  </ul>
</div>

</footer></body>
</html>
