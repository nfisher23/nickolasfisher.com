<!DOCTYPE html>
<html lang="en-US" class="scroll-smooth dark">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>

<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>How to Register a Spring Boot Service to a Consul Cluster</title>
<meta
  name="description"
  content="In a previous post, we saw how to provision a simple consul client/server cluster using Ansible. We will now look at interacting with that cluster by showing how to register a spring boot application to it, using spring cloud consul."
/>
<link rel="canonical" href="http://localhost:1313/blog/how-to-register-a-spring-boot-service-to-a-consul-cluster/" />
<link rel="robots" href="/robots.txt" />

<link rel="icon" type="image/x-icon" href="/img/nficon.png" />



<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });</script>

<link rel="stylesheet" href="http://localhost:1313/css/app.css" /></head>

  <body class="max-w-screen-md mx-auto px-2.5">
    <div class="header">
      <header class="flex flex-col sm:flex-row items-center gap-5 sm:gap-10 pt-16 py-12">
   


<div class="flex-none w-20 h-20 rounded-full overflow-hidden">
  <a href="http://localhost:1313/">
    <img
      srcset="/img/profile-picture_hu4241499301404582006.jpg 80w"
      src="/img/profile-picture.jpg"
      width="386"
      height="345"
      alt="Nick Fisher&#39;s tech blog"
    />
  </a>
</div>

  
  <div class="flex flex-col gap-5">
    <a href="http://localhost:1313/">
  <h1 id="site-title">Nick Fisher&#39;s tech blog</h1>
</a>
 
    <nav>
  <ul>
     
    
    <li>
      <a href="/" class="">
        home
      </a>
    </li>
    
    <li>
      <a href="/blog" class="">
        blog
      </a>
    </li>
    
    <li>
      <a href="/about" class="">
        about
      </a>
    </li>
    
    <li>
      <a href="/tags" class="">
        Tags
      </a>
    </li>
    
  </ul>
</nav>

  </div>
</header>

      <button class="toggle-theme" aria-label="Toggle Theme" title="Toggle Theme" onclick="toggleTheme()">
  <span class="theme-icon light"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
</svg> </span>
  <span class="theme-icon dark"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
</svg> </span>
</button>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const theme = localStorage.getItem('theme');

    if (!theme || theme === 'light') {
      setTheme('light');
    } else {
      setTheme(theme);
    }
  });

  function setTheme(theme) {
    const html = document.querySelector('html');
    localStorage.setItem('theme', theme);

    if (theme === 'light') {
      if (html.classList.contains('dark')) {
        document.querySelector('html').classList.remove('dark');
      }

      document.querySelector('.theme-icon.light').style.display = 'none';
      document.querySelector('.theme-icon.dark').style.display = 'block';
    } else {
      if (!html.classList.contains('dark')) {
        document.querySelector('html').classList.add('dark');
      }

      document.querySelector('.theme-icon.dark').style.display = 'none';
      document.querySelector('.theme-icon.light').style.display = 'block';
    }
  }

  function toggleTheme() {
    const theme = localStorage.getItem('theme');

    if (theme === 'light') {
      setTheme('dark');
    } else {
      setTheme('light');
    }
  }
</script>
    </div>
  
    <main id="content">

<article class="flex flex-col gap-10">
  <header class="flex flex-col gap-2">
    <h2 class="title-large">How to Register a Spring Boot Service to a Consul Cluster</h2>

    <div class="meta">
      
      <time datetime="2019-05-25 16:24:46 &#43;0000 UTC" title='Sat, May 25, 2019, 4:24 PM UTC'>
        25/05/2019 - Estimated reading time: 2 minutes
      </time>

       
      
    </div>
  </header>

  

  <section><p>In a previous post, we saw <a href="https://nickolasfisher.com/blog/How-to-Provision-a-Consul-ClientServer-Cluster-using-Ansible">how to provision a simple consul client/server cluster using Ansible</a>. We will now look at interacting with that cluster by showing how to register a spring boot application to it, using <a href="https://cloud.spring.io/spring-cloud-consul/spring-cloud-consul.html">spring cloud consul</a>.</p>
<p>First, pull up the <a href="https://start.spring.io/">spring boot initializer</a>. Select web and spring cloud, then download and unpack the project. Your pom.xml should look something like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-xml" data-lang="xml"><span style="display:flex;"><span>&amp;lt;?xml version=&amp;#34;1.0&amp;#34; encoding=&amp;#34;UTF-8&amp;#34;?&amp;gt;
</span></span><span style="display:flex;"><span>&amp;lt;project xmlns=&amp;#34;http://maven.apache.org/POM/4.0.0&amp;#34; xmlns:xsi=&amp;#34;http://www.w3.org/2001/XMLSchema-instance&amp;#34;
</span></span><span style="display:flex;"><span>         xsi:schemaLocation=&amp;#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&amp;#34;&amp;gt;
</span></span><span style="display:flex;"><span>    &amp;lt;modelVersion&amp;gt;4.0.0&amp;lt;/modelVersion&amp;gt;
</span></span><span style="display:flex;"><span>    &amp;lt;parent&amp;gt;
</span></span><span style="display:flex;"><span>        &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
</span></span><span style="display:flex;"><span>        &amp;lt;artifactId&amp;gt;spring-boot-starter-parent&amp;lt;/artifactId&amp;gt;
</span></span><span style="display:flex;"><span>        &amp;lt;version&amp;gt;2.1.5.RELEASE&amp;lt;/version&amp;gt;
</span></span><span style="display:flex;"><span>        &amp;lt;relativePath/&amp;gt; &amp;lt;!-- lookup parent from repository --&amp;gt;
</span></span><span style="display:flex;"><span>    &amp;lt;/parent&amp;gt;
</span></span><span style="display:flex;"><span>    &amp;lt;groupId&amp;gt;com.nickolasfisher&amp;lt;/groupId&amp;gt;
</span></span><span style="display:flex;"><span>    &amp;lt;artifactId&amp;gt;consulregister&amp;lt;/artifactId&amp;gt;
</span></span><span style="display:flex;"><span>    &amp;lt;version&amp;gt;0.0.1-SNAPSHOT&amp;lt;/version&amp;gt;
</span></span><span style="display:flex;"><span>    &amp;lt;name&amp;gt;consulregister&amp;lt;/name&amp;gt;
</span></span><span style="display:flex;"><span>    &amp;lt;description&amp;gt;Sample app that registers to Consul&amp;lt;/description&amp;gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &amp;lt;properties&amp;gt;
</span></span><span style="display:flex;"><span>        &amp;lt;java.version&amp;gt;11&amp;lt;/java.version&amp;gt;
</span></span><span style="display:flex;"><span>        &amp;lt;spring-cloud.version&amp;gt;Greenwich.SR1&amp;lt;/spring-cloud.version&amp;gt;
</span></span><span style="display:flex;"><span>    &amp;lt;/properties&amp;gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &amp;lt;dependencies&amp;gt;
</span></span><span style="display:flex;"><span>        &amp;lt;dependency&amp;gt;
</span></span><span style="display:flex;"><span>            &amp;lt;groupId&amp;gt;org.springframework.cloud&amp;lt;/groupId&amp;gt;
</span></span><span style="display:flex;"><span>            &amp;lt;artifactId&amp;gt;spring-cloud-starter-consul-discovery&amp;lt;/artifactId&amp;gt;
</span></span><span style="display:flex;"><span>        &amp;lt;/dependency&amp;gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        &amp;lt;dependency&amp;gt;
</span></span><span style="display:flex;"><span>            &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
</span></span><span style="display:flex;"><span>            &amp;lt;artifactId&amp;gt;spring-boot-starter-web&amp;lt;/artifactId&amp;gt;
</span></span><span style="display:flex;"><span>            &amp;lt;version&amp;gt;2.1.5.RELEASE&amp;lt;/version&amp;gt;
</span></span><span style="display:flex;"><span>        &amp;lt;/dependency&amp;gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        &amp;lt;dependency&amp;gt;
</span></span><span style="display:flex;"><span>            &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
</span></span><span style="display:flex;"><span>            &amp;lt;artifactId&amp;gt;spring-boot-starter-test&amp;lt;/artifactId&amp;gt;
</span></span><span style="display:flex;"><span>            &amp;lt;scope&amp;gt;test&amp;lt;/scope&amp;gt;
</span></span><span style="display:flex;"><span>        &amp;lt;/dependency&amp;gt;
</span></span><span style="display:flex;"><span>    &amp;lt;/dependencies&amp;gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &amp;lt;dependencyManagement&amp;gt;
</span></span><span style="display:flex;"><span>        &amp;lt;dependencies&amp;gt;
</span></span><span style="display:flex;"><span>            &amp;lt;dependency&amp;gt;
</span></span><span style="display:flex;"><span>                &amp;lt;groupId&amp;gt;org.springframework.cloud&amp;lt;/groupId&amp;gt;
</span></span><span style="display:flex;"><span>                &amp;lt;artifactId&amp;gt;spring-cloud-dependencies&amp;lt;/artifactId&amp;gt;
</span></span><span style="display:flex;"><span>                &amp;lt;version&amp;gt;${spring-cloud.version}&amp;lt;/version&amp;gt;
</span></span><span style="display:flex;"><span>                &amp;lt;type&amp;gt;pom&amp;lt;/type&amp;gt;
</span></span><span style="display:flex;"><span>                &amp;lt;scope&amp;gt;import&amp;lt;/scope&amp;gt;
</span></span><span style="display:flex;"><span>            &amp;lt;/dependency&amp;gt;
</span></span><span style="display:flex;"><span>        &amp;lt;/dependencies&amp;gt;
</span></span><span style="display:flex;"><span>    &amp;lt;/dependencyManagement&amp;gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    &amp;lt;build&amp;gt;
</span></span><span style="display:flex;"><span>        &amp;lt;plugins&amp;gt;
</span></span><span style="display:flex;"><span>            &amp;lt;plugin&amp;gt;
</span></span><span style="display:flex;"><span>                &amp;lt;groupId&amp;gt;org.springframework.boot&amp;lt;/groupId&amp;gt;
</span></span><span style="display:flex;"><span>                &amp;lt;artifactId&amp;gt;spring-boot-maven-plugin&amp;lt;/artifactId&amp;gt;
</span></span><span style="display:flex;"><span>            &amp;lt;/plugin&amp;gt;
</span></span><span style="display:flex;"><span>        &amp;lt;/plugins&amp;gt;
</span></span><span style="display:flex;"><span>    &amp;lt;/build&amp;gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&amp;lt;/project&amp;gt;
</span></span></code></pre></div><p>You will need the web dependency to allow Consul to check your health endpoint, and you will need the spring cloud dependency to have your application register to consul on startup time.</p>
<p>What remains is some spring boot automagic. If you took after the post on provisioning your consul cluster and <a href="https://github.com/nfisher23/some-ansible-examples/tree/master/consul-server">you started it using the sample code</a>, you will have a Consul agent running in client mode available at <strong>192.168.56.212</strong>, and it will be receiving communications on port <strong>8500</strong>. All you will need to make this happen is some changes to your <strong>application.yml</strong> inside of your resources folder:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-yaml" data-lang="yaml"><span style="display:flex;"><span><span style="color:#ff79c6">spring</span>:
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">application</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">name</span>: consulregister
</span></span><span style="display:flex;"><span>  <span style="color:#ff79c6">cloud</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">consul</span>:
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">enabled</span>: <span style="color:#ff79c6">true</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">port</span>: <span style="color:#bd93f9">8500</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">host</span>: http://192.168.56.212:8500
</span></span></code></pre></div><p>You can then go to your application directory and run:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ mvn spring-boot:run
</span></span></code></pre></div><p>After a bit, you should see your application register to consul with a log entry containing something similar to:</p>
<pre tabindex="0"><code>...Registering service with consul: NewService{id=&amp;#39;consulregister&amp;#39;, name=&amp;#39;consulregister&amp;#39;, tags=[secure=false], address=&amp;#39;192.168.0.20&amp;#39;, meta=null, port=8080, enableTagOverride=null, check=Check{script=&amp;#39;null&amp;#39;, interval=&amp;#39;10s&amp;#39;, ttl=&amp;#39;null&amp;#39;, http=&amp;#39;http://192.168.0.20:8080/actuator/health&amp;#39;, method=&amp;#39;null&amp;#39;, header={}, tcp=&amp;#39;null&amp;#39;, timeout=&amp;#39;null&amp;#39;, deregisterCriticalServiceAfter=&amp;#39;null&amp;#39;, tlsSkipVerify=null, status=&amp;#39;null&amp;#39;}, checks=null}
</code></pre><p>You can then ask consul to verify that it contains the service:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ curl http://192.168.68.212:8500/v1/agent/services | json_pp
</span></span><span style="display:flex;"><span>  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
</span></span><span style="display:flex;"><span>                                 Dload  Upload   Total   Spent    Left  Speed
</span></span><span style="display:flex;"><span><span style="color:#bd93f9">100</span>   <span style="color:#bd93f9">202</span>  <span style="color:#bd93f9">100</span>   <span style="color:#bd93f9">202</span>    <span style="color:#bd93f9">0</span>     <span style="color:#bd93f9">0</span>   197k      <span style="color:#bd93f9">0</span> --:--:-- --:--:-- --:--:--  197k
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">{</span>
</span></span><span style="display:flex;"><span>   &amp;<span style="color:#6272a4">#34;consulregister&amp;#34; : {</span>
</span></span><span style="display:flex;"><span>      &amp;<span style="color:#6272a4">#34;Port&amp;#34; : 8080,</span>
</span></span><span style="display:flex;"><span>      &amp;<span style="color:#6272a4">#34;Tags&amp;#34; : [</span>
</span></span><span style="display:flex;"><span>         &amp;<span style="color:#6272a4">#34;secure=false&amp;#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">]</span>,
</span></span><span style="display:flex;"><span>      &amp;<span style="color:#6272a4">#34;Address&amp;#34; : &amp;#34;192.168.0.20&amp;#34;,</span>
</span></span><span style="display:flex;"><span>      &amp;<span style="color:#6272a4">#34;ID&amp;#34; : &amp;#34;consulregister&amp;#34;,</span>
</span></span><span style="display:flex;"><span>      &amp;<span style="color:#6272a4">#34;Meta&amp;#34; : {},</span>
</span></span><span style="display:flex;"><span>      &amp;<span style="color:#6272a4">#34;Service&amp;#34; : &amp;#34;consulregister&amp;#34;,</span>
</span></span><span style="display:flex;"><span>      &amp;<span style="color:#6272a4">#34;Weights&amp;#34; : {</span>
</span></span><span style="display:flex;"><span>         &amp;<span style="color:#6272a4">#34;Warning&amp;#34; : 1,</span>
</span></span><span style="display:flex;"><span>         &amp;<span style="color:#6272a4">#34;Passing&amp;#34; : 1</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ff79c6">}</span>,
</span></span><span style="display:flex;"><span>      &amp;<span style="color:#6272a4">#34;EnableTagOverride&amp;#34; : false</span>
</span></span><span style="display:flex;"><span>   <span style="color:#ff79c6">}</span>
</span></span><span style="display:flex;"><span><span style="color:#ff79c6">}</span>
</span></span></code></pre></div><p>And you're good to go.</p>
</section>

  
    
  

    
  


  <footer>
    
      <div class="pb-14 taxonomy-list tags-list">
      
        <a href="/tags/java/" alt="Java">
          Java
        </a>
      
        <a href="/tags/distributed-systems/" alt="Distributed Systems">
          Distributed Systems
        </a>
      
        <a href="/tags/spring/" alt="Spring">
          Spring
        </a>
      
        <a href="/tags/consul/" alt="Consul">
          Consul
        </a>
      
      </div>
    
  </footer>
</article>


    </main><footer class="pt-5 pb-10 grid gap-3 sm:grid-cols-2">
    <div class="text-xs font-semibold text-gray-500 order-2 sm:order-1">
  © 2018-2025 —
  <a href="http://localhost:1313/">Nick Fisher&#39;s tech blog</a> 
</div>

    <div class="order-1 sm:order-2">
  <ul class="flex sm:justify-end gap-5">
    
    
    <li>    
      <a href="https://www.linkedin.com/in/nick-fisher-software/" target="_blank" rel="noopener noreferrer">LinkedIn</a>
    </li>
    
    <li>    
      <a href="https://github.com/nfisher23" target="_blank" rel="noopener noreferrer">GitHub</a>
    </li>
    
    
  </ul>
</div>

</footer></body>
</html>
