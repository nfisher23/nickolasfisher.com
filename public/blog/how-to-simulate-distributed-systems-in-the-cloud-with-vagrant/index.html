<!DOCTYPE html>
<html lang="en-US" class="scroll-smooth dark">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>

<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>How to Simulate Distributed Systems in the Cloud with Vagrant</title>
<meta
  name="description"
  content="In our last post on simulating a cloud environment on your local machine,
we saw that we could use virtual box to create a virtual machine that could both talk to your local computer, with its own IP address, and to the internet."
/>
<link rel="canonical" href="http://localhost:1313/blog/how-to-simulate-distributed-systems-in-the-cloud-with-vagrant/" />
<link rel="robots" href="/robots.txt" />

<link rel="icon" type="image/x-icon" href="/icons/favicon.ico" />



<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });</script>

<link rel="stylesheet" href="http://localhost:1313/css/app.css" /></head>

  <body class="max-w-screen-md mx-auto px-2.5">
    <div class="header">
      <header class="flex flex-col sm:flex-row items-center gap-5 sm:gap-10 pt-16 py-12">
   


<div class="flex-none w-20 h-20 rounded-full overflow-hidden">
  <a href="http://localhost:1313/">
    <img
      srcset="/img/profile-picture_hu4241499301404582006.jpg 80w"
      src="/img/profile-picture.jpg"
      width="386"
      height="345"
      alt="Nick Fisher&#39;s tech blog"
    />
  </a>
</div>

  
  <div class="flex flex-col gap-5">
    <a href="http://localhost:1313/">
  <h1 id="site-title">Nick Fisher&#39;s tech blog</h1>
</a>
 
    <nav>
  <ul>
     
    
    <li>
      <a href="/" class="">
        Home
      </a>
    </li>
    
    <li>
      <a href="/blog" class="">
        Blog
      </a>
    </li>
    
    <li>
      <a href="/about" class="">
        About me
      </a>
    </li>
    
    <li>
      <a href="/categories" class="">
        Categories
      </a>
    </li>
    
    <li>
      <a href="/tags" class="">
        Tags
      </a>
    </li>
    
  </ul>
</nav>

  </div>
</header>

      <button class="toggle-theme" aria-label="Toggle Theme" title="Toggle Theme" onclick="toggleTheme()">
  <span class="theme-icon light"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
</svg> </span>
  <span class="theme-icon dark"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
</svg> </span>
</button>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const theme = localStorage.getItem('theme');

    if (!theme || theme === 'light') {
      setTheme('light');
    } else {
      setTheme(theme);
    }
  });

  function setTheme(theme) {
    const html = document.querySelector('html');
    localStorage.setItem('theme', theme);

    if (theme === 'light') {
      if (html.classList.contains('dark')) {
        document.querySelector('html').classList.remove('dark');
      }

      document.querySelector('.theme-icon.light').style.display = 'none';
      document.querySelector('.theme-icon.dark').style.display = 'block';
    } else {
      if (!html.classList.contains('dark')) {
        document.querySelector('html').classList.add('dark');
      }

      document.querySelector('.theme-icon.dark').style.display = 'none';
      document.querySelector('.theme-icon.light').style.display = 'block';
    }
  }

  function toggleTheme() {
    const theme = localStorage.getItem('theme');

    if (theme === 'light') {
      setTheme('dark');
    } else {
      setTheme('light');
    }
  }
</script>
    </div>
  
    <main id="content">

<article class="flex flex-col gap-10">
  <header class="flex flex-col gap-2">
    <h2 class="title-large">How to Simulate Distributed Systems in the Cloud with Vagrant</h2>

    <div class="meta">
      
      <time datetime="2018-10-28 14:28:13 &#43;0000 UTC" title='Sun, Oct 28, 2018, 2:28 PM UTC'>
        28/10/2018 - Estimated reading time: 3 minutes
      </time>

       
      
    </div>
  </header>

  

  <section><p>In our last post on <a href="https://nickolasfisher.com/blog/How-to-Set-Up-A-Private-Local-Network-On-Your-PC-With-VirtualBox">simulating a cloud environment on your local machine</a>,
we saw that we could use virtual box to create a virtual machine that could both talk to your local computer, with its own IP address, and to the internet.</p>
<p>There is a better way than manually configuring each server you want to spin up, however, and that better way is called <a href="https://www.vagrantup.com/">Vagrant</a>. <strong>Vagrant is awesome</strong>.</p>
<p>To recreate the same results as we just saw in our last post, download vagrant (and make sure you have virtual box installed). Then navigate to an empty directory and type:</p>
<p><code>$ vagrant init -m</code></p>
<p>This will create a VagrantFile in your current directory that looks like this:</p>
<pre tabindex="0"><code>Vagrant.configure(&amp;#34;2&amp;#34;) do |config|
  config.vm.box = &amp;#34;base&amp;#34;
end
</code></pre><p>The &quot;base&quot; image that we want here is found in the vagrant repository ubuntu/bionic64&ndash;that will typically contain the latest version of the Ubuntu 18 release. We also want to configure a virtual private network, just like we did before, so we will add networking information to make the IP recognizeable at 192.168.56.101:</p>
<pre tabindex="0"><code>Vagrant.configure(&amp;#34;2&amp;#34;) do |config|
  config.vm.box = &amp;#34;ubuntu/bionic64&amp;#34;
  config.vm.network &amp;#34;private_network&amp;#34;, ip: &amp;#34;192.168.56.101&amp;#34;
end
</code></pre><p>If you run <code>$ vagrant up</code> at this point, you will be able to ssh into the machine with:</p>
<p><code>$ vagrant ssh </code></p>
<p>We can further specify how much memory and how many cores to dedicate to this virtual machine with:</p>
<pre tabindex="0"><code>  config.vm.provider &amp;#34;virtualbox&amp;#34; do |vb|
    vb.memory = &amp;#34;1024&amp;#34;
    vb.cpus = 1
  end
</code></pre><p>You can then set up root access, just like you get when you spin up a VM in the cloud, with the following provisioning specifics (assuming you've got your ssh keys generated already):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>  config.vm.provision &amp;<span style="color:#6272a4">#34;file&amp;#34;, source: &amp;#34;~/.ssh/id_rsa.pub&amp;#34;, destination: &amp;#34;~/.ssh/me.pub&amp;#34;</span>
</span></span><span style="display:flex;"><span>  config.vm.provision &amp;<span style="color:#6272a4">#34;shell&amp;#34;, inline: &amp;#34;cat /home/vagrant/.ssh/me.pub &amp;gt;&amp;gt; /home/vagrant/.ssh/authorized_keys&amp;#34;</span>
</span></span><span style="display:flex;"><span>  config.vm.provision &amp;<span style="color:#6272a4">#34;shell&amp;#34;, inline: &amp;#34;mkdir -p /root &amp;amp;&amp;amp; mkdir -p /root/.ssh/ &amp;amp;&amp;amp; cat /home/vagrant/.ssh/me.pub &amp;gt;&amp;gt; /root/.ssh/authorized_keys&amp;#34;</span>
</span></span></code></pre></div><p>Your entire VagrantFile should now look like:</p>
<pre tabindex="0"><code>Vagrant.configure(&amp;#34;2&amp;#34;) do |config|
  config.vm.box = &amp;#34;ubuntu/bionic64&amp;#34;
  config.vm.network &amp;#34;private_network&amp;#34;, ip: &amp;#34;192.168.56.101&amp;#34;

  config.vm.provider &amp;#34;virtualbox&amp;#34; do |vb|
    vb.memory = &amp;#34;1024&amp;#34;
    vb.cpus = 1
  end

  config.vm.provision &amp;#34;file&amp;#34;, source: &amp;#34;~/.ssh/id_rsa.pub&amp;#34;, destination: &amp;#34;~/.ssh/me.pub&amp;#34;
  config.vm.provision &amp;#34;shell&amp;#34;, inline: &amp;#34;cat /home/vagrant/.ssh/me.pub &amp;gt;&amp;gt; /home/vagrant/.ssh/authorized_keys&amp;#34;
  config.vm.provision &amp;#34;shell&amp;#34;, inline: &amp;#34;mkdir -p /root &amp;amp;&amp;amp; mkdir -p /root/.ssh/ &amp;amp;&amp;amp; cat /home/vagrant/.ssh/me.pub &amp;gt;&amp;gt; /root/.ssh/authorized_keys&amp;#34;
end
</code></pre><p>If you run <code>$ vagrant up</code> in the directory where this VagrantFile is located, you will be able to connect as root by running</p>
<p><code>$ ssh root@192.168.56.101</code></p>
<p>A word of warning: if you plan to do this consistently, your computer's default behavior is going to be to save the public key it gets from the local server, which will change every time you destroy and bring up virtual machines. You will then be understandably blocked if you try to connect to the same IP address which has a different SSH key on the other end. To fix this, on your <strong>host system</strong>, you can add this to your ~/.ssh/config file:</p>
<pre tabindex="0"><code>Host 192.168.56.*
  StrictHostKeyChecking no
  UserKnownHostsFile /dev/null
</code></pre><p>I am assuming here that you plan on keeping your IP addresses in the 192.168.56.(whatever) range here, which is a reasonable convention to assume.</p>
<p>You now have all the information you need to become a master of the distributed system universe. Remember us little people on your rise to prominence.</p>
</section>

  
    
  

    
  


  <footer>
    
  </footer>
</article>


    </main><footer class="pt-5 pb-10 grid gap-3 sm:grid-cols-2">
    <div class="text-xs font-semibold text-gray-500 order-2 sm:order-1">
  © 2018-2025 —
  <a href="http://localhost:1313/">Nick Fisher&#39;s tech blog</a> 
</div>

    <div class="order-1 sm:order-2">
  <ul class="flex sm:justify-end gap-5">
    
    
    <li>    
      <a href="https://www.linkedin.com/in/nick-fisher-software/" target="_blank" rel="noopener noreferrer">LinkedIn</a>
    </li>
    
    <li>    
      <a href="https://github.com/nfisher23" target="_blank" rel="noopener noreferrer">GitHub</a>
    </li>
    
    
  </ul>
</div>

</footer></body>
</html>
