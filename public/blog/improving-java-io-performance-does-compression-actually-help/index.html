<!doctype html><html lang=en-US class="scroll-smooth dark"><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Improving Java IO Performance: Does Compression Actually Help?</title>
<meta name=description content="The sample code associated with this blog post can be found on GitHub.
The question &ldquo;does compression actually help?&rdquo; is admittedly pretty loaded. The real answer is sometimes, and it depends. I will not try to answer every use case, but I will provide a very specific example here that appears to provide a &ldquo;probably not&rdquo; answer (for this specific use case)."><link rel=canonical href=https://www.nickolasfisher.com/blog/improving-java-io-performance-does-compression-actually-help/><link rel=robots href=/robots.txt><link rel=icon type=image/x-icon href=/img/nficon.png><script type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type=text/x-mathjax-config>MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });</script><link rel=stylesheet href="https://www.nickolasfisher.com/css/app.min.dee9c4afb37cb95c5d39c976614ef6f95398bcba4b6e73066c44de2a3a6543ed.css"></head><body class="max-w-screen-md mx-auto px-2.5"><div class=header><header class="flex flex-col sm:flex-row items-center gap-5 sm:gap-10 pt-16 py-12"><div class="flex-none w-20 h-20 rounded-full overflow-hidden"><a href=https://www.nickolasfisher.com/><img srcset="/img/profile-picture_hu4241499301404582006.jpg 80w" src=/img/profile-picture.jpg width=386 height=345 alt="Nick Fisher's tech blog"></a></div><div class="flex flex-col gap-5"><a href=https://www.nickolasfisher.com/><h1 id=site-title>Nick Fisher's tech blog</h1></a><nav><ul><li><a href=/>home</a></li><li><a href=/blog>blog</a></li><li><a href=/about>about</a></li><li><a href=/tags>Tags</a></li></ul></nav></div></header><button class=toggle-theme aria-label="Toggle Theme" title="Toggle Theme" onclick=toggleTheme()>
<span class="theme-icon light"><svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75.0 11-7.5.0 3.75 3.75.0 017.5.0z"/></svg> </span><span class="theme-icon dark"><svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718.0 0118 15.75c-5.385.0-9.75-4.365-9.75-9.75.0-1.33.266-2.597.748-3.752A9.753 9.753.0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753.0 009.002-5.998z"/></svg> </span></button>
<script>document.addEventListener("DOMContentLoaded",function(){const e=localStorage.getItem("theme");setTheme(!e||e==="light"?"light":e)});function setTheme(e){const t=document.querySelector("html");localStorage.setItem("theme",e),e==="light"?(t.classList.contains("dark")&&document.querySelector("html").classList.remove("dark"),document.querySelector(".theme-icon.light").style.display="none",document.querySelector(".theme-icon.dark").style.display="block"):(t.classList.contains("dark")||document.querySelector("html").classList.add("dark"),document.querySelector(".theme-icon.dark").style.display="none",document.querySelector(".theme-icon.light").style.display="block")}function toggleTheme(){const e=localStorage.getItem("theme");setTheme(e==="light"?"dark":"light")}</script></div><main id=content><article class="flex flex-col gap-10"><header class="flex flex-col gap-2"><h2 class=title-large>Improving Java IO Performance: Does Compression Actually Help?</h2><div class=meta><time datetime="2018-11-17 18:55:03 +0000 UTC" title='Sat, Nov 17, 2018, 6:55 PM UTC'>17/11/2018 - Estimated reading time: 3 minutes</time></div></header><section><p>The sample code associated with this blog post can be found <a href=https://github.com/nfisher23/io-tuning>on GitHub</a>.</p><p>The question &ldquo;does compression actually help?&rdquo; is admittedly pretty loaded. The real answer is <em>sometimes</em>, and <em>it depends</em>. I will not try to answer every use case, but I will provide a very specific example here that appears to provide a &ldquo;probably not&rdquo; answer (for this specific use case).</p><p>We&rsquo;ll write a CSV file that contains 1M lines, where each line looks like &ldquo;0,1,2,3&mldr;,8,9&rdquo;. First, I&rsquo;ll set up the benchmark runner JMH with JUnit:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd;font-style:italic>static</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>runBenchmark</span>(Class clazz) <span style=color:#8be9fd;font-style:italic>throws</span> Exception {
</span></span><span style=display:flex><span>        Options options <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> OptionsBuilder()
</span></span><span style=display:flex><span>                .<span style=color:#50fa7b>include</span>(clazz.<span style=color:#50fa7b>getName</span>() <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#34;.*&#34;</span>)
</span></span><span style=display:flex><span>                .<span style=color:#50fa7b>mode</span>(Mode.<span style=color:#50fa7b>AverageTime</span>)
</span></span><span style=display:flex><span>                .<span style=color:#50fa7b>warmupTime</span>(TimeValue.<span style=color:#50fa7b>seconds</span>(1))
</span></span><span style=display:flex><span>                .<span style=color:#50fa7b>warmupIterations</span>(2)
</span></span><span style=display:flex><span>                .<span style=color:#50fa7b>measurementIterations</span>(2)
</span></span><span style=display:flex><span>                .<span style=color:#50fa7b>timeUnit</span>(TimeUnit.<span style=color:#50fa7b>MILLISECONDS</span>)
</span></span><span style=display:flex><span>                .<span style=color:#50fa7b>measurementTime</span>(TimeValue.<span style=color:#50fa7b>seconds</span>(1))
</span></span><span style=display:flex><span>                <span style=color:#6272a4>// OS bottleneck, so we use should one</span>
</span></span><span style=display:flex><span>                <span style=color:#6272a4>// thread at a time for accurate results</span>
</span></span><span style=display:flex><span>                .<span style=color:#50fa7b>threads</span>(1)
</span></span><span style=display:flex><span>                .<span style=color:#50fa7b>forks</span>(1)
</span></span><span style=display:flex><span>                .<span style=color:#50fa7b>shouldFailOnError</span>(<span style=color:#ff79c6>true</span>)
</span></span><span style=display:flex><span>                .<span style=color:#50fa7b>shouldDoGC</span>(<span style=color:#ff79c6>true</span>)
</span></span><span style=display:flex><span>                .<span style=color:#50fa7b>build</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>new</span> Runner(options).<span style=color:#50fa7b>run</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>    @Test
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>launchBenchmark</span>() <span style=color:#8be9fd;font-style:italic>throws</span> Exception {
</span></span><span style=display:flex><span>        Utils.<span style=color:#50fa7b>runBenchmark</span>(<span style=color:#ff79c6>this</span>.<span style=color:#50fa7b>getClass</span>());
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><p>Then I&rsquo;ll set up a benchmark that writes and reads without compression, using the file size as the buffer in the second case:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd;font-style:italic>static</span> <span style=color:#8be9fd>int</span> NUMBER_OF_CSV_LINES <span style=color:#ff79c6>=</span> 1000000;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>    @Benchmark
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>readAndWriteWithoutCompression</span>() <span style=color:#8be9fd;font-style:italic>throws</span> Exception {
</span></span><span style=display:flex><span>        writeUncompressedFileToDisk(Utils.<span style=color:#50fa7b>getCsv</span>(NUMBER_OF_CSV_LINES), millionLineCsvFilePath);
</span></span><span style=display:flex><span>        String readValues <span style=color:#ff79c6>=</span> readUncompressedFileFromDisk(millionLineCsvFilePath);
</span></span><span style=display:flex><span>        assertTrue(readValues.<span style=color:#50fa7b>startsWith</span>(<span style=color:#f1fa8c>&#34;0,1,2,3,4,5&#34;</span>));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>private</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>writeUncompressedFileToDisk</span>(String data, String fileOutPutPath) <span style=color:#8be9fd;font-style:italic>throws</span> Exception {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>try</span> (FileOutputStream fileOutputStream <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> FileOutputStream(fileOutPutPath)) {
</span></span><span style=display:flex><span>            fileOutputStream.<span style=color:#50fa7b>write</span>(data.<span style=color:#50fa7b>getBytes</span>());
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>private</span> String <span style=color:#50fa7b>readUncompressedFileFromDisk</span>(String filePath) <span style=color:#8be9fd;font-style:italic>throws</span> Exception {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>try</span> (FileInputStream fileInputStream <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> FileInputStream(filePath)) {
</span></span><span style=display:flex><span>            <span style=color:#8be9fd>int</span> length <span style=color:#ff79c6>=</span> (<span style=color:#8be9fd>int</span>) <span style=color:#ff79c6>new</span> File(filePath).<span style=color:#50fa7b>length</span>();
</span></span><span style=display:flex><span>            <span style=color:#8be9fd>byte</span><span style=color:#ff79c6>[]</span> bytes <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> <span style=color:#8be9fd>byte</span><span style=color:#ff79c6>[</span>length<span style=color:#ff79c6>]</span>;
</span></span><span style=display:flex><span>            fileInputStream.<span style=color:#50fa7b>read</span>(bytes);
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>new</span> String(bytes);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><p>And I&rsquo;ll set up a comparison benchmark that using compression, specifically using ZipInputStream and ZipOutputStream (using the ZIP algorithm):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>    @Benchmark
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>readAndWriteCompressedData</span>() <span style=color:#8be9fd;font-style:italic>throws</span> Exception {
</span></span><span style=display:flex><span>        compressAndWriteFile(Utils.<span style=color:#50fa7b>getCsv</span>(NUMBER_OF_CSV_LINES), compressedLargeCsvFile);
</span></span><span style=display:flex><span>        String dataFromCompressedFile <span style=color:#ff79c6>=</span> readCompressedFile(compressedLargeCsvFile);
</span></span><span style=display:flex><span>        assertTrue(dataFromCompressedFile.<span style=color:#50fa7b>startsWith</span>(<span style=color:#f1fa8c>&#34;0,1,2,3,4,5&#34;</span>));
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>private</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>compressAndWriteFile</span>(String data, String fileOutputPath) <span style=color:#8be9fd;font-style:italic>throws</span> Exception {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>try</span> (FileOutputStream fileOutputStream <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> FileOutputStream(fileOutputPath);
</span></span><span style=display:flex><span>             ZipOutputStream zipOutputStream <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> ZipOutputStream(fileOutputStream)) {
</span></span><span style=display:flex><span>            ZipEntry zipEntry <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> ZipEntry(fileOutputPath);
</span></span><span style=display:flex><span>            zipOutputStream.<span style=color:#50fa7b>putNextEntry</span>(zipEntry);
</span></span><span style=display:flex><span>            zipOutputStream.<span style=color:#50fa7b>write</span>(data.<span style=color:#50fa7b>getBytes</span>());
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>private</span> String <span style=color:#50fa7b>readCompressedFile</span>(String path) <span style=color:#8be9fd;font-style:italic>throws</span> Exception {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>try</span> (FileInputStream fileInputStream <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> FileInputStream(path);
</span></span><span style=display:flex><span>             ZipInputStream zipInputStream <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> ZipInputStream(fileInputStream)) {
</span></span><span style=display:flex><span>            zipInputStream.<span style=color:#50fa7b>getNextEntry</span>();
</span></span><span style=display:flex><span>            <span style=color:#8be9fd>byte</span><span style=color:#ff79c6>[]</span> buffered <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> <span style=color:#8be9fd>byte</span><span style=color:#ff79c6>[</span>NUMBER_OF_CSV_LINES <span style=color:#ff79c6>*</span> 20<span style=color:#ff79c6>]</span>;
</span></span><span style=display:flex><span>            zipInputStream.<span style=color:#50fa7b>read</span>(buffered);
</span></span><span style=display:flex><span>            <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>new</span> String(buffered);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><p>The performance comparison on my machine between these two approaches came to:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>Benchmark                                        Mode  Cnt    Score   Error  Units
</span></span><span style=display:flex><span>CompressionTests.readAndWriteCompressedData      avgt    <span style=color:#bd93f9>2</span>  472.763          ms/op
</span></span><span style=display:flex><span>CompressionTests.readAndWriteWithoutCompression  avgt    <span style=color:#bd93f9>2</span>  407.777          ms/op
</span></span></code></pre></div><p>So, in this particular case, it&rsquo;s faster to write normal data size to disk and pull out the same size. However, the advantage of compression in this case could also be that you&rsquo;re saving on disk storage, which could provide value.</p><p>I did run these benchmarks on another machine and noticed a ~3 times improvement in <em>speed</em> for compression, so the specific environment is probably important. Like everything else, tinker aggressively with these concepts if you&rsquo;re tasked with optimization.</p></section><footer><div class="pb-14 taxonomy-list tags-list"><a href=/tags/java/ alt=Java>Java
</a><a href=/tags/performance-testing/ alt="Performance Testing">Performance Testing
</a><a href=/tags/jmh/ alt=Jmh>Jmh</a></div></footer></article></main><footer class="pt-5 pb-10 grid gap-3 sm:grid-cols-2"><div class="text-xs font-semibold text-gray-500 order-2 sm:order-1">© 2018-2025 —
<a href=https://www.nickolasfisher.com/>Nick Fisher's tech blog</a></div><div class="order-1 sm:order-2"><ul class="flex sm:justify-end gap-5"><li><a href=https://www.linkedin.com/in/nick-fisher-software/ target=_blank rel="noopener noreferrer">LinkedIn</a></li><li><a href=https://github.com/nfisher23 target=_blank rel="noopener noreferrer">GitHub</a></li></ul></div></footer></body></html>