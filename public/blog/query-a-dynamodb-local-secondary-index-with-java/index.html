<!DOCTYPE html>
<html lang="en-US" class="scroll-smooth dark">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>

<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Query a DynamoDB Local Secondary Index with Java</title>
<meta
  name="description"
  content="DynamoDB&#39;s Local Secondary Indexes allow for more query flexibility than a traditional partition and range key combination. They are also the only index in DynamoDB where a strongly consistent read can be requested [global secondary indexes, the other index that dynamo supports, can at best be eventually consistent]. I will walk through an example for how to use local secondary indexes in dynamo using the AWS SDK 2.0 for Java, which has full reactive support, in this post."
/>
<link rel="canonical" href="http://localhost:1313/blog/query-a-dynamodb-local-secondary-index-with-java/" />
<link rel="robots" href="/robots.txt" />

<link rel="icon" type="image/x-icon" href="/icons/favicon.ico" />



<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });</script>

<link rel="stylesheet" href="http://localhost:1313/css/app.css" /></head>

  <body class="max-w-screen-md mx-auto px-2.5">
    <div class="header">
      <header class="flex flex-col sm:flex-row items-center gap-5 sm:gap-10 pt-16 py-12">
   


<div class="flex-none w-20 h-20 rounded-full overflow-hidden">
  <a href="http://localhost:1313/">
    <img
      srcset="/img/profile-picture_hu4241499301404582006.jpg 80w"
      src="/img/profile-picture.jpg"
      width="386"
      height="345"
      alt="Nick Fisher&#39;s tech blog"
    />
  </a>
</div>

  
  <div class="flex flex-col gap-5">
    <a href="http://localhost:1313/">
  <h1 id="site-title">Nick Fisher&#39;s tech blog</h1>
</a>
 
    <nav>
  <ul>
     
    
    <li>
      <a href="/" class="">
        Home
      </a>
    </li>
    
    <li>
      <a href="/blog" class="">
        Blog
      </a>
    </li>
    
    <li>
      <a href="/about" class="">
        About me
      </a>
    </li>
    
    <li>
      <a href="/categories" class="">
        Categories
      </a>
    </li>
    
    <li>
      <a href="/tags" class="">
        Tags
      </a>
    </li>
    
  </ul>
</nav>

  </div>
</header>

      <button class="toggle-theme" aria-label="Toggle Theme" title="Toggle Theme" onclick="toggleTheme()">
  <span class="theme-icon light"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
</svg> </span>
  <span class="theme-icon dark"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
</svg> </span>
</button>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const theme = localStorage.getItem('theme');

    if (!theme || theme === 'light') {
      setTheme('light');
    } else {
      setTheme(theme);
    }
  });

  function setTheme(theme) {
    const html = document.querySelector('html');
    localStorage.setItem('theme', theme);

    if (theme === 'light') {
      if (html.classList.contains('dark')) {
        document.querySelector('html').classList.remove('dark');
      }

      document.querySelector('.theme-icon.light').style.display = 'none';
      document.querySelector('.theme-icon.dark').style.display = 'block';
    } else {
      if (!html.classList.contains('dark')) {
        document.querySelector('html').classList.add('dark');
      }

      document.querySelector('.theme-icon.dark').style.display = 'none';
      document.querySelector('.theme-icon.light').style.display = 'block';
    }
  }

  function toggleTheme() {
    const theme = localStorage.getItem('theme');

    if (theme === 'light') {
      setTheme('dark');
    } else {
      setTheme('light');
    }
  }
</script>
    </div>
  
    <main id="content">

<article class="flex flex-col gap-10">
  <header class="flex flex-col gap-2">
    <h2 class="title-large">Query a DynamoDB Local Secondary Index with Java</h2>

    <div class="meta">
      
      <time datetime="2020-10-31 22:49:54 &#43;0000 UTC" title='Sat, Oct 31, 2020, 10:49 PM UTC'>
        31/10/2020 - Estimated reading time: 4 minutes
      </time>

       
      
    </div>
  </header>

  

  <section><p>DynamoDB's Local Secondary Indexes allow for more query flexibility than a traditional partition and range key combination. They are also the only index in DynamoDB where a strongly consistent read can be requested [global secondary indexes, the other index that dynamo supports, can at best be eventually consistent]. I will walk through an example for how to use local secondary indexes in dynamo using the AWS SDK 2.0 for Java, which has full reactive support, in this post.</p>
<p>The source code for this post <a href="https://github.com/nfisher23/webflux-and-dynamo/blob/master/src/test/java/com/nickolasfisher/reactivedynamo/PhoneServiceTest.java#L338">can be found on Github</a>.</p>
<h2 id="creating-the-table">Creating the Table</h2>
<p>A very important constraint of local secondary indexes is that you must create one <strong>at table creation time</strong>. You cannot modify an existing table to have a local secondary index, unlike traditional RDBMS systems.</p>
<p>We're going to be building off of previous posts where we have worked with DynamoDB, notably one where we showed <a href="https://nickolasfisher.com/blog/Configuring-an-In-Memory-DynamoDB-instance-with-Java-for-Integration-Testing">how to configure an embedded DynamoDB instance for integration testing</a>. I won't repeat the boilerplate code that was demonstrated there, and instead dive into this specific problem.</p>
<p>Since we have to define the index at table creation time, here is some java code to set up a table for us [note: in a production or production-like environment, I would strongly recommend you use something like terraform to manage table creation/modification]</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    @Test
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">localSecondaryIndex</span>() <span style="color:#8be9fd;font-style:italic">throws</span> Exception {
</span></span><span style="display:flex;"><span>        String currentTableName <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">&amp;</span>#34;LocalIndexTest<span style="color:#ff79c6">&amp;</span>#34;;
</span></span><span style="display:flex;"><span>        String COMPANY_YEAR_INDEX <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">&amp;</span>#34;CompanyYearIndex<span style="color:#ff79c6">&amp;</span>#34;;
</span></span><span style="display:flex;"><span>        LocalSecondaryIndex localSecondaryIndexSpec <span style="color:#ff79c6">=</span> LocalSecondaryIndex.<span style="color:#50fa7b">builder</span>()
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">keySchema</span>(
</span></span><span style="display:flex;"><span>                        KeySchemaElement.<span style="color:#50fa7b">builder</span>()
</span></span><span style="display:flex;"><span>                                .<span style="color:#50fa7b">keyType</span>(KeyType.<span style="color:#50fa7b">HASH</span>)
</span></span><span style="display:flex;"><span>                                .<span style="color:#50fa7b">attributeName</span>(COMPANY)
</span></span><span style="display:flex;"><span>                                .<span style="color:#50fa7b">build</span>(),
</span></span><span style="display:flex;"><span>                        KeySchemaElement.<span style="color:#50fa7b">builder</span>()
</span></span><span style="display:flex;"><span>                                .<span style="color:#50fa7b">keyType</span>(KeyType.<span style="color:#50fa7b">RANGE</span>)
</span></span><span style="display:flex;"><span>                                .<span style="color:#50fa7b">attributeName</span>(YEAR)
</span></span><span style="display:flex;"><span>                                .<span style="color:#50fa7b">build</span>()
</span></span><span style="display:flex;"><span>                )
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">indexName</span>(COMPANY_YEAR_INDEX)
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">projection</span>(Projection.<span style="color:#50fa7b">builder</span>()
</span></span><span style="display:flex;"><span>                        .<span style="color:#50fa7b">projectionType</span>(ProjectionType.<span style="color:#50fa7b">ALL</span>)
</span></span><span style="display:flex;"><span>                        .<span style="color:#50fa7b">build</span>()
</span></span><span style="display:flex;"><span>                )
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">build</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        dynamoDbAsyncClient.<span style="color:#50fa7b">createTable</span>(CreateTableRequest.<span style="color:#50fa7b">builder</span>()
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">keySchema</span>(
</span></span><span style="display:flex;"><span>                        KeySchemaElement.<span style="color:#50fa7b">builder</span>()
</span></span><span style="display:flex;"><span>                                .<span style="color:#50fa7b">keyType</span>(KeyType.<span style="color:#50fa7b">HASH</span>)
</span></span><span style="display:flex;"><span>                                .<span style="color:#50fa7b">attributeName</span>(COMPANY)
</span></span><span style="display:flex;"><span>                                .<span style="color:#50fa7b">build</span>(),
</span></span><span style="display:flex;"><span>                        KeySchemaElement.<span style="color:#50fa7b">builder</span>()
</span></span><span style="display:flex;"><span>                                .<span style="color:#50fa7b">keyType</span>(KeyType.<span style="color:#50fa7b">RANGE</span>)
</span></span><span style="display:flex;"><span>                                .<span style="color:#50fa7b">attributeName</span>(MODEL)
</span></span><span style="display:flex;"><span>                                .<span style="color:#50fa7b">build</span>()
</span></span><span style="display:flex;"><span>                )
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">attributeDefinitions</span>(
</span></span><span style="display:flex;"><span>                        AttributeDefinition.<span style="color:#50fa7b">builder</span>()
</span></span><span style="display:flex;"><span>                                .<span style="color:#50fa7b">attributeName</span>(COMPANY)
</span></span><span style="display:flex;"><span>                                .<span style="color:#50fa7b">attributeType</span>(ScalarAttributeType.<span style="color:#50fa7b">S</span>)
</span></span><span style="display:flex;"><span>                                .<span style="color:#50fa7b">build</span>(),
</span></span><span style="display:flex;"><span>                        AttributeDefinition.<span style="color:#50fa7b">builder</span>()
</span></span><span style="display:flex;"><span>                                .<span style="color:#50fa7b">attributeName</span>(MODEL)
</span></span><span style="display:flex;"><span>                                .<span style="color:#50fa7b">attributeType</span>(ScalarAttributeType.<span style="color:#50fa7b">S</span>)
</span></span><span style="display:flex;"><span>                                .<span style="color:#50fa7b">build</span>(),
</span></span><span style="display:flex;"><span>                        AttributeDefinition.<span style="color:#50fa7b">builder</span>()
</span></span><span style="display:flex;"><span>                                .<span style="color:#50fa7b">attributeName</span>(YEAR)
</span></span><span style="display:flex;"><span>                                .<span style="color:#50fa7b">attributeType</span>(ScalarAttributeType.<span style="color:#50fa7b">N</span>)
</span></span><span style="display:flex;"><span>                                .<span style="color:#50fa7b">build</span>()
</span></span><span style="display:flex;"><span>                )
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">provisionedThroughput</span>(ProvisionedThroughput.<span style="color:#50fa7b">builder</span>()
</span></span><span style="display:flex;"><span>                        .<span style="color:#50fa7b">readCapacityUnits</span>(100L)
</span></span><span style="display:flex;"><span>                        .<span style="color:#50fa7b">writeCapacityUnits</span>(100L).<span style="color:#50fa7b">build</span>()
</span></span><span style="display:flex;"><span>                )
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">tableName</span>(currentTableName)
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">localSecondaryIndexes</span>(localSecondaryIndexSpec)
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">build</span>()
</span></span><span style="display:flex;"><span>        ).<span style="color:#50fa7b">get</span>();
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>We start by setting up a <strong>LocalSecondaryIndex</strong> POJO, which specifies that the name of the index will be &quot;CompanyYearIndex&quot;, the range key on this index should be &quot;Year&quot;, and that we want to project all attributes onto this index. Projecting attributes is exactly what it sounds like: when the index is synced up with the primary item write, we can decide which attributes in the item we want to be available when the index is queried. In this case I'm just sending all of them.</p>
<p>After specifying what we want the index to look like, we include that specification in the create table operation by using <strong>localSecondaryIndexes</strong> in the DSL. Note that we must also specify the <strong>attributeType</strong> of &quot;Year&quot; [the range key on our index], or the create table operation will fail.</p>
<h2 id="setup-data">Setup data</h2>
<p>Now we'll put some data into our newly created table. This follows the pattern/ <a href="https://nickolasfisher.com/blog/Querying-DynamoDB-in-Java-with-the-AWS-SDK-20">reuses code from some previous posts</a> and I won't belabor it here:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>        String partitionKey <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">&amp;</span>#34;Google<span style="color:#ff79c6">&amp;</span>#34;;
</span></span><span style="display:flex;"><span>        String rangeKey1 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">&amp;</span>#34;Pixel 1<span style="color:#ff79c6">&amp;</span>#34;;
</span></span><span style="display:flex;"><span>        String rangeKey2 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">&amp;</span>#34;Future Phone<span style="color:#ff79c6">&amp;</span>#34;;
</span></span><span style="display:flex;"><span>        String rangeKey3 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">&amp;</span>#34;Pixel 2<span style="color:#ff79c6">&amp;</span>#34;;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// create three items</span>
</span></span><span style="display:flex;"><span>        Map<span style="color:#ff79c6">&amp;</span>lt;String, AttributeValue<span style="color:#ff79c6">&amp;</span>gt; pixel1ItemAttributes <span style="color:#ff79c6">=</span> getMapWith(partitionKey, rangeKey1);
</span></span><span style="display:flex;"><span>        pixel1ItemAttributes.<span style="color:#50fa7b">put</span>(COLOR, AttributeValue.<span style="color:#50fa7b">builder</span>().<span style="color:#50fa7b">s</span>(<span style="color:#ff79c6">&amp;</span>#34;Blue<span style="color:#ff79c6">&amp;</span>#34;).<span style="color:#50fa7b">build</span>());
</span></span><span style="display:flex;"><span>        pixel1ItemAttributes.<span style="color:#50fa7b">put</span>(YEAR, AttributeValue.<span style="color:#50fa7b">builder</span>().<span style="color:#50fa7b">n</span>(<span style="color:#ff79c6">&amp;</span>#34;2012<span style="color:#ff79c6">&amp;</span>#34;).<span style="color:#50fa7b">build</span>());
</span></span><span style="display:flex;"><span>        putItem(currentTableName, pixel1ItemAttributes);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Map<span style="color:#ff79c6">&amp;</span>lt;String, AttributeValue<span style="color:#ff79c6">&amp;</span>gt; futurePhoneAttributes <span style="color:#ff79c6">=</span> getMapWith(partitionKey, rangeKey2);
</span></span><span style="display:flex;"><span>        futurePhoneAttributes.<span style="color:#50fa7b">put</span>(COLOR, AttributeValue.<span style="color:#50fa7b">builder</span>().<span style="color:#50fa7b">s</span>(<span style="color:#ff79c6">&amp;</span>#34;Silver<span style="color:#ff79c6">&amp;</span>#34;).<span style="color:#50fa7b">build</span>());
</span></span><span style="display:flex;"><span>        futurePhoneAttributes.<span style="color:#50fa7b">put</span>(YEAR, AttributeValue.<span style="color:#50fa7b">builder</span>().<span style="color:#50fa7b">n</span>(<span style="color:#ff79c6">&amp;</span>#34;2030<span style="color:#ff79c6">&amp;</span>#34;).<span style="color:#50fa7b">build</span>());
</span></span><span style="display:flex;"><span>        putItem(currentTableName, futurePhoneAttributes);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Map<span style="color:#ff79c6">&amp;</span>lt;String, AttributeValue<span style="color:#ff79c6">&amp;</span>gt; pixel2ItemAttributes <span style="color:#ff79c6">=</span> getMapWith(partitionKey, rangeKey3);
</span></span><span style="display:flex;"><span>        pixel2ItemAttributes.<span style="color:#50fa7b">put</span>(COLOR, AttributeValue.<span style="color:#50fa7b">builder</span>().<span style="color:#50fa7b">s</span>(<span style="color:#ff79c6">&amp;</span>#34;Cyan<span style="color:#ff79c6">&amp;</span>#34;).<span style="color:#50fa7b">build</span>());
</span></span><span style="display:flex;"><span>        pixel2ItemAttributes.<span style="color:#50fa7b">put</span>(YEAR, AttributeValue.<span style="color:#50fa7b">builder</span>().<span style="color:#50fa7b">n</span>(<span style="color:#ff79c6">&amp;</span>#34;2014<span style="color:#ff79c6">&amp;</span>#34;).<span style="color:#50fa7b">build</span>());
</span></span><span style="display:flex;"><span>        putItem(currentTableName, pixel2ItemAttributes);
</span></span></code></pre></div><p>We put three items into this table, all with the same hash attribute as &quot;Google&quot;; and different range attributes.</p>
<h2 id="querying-the-index">Querying the Index</h2>
<p>When we decide that we need to use an index, we have to specify the index at the time of querying [if it is using a range attribute that is different from the range attribute associated with the base table]. Let's say we want to get all Google phones after the year of 2013. Leveraging the index we just created, that could look something like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>        Condition equalsGoogleCondition <span style="color:#ff79c6">=</span> Condition.<span style="color:#50fa7b">builder</span>()
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">comparisonOperator</span>(ComparisonOperator.<span style="color:#50fa7b">EQ</span>)
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">attributeValueList</span>(
</span></span><span style="display:flex;"><span>                    AttributeValue.<span style="color:#50fa7b">builder</span>()
</span></span><span style="display:flex;"><span>                            .<span style="color:#50fa7b">s</span>(partitionKey)
</span></span><span style="display:flex;"><span>                            .<span style="color:#50fa7b">build</span>()
</span></span><span style="display:flex;"><span>                )
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">build</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Condition greaterThan2013Condition <span style="color:#ff79c6">=</span> Condition.<span style="color:#50fa7b">builder</span>()
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">comparisonOperator</span>(ComparisonOperator.<span style="color:#50fa7b">GT</span>)
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">attributeValueList</span>(
</span></span><span style="display:flex;"><span>                    AttributeValue.<span style="color:#50fa7b">builder</span>()
</span></span><span style="display:flex;"><span>                        .<span style="color:#50fa7b">n</span>(<span style="color:#ff79c6">&amp;</span>#34;2013<span style="color:#ff79c6">&amp;</span>#34;)
</span></span><span style="display:flex;"><span>                        .<span style="color:#50fa7b">build</span>()
</span></span><span style="display:flex;"><span>                )
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">build</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        QueryRequest yearAfter2013Query <span style="color:#ff79c6">=</span> QueryRequest.<span style="color:#50fa7b">builder</span>()
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">tableName</span>(currentTableName)
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">keyConditions</span>(
</span></span><span style="display:flex;"><span>                    Map.<span style="color:#50fa7b">of</span>(
</span></span><span style="display:flex;"><span>                        COMPANY, equalsGoogleCondition,
</span></span><span style="display:flex;"><span>                        YEAR, greaterThan2013Condition
</span></span><span style="display:flex;"><span>                    )
</span></span><span style="display:flex;"><span>                )
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">indexName</span>(COMPANY_YEAR_INDEX)
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">build</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        StepVerifier.<span style="color:#50fa7b">create</span>(Mono.<span style="color:#50fa7b">fromFuture</span>(dynamoDbAsyncClient.<span style="color:#50fa7b">query</span>(yearAfter2013Query)))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">expectNextMatches</span>(queryResponse <span style="color:#ff79c6">-&amp;</span>gt;
</span></span><span style="display:flex;"><span>                        queryResponse.<span style="color:#50fa7b">count</span>() <span style="color:#ff79c6">==</span> 2
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">&amp;</span>amp;<span style="color:#ff79c6">&amp;</span>amp; queryResponse.<span style="color:#50fa7b">items</span>()
</span></span><span style="display:flex;"><span>                            .<span style="color:#50fa7b">stream</span>()
</span></span><span style="display:flex;"><span>                            .<span style="color:#50fa7b">anyMatch</span>(attributeValueMap <span style="color:#ff79c6">-&amp;</span>gt; <span style="color:#ff79c6">&amp;</span>#34;Pixel 2<span style="color:#ff79c6">&amp;</span>#34;.<span style="color:#50fa7b">equals</span>(
</span></span><span style="display:flex;"><span>                                    attributeValueMap.<span style="color:#50fa7b">get</span>(MODEL).<span style="color:#50fa7b">s</span>())
</span></span><span style="display:flex;"><span>                            )
</span></span><span style="display:flex;"><span>                )
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">verifyComplete</span>();
</span></span></code></pre></div><p>Here, we create two <strong>Condition</strong> s [think: query conditions]. One gets used to indicate the hash key equals Google, the other is to indicate that the year associated with the item is strictly greater than 2013. We then use <strong>indexName</strong> in the DSL to specify that we need to use a specific index to pull this off. Finally, we validate the results are what we expect, leveraging <strong>Mono</strong> and <strong>StepVerifier</strong>. There is where our query is actually executed against dynamo and we get the response we are looking for [two records, Pixel 2 and Future Phone]. You should be able to run this test and see it pass.</p>
<p>Remember to <a href="https://github.com/nfisher23/webflux-and-dynamo/blob/master/src/test/java/com/nickolasfisher/reactivedynamo/PhoneServiceTest.java#L338">check out the source code for this article on Github</a>.</p>
</section>

  
    
  

    
  


  <footer>
    
      <div class="pb-14 taxonomy-list tags-list">
      
        <a href="/tags/java/" alt="Java">
          Java
        </a>
      
        <a href="/tags/distributed-systems/" alt="Distributed Systems">
          Distributed Systems
        </a>
      
        <a href="/tags/aws/" alt="Aws">
          Aws
        </a>
      
        <a href="/tags/dynamodb/" alt="Dynamodb">
          Dynamodb
        </a>
      
        <a href="/tags/webflux/" alt="Webflux">
          Webflux
        </a>
      
      </div>
    
  </footer>
</article>


    </main><footer class="pt-5 pb-10 grid gap-3 sm:grid-cols-2">
    <div class="text-xs font-semibold text-gray-500 order-2 sm:order-1">
  © 2018-2025 —
  <a href="http://localhost:1313/">Nick Fisher&#39;s tech blog</a> 
</div>

    <div class="order-1 sm:order-2">
  <ul class="flex sm:justify-end gap-5">
    
    
    <li>    
      <a href="https://www.linkedin.com/in/nick-fisher-software/" target="_blank" rel="noopener noreferrer">LinkedIn</a>
    </li>
    
    <li>    
      <a href="https://github.com/nfisher23" target="_blank" rel="noopener noreferrer">GitHub</a>
    </li>
    
    
  </ul>
</div>

</footer></body>
</html>
