<!DOCTYPE html>
<html lang="en-US" class="scroll-smooth dark">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>

<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Scanning a DynamoDB table in Java with the AWS SDK 2.0</title>
<meta
  name="description"
  content="Scanning in DynamoDB is exactly what it sounds like: loop through every single record in a table, optionally filtering for items with a certain condition when dynamo returns them to you. In general, you shouldn&#39;t do this. DynamoDB is designed to store and manage a very large amount of data. Scanning through a large amount of data is very expensive, even in a distributed world. In the best case, you&#39;ll be waiting a long time to see results. In the worst case, you might see service outages as you burn through your RCUs."
/>
<link rel="canonical" href="http://localhost:1313/blog/scanning-a-dynamodb-table-in-java-with-the-aws-sdk-20/" />
<link rel="robots" href="/robots.txt" />

<link rel="icon" type="image/x-icon" href="/icons/favicon.ico" />



<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });</script>

<link rel="stylesheet" href="http://localhost:1313/css/app.css" /></head>

  <body class="max-w-screen-md mx-auto px-2.5">
    <div class="header">
      <header class="flex flex-col sm:flex-row items-center gap-5 sm:gap-10 pt-16 py-12">
   


<div class="flex-none w-20 h-20 rounded-full overflow-hidden">
  <a href="http://localhost:1313/">
    <img
      srcset="/img/profile-picture_hu4241499301404582006.jpg 80w"
      src="/img/profile-picture.jpg"
      width="386"
      height="345"
      alt="Nick Fisher&#39;s tech blog"
    />
  </a>
</div>

  
  <div class="flex flex-col gap-5">
    <a href="http://localhost:1313/">
  <h1 id="site-title">Nick Fisher&#39;s tech blog</h1>
</a>
 
    <nav>
  <ul>
     
    
    <li>
      <a href="/" class="">
        Home
      </a>
    </li>
    
    <li>
      <a href="/blog" class="">
        Blog
      </a>
    </li>
    
    <li>
      <a href="/about" class="">
        About me
      </a>
    </li>
    
    <li>
      <a href="/categories" class="">
        Categories
      </a>
    </li>
    
    <li>
      <a href="/tags" class="">
        Tags
      </a>
    </li>
    
  </ul>
</nav>

  </div>
</header>

      <button class="toggle-theme" aria-label="Toggle Theme" title="Toggle Theme" onclick="toggleTheme()">
  <span class="theme-icon light"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
</svg> </span>
  <span class="theme-icon dark"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
</svg> </span>
</button>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const theme = localStorage.getItem('theme');

    if (!theme || theme === 'light') {
      setTheme('light');
    } else {
      setTheme(theme);
    }
  });

  function setTheme(theme) {
    const html = document.querySelector('html');
    localStorage.setItem('theme', theme);

    if (theme === 'light') {
      if (html.classList.contains('dark')) {
        document.querySelector('html').classList.remove('dark');
      }

      document.querySelector('.theme-icon.light').style.display = 'none';
      document.querySelector('.theme-icon.dark').style.display = 'block';
    } else {
      if (!html.classList.contains('dark')) {
        document.querySelector('html').classList.add('dark');
      }

      document.querySelector('.theme-icon.dark').style.display = 'none';
      document.querySelector('.theme-icon.light').style.display = 'block';
    }
  }

  function toggleTheme() {
    const theme = localStorage.getItem('theme');

    if (theme === 'light') {
      setTheme('dark');
    } else {
      setTheme('light');
    }
  }
</script>
    </div>
  
    <main id="content">

<article class="flex flex-col gap-10">
  <header class="flex flex-col gap-2">
    <h2 class="title-large">Scanning a DynamoDB table in Java with the AWS SDK 2.0</h2>

    <div class="meta">
      
      <time datetime="2020-11-07 02:08:37 &#43;0000 UTC" title='Sat, Nov 7, 2020, 2:08 AM UTC'>
        07/11/2020 - Estimated reading time: 3 minutes
      </time>

       
      
    </div>
  </header>

  

  <section><p><a href="https://docs.aws.amazon.com/amazondynamodb/latest/APIReference/API_Scan.html">Scanning in DynamoDB</a> is exactly what it sounds like: loop through every single record in a table, optionally filtering for items with a certain condition when dynamo returns them to you. In general, you <em>shouldn't do this</em>. DynamoDB is designed to store and manage a very large amount of data. Scanning through a large amount of data is very expensive, even in a distributed world. In the best case, you'll be waiting a long time to see results. In the worst case, you might see service outages as you burn through your RCUs.</p>
<p>But, if you're sure you want to do it, here's how. The <a href="https://github.com/nfisher23/webflux-and-dynamo/blob/master/src/test/java/com/nickolasfisher/reactivedynamo/PhoneServiceTest.java#L670">source code for everything that follows can be found on Github</a>.</p>
<h2 id="setup-table-test-data">Setup Table, Test Data</h2>
<p>Building off of previous posts, in particular one where we setup an embedded DynamoDB instance in Java, I'll start by creating a table with a hash and range key [&quot;Company&quot; and &quot;Model&quot;, both strings], then putting three items in it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    @Test
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">scanning</span>() <span style="color:#8be9fd;font-style:italic">throws</span> Exception {
</span></span><span style="display:flex;"><span>        String currentTableName <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">&amp;</span>#34;ScanTest<span style="color:#ff79c6">&amp;</span>#34;;
</span></span><span style="display:flex;"><span>        createTableAndWaitForComplete(currentTableName);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        String partitionKey <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">&amp;</span>#34;Google<span style="color:#ff79c6">&amp;</span>#34;;
</span></span><span style="display:flex;"><span>        String rangeKey1 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">&amp;</span>#34;Pixel 1<span style="color:#ff79c6">&amp;</span>#34;;
</span></span><span style="display:flex;"><span>        String rangeKey2 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">&amp;</span>#34;Future Phone<span style="color:#ff79c6">&amp;</span>#34;;
</span></span><span style="display:flex;"><span>        String rangeKey3 <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">&amp;</span>#34;Pixel 2<span style="color:#ff79c6">&amp;</span>#34;;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// create three items</span>
</span></span><span style="display:flex;"><span>        Map<span style="color:#ff79c6">&amp;</span>lt;String, AttributeValue<span style="color:#ff79c6">&amp;</span>gt; pixel1ItemAttributes <span style="color:#ff79c6">=</span> getMapWith(partitionKey, rangeKey1);
</span></span><span style="display:flex;"><span>        pixel1ItemAttributes.<span style="color:#50fa7b">put</span>(COLOR, AttributeValue.<span style="color:#50fa7b">builder</span>().<span style="color:#50fa7b">s</span>(<span style="color:#ff79c6">&amp;</span>#34;Blue<span style="color:#ff79c6">&amp;</span>#34;).<span style="color:#50fa7b">build</span>());
</span></span><span style="display:flex;"><span>        pixel1ItemAttributes.<span style="color:#50fa7b">put</span>(YEAR, AttributeValue.<span style="color:#50fa7b">builder</span>().<span style="color:#50fa7b">n</span>(<span style="color:#ff79c6">&amp;</span>#34;2012<span style="color:#ff79c6">&amp;</span>#34;).<span style="color:#50fa7b">build</span>());
</span></span><span style="display:flex;"><span>        putItem(currentTableName, pixel1ItemAttributes);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Map<span style="color:#ff79c6">&amp;</span>lt;String, AttributeValue<span style="color:#ff79c6">&amp;</span>gt; futurePhoneAttributes <span style="color:#ff79c6">=</span> getMapWith(partitionKey, rangeKey2);
</span></span><span style="display:flex;"><span>        futurePhoneAttributes.<span style="color:#50fa7b">put</span>(COLOR, AttributeValue.<span style="color:#50fa7b">builder</span>().<span style="color:#50fa7b">s</span>(<span style="color:#ff79c6">&amp;</span>#34;Silver<span style="color:#ff79c6">&amp;</span>#34;).<span style="color:#50fa7b">build</span>());
</span></span><span style="display:flex;"><span>        futurePhoneAttributes.<span style="color:#50fa7b">put</span>(YEAR, AttributeValue.<span style="color:#50fa7b">builder</span>().<span style="color:#50fa7b">n</span>(<span style="color:#ff79c6">&amp;</span>#34;2030<span style="color:#ff79c6">&amp;</span>#34;).<span style="color:#50fa7b">build</span>());
</span></span><span style="display:flex;"><span>        putItem(currentTableName, futurePhoneAttributes);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Map<span style="color:#ff79c6">&amp;</span>lt;String, AttributeValue<span style="color:#ff79c6">&amp;</span>gt; pixel2ItemAttributes <span style="color:#ff79c6">=</span> getMapWith(partitionKey, rangeKey3);
</span></span><span style="display:flex;"><span>        pixel2ItemAttributes.<span style="color:#50fa7b">put</span>(COLOR, AttributeValue.<span style="color:#50fa7b">builder</span>().<span style="color:#50fa7b">s</span>(<span style="color:#ff79c6">&amp;</span>#34;Cyan<span style="color:#ff79c6">&amp;</span>#34;).<span style="color:#50fa7b">build</span>());
</span></span><span style="display:flex;"><span>        pixel2ItemAttributes.<span style="color:#50fa7b">put</span>(YEAR, AttributeValue.<span style="color:#50fa7b">builder</span>().<span style="color:#50fa7b">n</span>(<span style="color:#ff79c6">&amp;</span>#34;2014<span style="color:#ff79c6">&amp;</span>#34;).<span style="color:#50fa7b">build</span>());
</span></span><span style="display:flex;"><span>        putItem(currentTableName, pixel2ItemAttributes);
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>With this in place, we can start scanning. If we include no filter, then scanning will return everything back to us. If there are so many items that they exceed certain quotas, then there will be pagination. In this case, three items isn't big enough for dynamo to bother with pagination:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// scan everything, return everything</span>
</span></span><span style="display:flex;"><span>        ScanRequest scanEverythingRequest <span style="color:#ff79c6">=</span> ScanRequest.<span style="color:#50fa7b">builder</span>().<span style="color:#50fa7b">tableName</span>(currentTableName).<span style="color:#50fa7b">build</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        StepVerifier.<span style="color:#50fa7b">create</span>(Mono.<span style="color:#50fa7b">fromFuture</span>(dynamoDbAsyncClient.<span style="color:#50fa7b">scan</span>(scanEverythingRequest)))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">expectNextMatches</span>(scanResponse <span style="color:#ff79c6">-&amp;</span>gt; scanResponse.<span style="color:#50fa7b">scannedCount</span>() <span style="color:#ff79c6">==</span> 3
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">&amp;</span>amp;<span style="color:#ff79c6">&amp;</span>amp; scanResponse.<span style="color:#50fa7b">items</span>().<span style="color:#50fa7b">size</span>() <span style="color:#ff79c6">==</span> 3
</span></span><span style="display:flex;"><span>                )
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">verifyComplete</span>();
</span></span></code></pre></div><p>We can also include a filter expression to limit the number of results. Critically, we can note that we <em>still scan the entire table</em> despite the existence of the filter expression. This is because attributes in an item are not indexed by default, and if you want to index them you need to create an index and then explicitly use that index.</p>
<p>Here, we include a filter expression on the color being &quot;Cyan&quot;:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// scan everything, return just items with Color == &amp;#34;Cyan&amp;#34;</span>
</span></span><span style="display:flex;"><span>        ScanRequest scanForCyanRequest <span style="color:#ff79c6">=</span> ScanRequest.<span style="color:#50fa7b">builder</span>()
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">tableName</span>(currentTableName)
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">filterExpression</span>(<span style="color:#ff79c6">&amp;</span>#34;Color <span style="color:#ff79c6">=</span> :color<span style="color:#ff79c6">&amp;</span>#34;)
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">expressionAttributeValues</span>(Map.<span style="color:#50fa7b">of</span>(<span style="color:#ff79c6">&amp;</span>#34;:color<span style="color:#ff79c6">&amp;</span>#34;, AttributeValue.<span style="color:#50fa7b">builder</span>().<span style="color:#50fa7b">s</span>(<span style="color:#ff79c6">&amp;</span>#34;Cyan<span style="color:#ff79c6">&amp;</span>#34;).<span style="color:#50fa7b">build</span>()))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">build</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        StepVerifier.<span style="color:#50fa7b">create</span>(Mono.<span style="color:#50fa7b">fromFuture</span>(dynamoDbAsyncClient.<span style="color:#50fa7b">scan</span>(scanForCyanRequest)))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">expectNextMatches</span>(scanResponse <span style="color:#ff79c6">-&amp;</span>gt; scanResponse.<span style="color:#50fa7b">scannedCount</span>() <span style="color:#ff79c6">==</span> 3
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">&amp;</span>amp;<span style="color:#ff79c6">&amp;</span>amp; scanResponse.<span style="color:#50fa7b">items</span>().<span style="color:#50fa7b">size</span>() <span style="color:#ff79c6">==</span> 1
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">&amp;</span>amp;<span style="color:#ff79c6">&amp;</span>amp; scanResponse.<span style="color:#50fa7b">items</span>().<span style="color:#50fa7b">get</span>(0).<span style="color:#50fa7b">get</span>(<span style="color:#ff79c6">&amp;</span>#34;Year<span style="color:#ff79c6">&amp;</span>#34;).<span style="color:#50fa7b">n</span>().<span style="color:#50fa7b">equals</span>(<span style="color:#ff79c6">&amp;</span>#34;2014<span style="color:#ff79c6">&amp;</span>#34;)
</span></span><span style="display:flex;"><span>                )
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">verifyComplete</span>();
</span></span></code></pre></div><p>Feel free to <a href="https://github.com/nfisher23/webflux-and-dynamo/blob/master/src/test/java/com/nickolasfisher/reactivedynamo/PhoneServiceTest.java#L670">get the source code from Github</a> and play around with it yourself. You will be able to run this integration test and see it pass.</p>
</section>

  
    
  

    
  


  <footer>
    
      <div class="pb-14 taxonomy-list tags-list">
      
        <a href="/tags/java/" alt="Java">
          Java
        </a>
      
        <a href="/tags/aws/" alt="Aws">
          Aws
        </a>
      
        <a href="/tags/dynamodb/" alt="Dynamodb">
          Dynamodb
        </a>
      
      </div>
    
  </footer>
</article>


    </main><footer class="pt-5 pb-10 grid gap-3 sm:grid-cols-2">
    <div class="text-xs font-semibold text-gray-500 order-2 sm:order-1">
  © 2018-2025 —
  <a href="http://localhost:1313/">Nick Fisher&#39;s tech blog</a> 
</div>

    <div class="order-1 sm:order-2">
  <ul class="flex sm:justify-end gap-5">
    
    
    <li>    
      <a href="https://www.linkedin.com/in/nick-fisher-software/" target="_blank" rel="noopener noreferrer">LinkedIn</a>
    </li>
    
    <li>    
      <a href="https://github.com/nfisher23" target="_blank" rel="noopener noreferrer">GitHub</a>
    </li>
    
    
  </ul>
</div>

</footer></body>
</html>
