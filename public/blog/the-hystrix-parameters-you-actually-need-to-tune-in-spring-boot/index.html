<!doctype html><html lang=en-US class="scroll-smooth dark"><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>The Hystrix Parameters You Actually Need to Tune in Spring Boot</title>
<meta name=description content="There is some [hacky] code for this post on Github.
The number of hystrix configuration options, as of this writing, is about 34. In reality, you don&rsquo;t need to worry about most of them, as the defaults are perfectly reasonable. This article discusses those parameters that, in my experience, you typically need to pay attention to and tune, and I have provided some examples using spring boot&rsquo;s support for hystrix via the javanica library."><link rel=canonical href=https://www.nickolasfisher.com/blog/the-hystrix-parameters-you-actually-need-to-tune-in-spring-boot/><link rel=robots href=/robots.txt><link rel=icon type=image/x-icon href=/img/nficon.png><script type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type=text/x-mathjax-config>MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });</script><link rel=stylesheet href="https://www.nickolasfisher.com/css/app.min.dee9c4afb37cb95c5d39c976614ef6f95398bcba4b6e73066c44de2a3a6543ed.css"></head><body class="max-w-screen-md mx-auto px-2.5"><div class=header><header class="flex flex-col sm:flex-row items-center gap-5 sm:gap-10 pt-16 py-12"><div class="flex-none w-20 h-20 rounded-full overflow-hidden"><a href=https://www.nickolasfisher.com/><img srcset="/img/profile-picture_hu4241499301404582006.jpg 80w" src=/img/profile-picture.jpg width=386 height=345 alt="Nick Fisher's tech blog"></a></div><div class="flex flex-col gap-5"><a href=https://www.nickolasfisher.com/><h1 id=site-title>Nick Fisher's tech blog</h1></a><nav><ul><li><a href=/>home</a></li><li><a href=/blog>blog</a></li><li><a href=/about>about</a></li><li><a href=/tags>Tags</a></li></ul></nav></div></header><button class=toggle-theme aria-label="Toggle Theme" title="Toggle Theme" onclick=toggleTheme()>
<span class="theme-icon light"><svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75.0 11-7.5.0 3.75 3.75.0 017.5.0z"/></svg> </span><span class="theme-icon dark"><svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718.0 0118 15.75c-5.385.0-9.75-4.365-9.75-9.75.0-1.33.266-2.597.748-3.752A9.753 9.753.0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753.0 009.002-5.998z"/></svg> </span></button>
<script>document.addEventListener("DOMContentLoaded",function(){const e=localStorage.getItem("theme");setTheme(!e||e==="light"?"light":e)});function setTheme(e){const t=document.querySelector("html");localStorage.setItem("theme",e),e==="light"?(t.classList.contains("dark")&&document.querySelector("html").classList.remove("dark"),document.querySelector(".theme-icon.light").style.display="none",document.querySelector(".theme-icon.dark").style.display="block"):(t.classList.contains("dark")||document.querySelector("html").classList.add("dark"),document.querySelector(".theme-icon.dark").style.display="none",document.querySelector(".theme-icon.light").style.display="block")}function toggleTheme(){const e=localStorage.getItem("theme");setTheme(e==="light"?"dark":"light")}</script></div><main id=content><article class="flex flex-col gap-10"><header class="flex flex-col gap-2"><h2 class=title-large>The Hystrix Parameters You Actually Need to Tune in Spring Boot</h2><div class=meta><time datetime="2020-06-13 17:53:33 +0000 UTC" title='Sat, Jun 13, 2020, 5:53 PM UTC'>13/06/2020 - Estimated reading time: 5 minutes</time></div></header><section><p>There is some [hacky] code for this post <a href=https://github.com/nfisher23/hystrix-playground>on Github</a>.</p><p>The <a href=https://github.com/Netflix/Hystrix/wiki/Configuration>number of hystrix configuration options</a>, as of this writing, is about 34. In reality, you don&rsquo;t need to worry about most of them, as the defaults are perfectly reasonable. This article discusses those parameters that, in my experience, you typically need to pay attention to and tune, and I have provided some examples using spring boot&rsquo;s support for hystrix via the <a href=https://github.com/Netflix/Hystrix/tree/master/hystrix-contrib/hystrix-javanica>javanica library</a>.</p><h2 id=fallback>Fallback</h2><p>By default, there is no fallback, which means when the operation fails the exception just bubbles up to the client. For the vast majority of GET requests, it is better to give the user stale data (that you&rsquo;ve presumably cached upstream as a backup) than no data at all, or give the user an error modal on whatever client facing app is consuming it.</p><p>To setup a fallback, use the <strong>fallbackMethod</strong> property like so:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>    @HystrixCommand(
</span></span><span style=display:flex><span>            fallbackMethod <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;fallback&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>public</span> String <span style=color:#50fa7b>getDownstream</span>(String uuid) {
</span></span><span style=display:flex><span>        LOG.<span style=color:#50fa7b>info</span>(<span style=color:#f1fa8c>&#34;inside getDownstream with: {}&#34;</span>, uuid);
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>this</span>.<span style=color:#50fa7b>longRestTemplate</span>.<span style=color:#50fa7b>getForEntity</span>(<span style=color:#f1fa8c>&#34;http://localhost:9100/downstream&#34;</span>, String.<span style=color:#50fa7b>class</span>).<span style=color:#50fa7b>getBody</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>private</span> String <span style=color:#50fa7b>fallback</span>(String uuid, Throwable t) {
</span></span><span style=display:flex><span>        LOG.<span style=color:#50fa7b>warn</span>(<span style=color:#f1fa8c>&#34;ex: {}&#34;</span>, t.<span style=color:#50fa7b>getClass</span>());
</span></span><span style=display:flex><span>        LOG.<span style=color:#50fa7b>warn</span>(<span style=color:#f1fa8c>&#34;Thrown: {}&#34;</span>, t.<span style=color:#50fa7b>getMessage</span>());
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> <span style=color:#f1fa8c>&#34;fallback&#34;</span>;
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><p>This will execute the fallback method and just log the exception that caused it&ndash;whether it was an intermittent error or the circuit tripped and all requests are now being blocked.</p><h2 id=thread-pool-key>Thread Pool Key</h2><p>By default, hystrix will use the same threadpool for all configured <strong>HystrixCommand</strong> s. This is very rarely what you want, because it means that operations that are likely unrelated can both saturate the shared thread pool (causing <strong>RejectedExecutionException</strong> s if too many get backed up, the point of the bulkhead), as well can trip the circuit for everybody else.</p><p>If you set the thread pool key, then the library will create a separate threadpool that is not the default and give you the isolation between components that is a key reason to want to use hystrix in the first place: to give users a degraded experience that recovers more quickly, rather than giving users no experience at all because your app is borked:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>    @HystrixCommand(
</span></span><span style=display:flex><span>            threadPoolKey <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;prim&#34;</span>,
</span></span><span style=display:flex><span>            fallbackMethod <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;fallback&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>public</span> String <span style=color:#50fa7b>getDownstream</span>(String uuid) {
</span></span><span style=display:flex><span>        LOG.<span style=color:#50fa7b>info</span>(<span style=color:#f1fa8c>&#34;inside getDownstream with: {}&#34;</span>, uuid);
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>this</span>.<span style=color:#50fa7b>longRestTemplate</span>.<span style=color:#50fa7b>getForEntity</span>(<span style=color:#f1fa8c>&#34;http://localhost:9100/downstream&#34;</span>, String.<span style=color:#50fa7b>class</span>).<span style=color:#50fa7b>getBody</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>private</span> String <span style=color:#50fa7b>fallback</span>(String uuid, Throwable t) {
</span></span><span style=display:flex><span>        LOG.<span style=color:#50fa7b>warn</span>(<span style=color:#f1fa8c>&#34;ex: {}&#34;</span>, t.<span style=color:#50fa7b>getClass</span>());
</span></span><span style=display:flex><span>        LOG.<span style=color:#50fa7b>warn</span>(<span style=color:#f1fa8c>&#34;Thrown: {}&#34;</span>, t.<span style=color:#50fa7b>getMessage</span>());
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> <span style=color:#f1fa8c>&#34;fallback&#34;</span>;
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><p>Here, hystrix will create a thread pool and label the prefix with <strong>prim</strong>. Trip this circuit and the main thread pool will be unaffected and continue to process requests independently.</p><h2 id=thread-execution-timeout>Thread Execution Timeout</h2><p>Almost always, hystrix is used to protect against failures from network calls. If we could guarantee that there were no bugs in the library we were using to execute those network calls, then the <strong>execution.isolation.thread.timeoutInMilliseconds</strong> property would be useless or even harmful. However, there are bugs everywhere, this is the nature of human beings writing software.</p><p>Hystrix by default will delegate the actual execution of the code in a <strong>HystrixCommand</strong> to a different spawned thread, and watch it. If it takes too long (default is 1 second or 1000 milliseconds), then hystrix will nuke that thread midway through whatever it&rsquo;s doing. If, for example, you are making a network call and have a three second timeout, then you&rsquo;re nuking a thread that was still active and that was just waiting for the downstream operation to occur.</p><p>You should set this property to a millisecond value that should theoretically never occur. If you&rsquo;ve set up the read timeout for a REST API call to be 3000 milliseconds, then you should set this to something like 4000 milliseconds&ndash;only necessary if there is a bug somewhere in the library that you&rsquo;re using. You can set it like so:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>    @HystrixCommand(commandProperties <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>            @HystrixProperty(name <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;execution.isolation.thread.timeoutInMilliseconds&#34;</span>, value <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;2000&#34;</span>)
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>            threadPoolKey <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;prim&#34;</span>,
</span></span><span style=display:flex><span>            fallbackMethod <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;fallback&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>public</span> String <span style=color:#50fa7b>getDownstream</span>(String uuid) {
</span></span><span style=display:flex><span>        LOG.<span style=color:#50fa7b>info</span>(<span style=color:#f1fa8c>&#34;inside getDownstream with: {}&#34;</span>, uuid);
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>this</span>.<span style=color:#50fa7b>longRestTemplate</span>.<span style=color:#50fa7b>getForEntity</span>(<span style=color:#f1fa8c>&#34;http://localhost:9100/downstream&#34;</span>, String.<span style=color:#50fa7b>class</span>).<span style=color:#50fa7b>getBody</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>private</span> String <span style=color:#50fa7b>fallback</span>(String uuid, Throwable t) {
</span></span><span style=display:flex><span>        LOG.<span style=color:#50fa7b>warn</span>(<span style=color:#f1fa8c>&#34;ex: {}&#34;</span>, t.<span style=color:#50fa7b>getClass</span>());
</span></span><span style=display:flex><span>        LOG.<span style=color:#50fa7b>warn</span>(<span style=color:#f1fa8c>&#34;Thrown: {}&#34;</span>, t.<span style=color:#50fa7b>getMessage</span>());
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> <span style=color:#f1fa8c>&#34;fallback&#34;</span>;
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><p>Here, we set it to 2000 milliseconds.</p><h2 id=core-pool-size>Core Pool Size</h2><p>The &ldquo;thread pool&rdquo; in a hystrix thread pool isn&rsquo;t really a thread pool so much as a gate to prevent over usage. Yes, a different thread is technically delegated to, but rather than be a buffer to balance the workload it is primarily meant to be a way to stop too much of the application&rsquo;s resources being saturated in a single misbehaving block of code. By default, the <strong>coreSize</strong> of the thread pool is 10 with no backing queue to wait for requests, which means that at any given time, only ten requests can be executing. This is usually fine, but can sometimes be a bit restrictive and you might want this to be higher. You can set it like so:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>    @HystrixCommand(commandProperties <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>            @HystrixProperty(name <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;execution.isolation.thread.timeoutInMilliseconds&#34;</span>, value <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;2000&#34;</span>)
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span>            threadPoolKey <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;prim&#34;</span>,
</span></span><span style=display:flex><span>            threadPoolProperties <span style=color:#ff79c6>=</span> {
</span></span><span style=display:flex><span>                    @HystrixProperty(name <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;coreSize&#34;</span>, value <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;30&#34;</span>)
</span></span><span style=display:flex><span>            },
</span></span><span style=display:flex><span>            fallbackMethod <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;fallback&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>public</span> String <span style=color:#50fa7b>getDownstream</span>(String uuid) {
</span></span><span style=display:flex><span>        LOG.<span style=color:#50fa7b>info</span>(<span style=color:#f1fa8c>&#34;inside getDownstream with: {}&#34;</span>, uuid);
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> <span style=color:#ff79c6>this</span>.<span style=color:#50fa7b>longRestTemplate</span>.<span style=color:#50fa7b>getForEntity</span>(<span style=color:#f1fa8c>&#34;http://localhost:9100/downstream&#34;</span>, String.<span style=color:#50fa7b>class</span>).<span style=color:#50fa7b>getBody</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>private</span> String <span style=color:#50fa7b>fallback</span>(String uuid, Throwable t) {
</span></span><span style=display:flex><span>        LOG.<span style=color:#50fa7b>warn</span>(<span style=color:#f1fa8c>&#34;ex: {}&#34;</span>, t.<span style=color:#50fa7b>getClass</span>());
</span></span><span style=display:flex><span>        LOG.<span style=color:#50fa7b>warn</span>(<span style=color:#f1fa8c>&#34;Thrown: {}&#34;</span>, t.<span style=color:#50fa7b>getMessage</span>());
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> <span style=color:#f1fa8c>&#34;fallback&#34;</span>;
</span></span><span style=display:flex><span>    }
</span></span></code></pre></div><p>Here, the core pool size is set to thirty.</p><h2 id=circuit-breaker-sleep-window>Circuit Breaker Sleep Window</h2><p>This property isn&rsquo;t really that important unless you&rsquo;re operating at significant scale, but I thought I would mention it because it can sometimes matter. The <strong>hystrix.command.default.circuitBreaker.sleepWindowInMilliseconds</strong> property defines how long to wait after a circuit trips before letting a request through to poke the downstream dependency. By default, it&rsquo;s five seconds, which in my experience is too conservative because it only lets one request through every five seconds until a successful response. I prefer for this to be 1-3 seconds, depending on the quirks of the system you&rsquo;re working with. There are also cases where making this number larger works, it again depends on the quirks of your system.</p><p>You set this in the <strong>commandProperties</strong> section with the <strong>name</strong> of <strong>circuitBreaker.sleepWindowInMilliseconds</strong> and a value in milliseconds, e.g. 1000. We&rsquo;ll leave that exercise to the reader :)</p><p>I threw up some kind of crummy code in this github repository: <a href=https://github.com/nfisher23/hystrix-playground.>https://github.com/nfisher23/hystrix-playground.</a> Feel free to clone it and modify it as you see fit.</p></section><footer><div class="pb-14 taxonomy-list tags-list"><a href=/tags/java/ alt=Java>Java
</a><a href=/tags/spring/ alt=Spring>Spring</a></div></footer></article></main><footer class="pt-5 pb-10 grid gap-3 sm:grid-cols-2"><div class="text-xs font-semibold text-gray-500 order-2 sm:order-1">© 2018-2025 —
<a href=https://www.nickolasfisher.com/>Nick Fisher's tech blog</a></div><div class="order-1 sm:order-2"><ul class="flex sm:justify-end gap-5"><li><a href=https://www.linkedin.com/in/nick-fisher-software/ target=_blank rel="noopener noreferrer">LinkedIn</a></li><li><a href=https://github.com/nfisher23 target=_blank rel="noopener noreferrer">GitHub</a></li></ul></div></footer></body></html>