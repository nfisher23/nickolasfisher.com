<!doctype html><html lang=en-US class="scroll-smooth dark"><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>The Java Stream API: Collecting Downstream Elements</title>
<meta name=description content="You can view the sample code associated with this post on GitHub.
One interesting feature of collecting streams using the Collectors.groupingBy(..) method is the ability to manipulate downstream elements. Basically,
this means that, after you group the keys of the map, you can further make changes to the collection that the map is pointing to. By default, it collects to a list."><link rel=canonical href=https://www.nickolasfisher.com/blog/the-java-stream-api-collecting-downstream-elements/><link rel=robots href=/robots.txt><link rel=icon type=image/x-icon href=/img/nficon.png><script type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type=text/x-mathjax-config>MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });</script><link rel=stylesheet href="https://www.nickolasfisher.com/css/app.min.dee9c4afb37cb95c5d39c976614ef6f95398bcba4b6e73066c44de2a3a6543ed.css"></head><body class="max-w-screen-md mx-auto px-2.5"><div class=header><header class="flex flex-col sm:flex-row items-center gap-5 sm:gap-10 pt-16 py-12"><div class="flex-none w-20 h-20 rounded-full overflow-hidden"><a href=https://www.nickolasfisher.com/><img srcset="/img/profile-picture_hu4241499301404582006.jpg 80w" src=/img/profile-picture.jpg width=386 height=345 alt="Nick Fisher's tech blog"></a></div><div class="flex flex-col gap-5"><a href=https://www.nickolasfisher.com/><h1 id=site-title>Nick Fisher's tech blog</h1></a><nav><ul><li><a href=/>home</a></li><li><a href=/blog>blog</a></li><li><a href=/about>about</a></li><li><a href=/tags>Tags</a></li></ul></nav></div></header><button class=toggle-theme aria-label="Toggle Theme" title="Toggle Theme" onclick=toggleTheme()>
<span class="theme-icon light"><svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75.0 11-7.5.0 3.75 3.75.0 017.5.0z"/></svg> </span><span class="theme-icon dark"><svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718.0 0118 15.75c-5.385.0-9.75-4.365-9.75-9.75.0-1.33.266-2.597.748-3.752A9.753 9.753.0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753.0 009.002-5.998z"/></svg> </span></button>
<script>document.addEventListener("DOMContentLoaded",function(){const e=localStorage.getItem("theme");setTheme(!e||e==="light"?"light":e)});function setTheme(e){const t=document.querySelector("html");localStorage.setItem("theme",e),e==="light"?(t.classList.contains("dark")&&document.querySelector("html").classList.remove("dark"),document.querySelector(".theme-icon.light").style.display="none",document.querySelector(".theme-icon.dark").style.display="block"):(t.classList.contains("dark")||document.querySelector("html").classList.add("dark"),document.querySelector(".theme-icon.dark").style.display="none",document.querySelector(".theme-icon.light").style.display="block")}function toggleTheme(){const e=localStorage.getItem("theme");setTheme(e==="light"?"dark":"light")}</script></div><main id=content><article class="flex flex-col gap-10"><header class="flex flex-col gap-2"><h2 class=title-large>The Java Stream API: Collecting Downstream Elements</h2><div class=meta><time datetime="2018-10-21 16:29:32 +0000 UTC" title='Sun, Oct 21, 2018, 4:29 PM UTC'>21/10/2018 - Estimated reading time: 4 minutes</time></div></header><section><p>You can view the sample code associated with this post <a href=https://github.com/nfisher23/java_stream_api_samples>on GitHub</a>.</p><p>One interesting feature of collecting streams using the <code>Collectors.groupingBy(..)</code> method is the ability to manipulate <em>downstream</em> elements. Basically,
this means that, after you group the keys of the map, you can further make changes to the collection that the map is pointing to. By default, it collects to a list.</p><p>We&rsquo;ll start with a SimplePair object:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd;font-style:italic>class</span> <span style=color:#50fa7b>SimplePair</span> {
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>private</span> String name;
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>private</span> <span style=color:#8be9fd>int</span> id;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>public</span> String <span style=color:#50fa7b>getName</span>() {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> name;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>setName</span>(String name) {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>this</span>.<span style=color:#50fa7b>name</span> <span style=color:#ff79c6>=</span> name;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd>int</span> <span style=color:#50fa7b>getId</span>() {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> id;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>setId</span>(<span style=color:#8be9fd>int</span> id) {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>this</span>.<span style=color:#50fa7b>id</span> <span style=color:#ff79c6>=</span> id;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    @Override
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>public</span> String <span style=color:#50fa7b>toString</span>() {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> <span style=color:#f1fa8c>&#34;name-&#34;</span> <span style=color:#ff79c6>+</span> name <span style=color:#ff79c6>+</span> <span style=color:#f1fa8c>&#34;,id-&#34;</span> <span style=color:#ff79c6>+</span> id;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Then, if we generate a collection of SimplePairs:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd;font-style:italic>static</span> List<span style=color:#ff79c6>&lt;</span>SimplePair<span style=color:#ff79c6>&gt;</span> <span style=color:#50fa7b>generateSimplePairs</span>(<span style=color:#8be9fd>int</span> numToGenerate) {
</span></span><span style=display:flex><span>    List<span style=color:#ff79c6>&lt;</span>SimplePair<span style=color:#ff79c6>&gt;</span> pairs <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> ArrayList<span style=color:#ff79c6>&lt;&gt;</span>();
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>for</span> (<span style=color:#8be9fd>int</span> i <span style=color:#ff79c6>=</span> 1; i <span style=color:#ff79c6>&lt;=</span> numToGenerate; i<span style=color:#ff79c6>++</span>) {
</span></span><span style=display:flex><span>        SimplePair pair <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> SimplePair();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        pair.<span style=color:#50fa7b>setId</span>(i);
</span></span><span style=display:flex><span>        pair.<span style=color:#50fa7b>setName</span>(<span style=color:#f1fa8c>&#34;pair&#34;</span> <span style=color:#ff79c6>+</span> i);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        pairs.<span style=color:#50fa7b>add</span>(pair);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> pairs;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>And we add duplicate ids for the third element like:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>private</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>addDuplicatePairs</span>() {
</span></span><span style=display:flex><span>    simplePairs.<span style=color:#50fa7b>add</span>(<span style=color:#ff79c6>new</span> SimplePair() {{
</span></span><span style=display:flex><span>        setId(3);
</span></span><span style=display:flex><span>        setName(<span style=color:#f1fa8c>&#34;another-pair3&#34;</span>);
</span></span><span style=display:flex><span>    }});
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    simplePairs.<span style=color:#50fa7b>add</span>(<span style=color:#ff79c6>new</span> SimplePair() {{
</span></span><span style=display:flex><span>        setId(3);
</span></span><span style=display:flex><span>        setName(<span style=color:#f1fa8c>&#34;yet-another-pair3&#34;</span>);
</span></span><span style=display:flex><span>    }});
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Now our collection looks like &ldquo;[(id: 1, name: pair1), (id: 2, name: pair2), (id: 3, name: pair3), (id: 3, name: another-pair3), (id: 3, name: yet-another-pair3) &mldr; ]&rdquo;</p><p>Now that we have data to work with, we can get to manipulating the downstream elements, we can map based on the id to a List, which is the default of groupingBy(..), like:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>@Test
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>groupingBy_toList</span>() {
</span></span><span style=display:flex><span>    addDuplicatePairs();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    Map<span style=color:#ff79c6>&lt;</span>Integer, List<span style=color:#ff79c6>&lt;</span>SimplePair<span style=color:#ff79c6>&gt;&gt;</span> defaultsToList <span style=color:#ff79c6>=</span> simplePairs.<span style=color:#50fa7b>stream</span>().<span style=color:#50fa7b>collect</span>(
</span></span><span style=display:flex><span>            Collectors.<span style=color:#50fa7b>groupingBy</span>(SimplePair::getId)
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    assertEquals(3, defaultsToList.<span style=color:#50fa7b>get</span>(3).<span style=color:#50fa7b>size</span>());
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>You can insist that it collects into a set by passing in <code>Collectors.toSet(..)</code> downstream:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>@Test
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>groupingBy_toSet</span>() {
</span></span><span style=display:flex><span>    addDuplicatePairs();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    Map<span style=color:#ff79c6>&lt;</span>Integer, Set<span style=color:#ff79c6>&lt;</span>SimplePair<span style=color:#ff79c6>&gt;&gt;</span> idToSetOfPairs <span style=color:#ff79c6>=</span> simplePairs.<span style=color:#50fa7b>stream</span>().<span style=color:#50fa7b>collect</span>(
</span></span><span style=display:flex><span>            Collectors.<span style=color:#50fa7b>groupingBy</span>(SimplePair::getId, Collectors.<span style=color:#50fa7b>toSet</span>())
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    assertEquals(3, idToSetOfPairs.<span style=color:#50fa7b>get</span>(3).<span style=color:#50fa7b>size</span>());
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>You can count the number of elements in the collection downstream, and map to that, by calling <code>Collectors.counting()</code> on the downstream elements:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>@Test
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>groupingBy_count</span>() {
</span></span><span style=display:flex><span>    addDuplicatePairs();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    Map<span style=color:#ff79c6>&lt;</span>Integer, Long<span style=color:#ff79c6>&gt;</span> countIdOccurrence <span style=color:#ff79c6>=</span> simplePairs.<span style=color:#50fa7b>stream</span>().<span style=color:#50fa7b>collect</span>(
</span></span><span style=display:flex><span>            Collectors.<span style=color:#50fa7b>groupingBy</span>(SimplePair::getId, Collectors.<span style=color:#50fa7b>counting</span>())
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    assertEquals(3, countIdOccurrence.<span style=color:#50fa7b>get</span>(3).<span style=color:#50fa7b>intValue</span>());
</span></span><span style=display:flex><span>    assertEquals(1, countIdOccurrence.<span style=color:#50fa7b>get</span>(1).<span style=color:#50fa7b>intValue</span>());
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>You can sum all of the values of a specific property downstream by calling <code>Collectors.summingInt(Class::property)</code>.
Here, we sum up all the id&rsquo;s for the downstream elements:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>@Test
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>groupingBy_sumDownstreamElements</span>() {
</span></span><span style=display:flex><span>    addDuplicatePairs();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    Map<span style=color:#ff79c6>&lt;</span>Integer, Integer<span style=color:#ff79c6>&gt;</span> addUpIds <span style=color:#ff79c6>=</span> simplePairs.<span style=color:#50fa7b>stream</span>().<span style=color:#50fa7b>collect</span>(
</span></span><span style=display:flex><span>            Collectors.<span style=color:#50fa7b>groupingBy</span>(SimplePair::getId, Collectors.<span style=color:#50fa7b>summingInt</span>(SimplePair::getId))
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    assertEquals(9, addUpIds.<span style=color:#50fa7b>get</span>(3).<span style=color:#50fa7b>intValue</span>());
</span></span><span style=display:flex><span>    assertEquals(4, addUpIds.<span style=color:#50fa7b>get</span>(4).<span style=color:#50fa7b>intValue</span>());
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>You can get the maximum length downstream by passing in a Comparator to <code>Collectors.maxBy(..)</code> and
specifying the <code>length()</code> to be compared:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>@Test
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>groupingBy_getMaxDownstreamElement</span>() {
</span></span><span style=display:flex><span>    addDuplicatePairs();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    Map<span style=color:#ff79c6>&lt;</span>Integer, Optional<span style=color:#ff79c6>&lt;</span>SimplePair<span style=color:#ff79c6>&gt;&gt;</span> sortByMaxDownstream <span style=color:#ff79c6>=</span> simplePairs.<span style=color:#50fa7b>stream</span>().<span style=color:#50fa7b>collect</span>(
</span></span><span style=display:flex><span>            Collectors.<span style=color:#50fa7b>groupingBy</span>(SimplePair::getId, Collectors.<span style=color:#50fa7b>maxBy</span>(
</span></span><span style=display:flex><span>                    Comparator.<span style=color:#50fa7b>comparing</span>(sp <span style=color:#ff79c6>-&gt;</span> sp.<span style=color:#50fa7b>getName</span>().<span style=color:#50fa7b>length</span>())
</span></span><span style=display:flex><span>            ))
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    String maxNameOfThree <span style=color:#ff79c6>=</span> sortByMaxDownstream.<span style=color:#50fa7b>get</span>(3).<span style=color:#50fa7b>orElseThrow</span>(RuntimeException::<span style=color:#ff79c6>new</span>).<span style=color:#50fa7b>getName</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    assertEquals(<span style=color:#f1fa8c>&#34;yet-another-pair3&#34;</span>, maxNameOfThree);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>You can get the minimum value using the same approach but with the <code>Collectors.minBy(..)</code> method:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>@Test
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>groupingBy_getMinDownstreamElement</span>() {
</span></span><span style=display:flex><span>    addDuplicatePairs();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    Map<span style=color:#ff79c6>&lt;</span>Integer, Optional<span style=color:#ff79c6>&lt;</span>SimplePair<span style=color:#ff79c6>&gt;&gt;</span> sortByMinDownstream <span style=color:#ff79c6>=</span> simplePairs.<span style=color:#50fa7b>stream</span>().<span style=color:#50fa7b>collect</span>(
</span></span><span style=display:flex><span>            Collectors.<span style=color:#50fa7b>groupingBy</span>(SimplePair::getId, Collectors.<span style=color:#50fa7b>minBy</span>(
</span></span><span style=display:flex><span>                    Comparator.<span style=color:#50fa7b>comparing</span>(simplePair <span style=color:#ff79c6>-&gt;</span> simplePair.<span style=color:#50fa7b>getName</span>().<span style=color:#50fa7b>length</span>())
</span></span><span style=display:flex><span>            ))
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    String minNameOfThree <span style=color:#ff79c6>=</span> sortByMinDownstream.<span style=color:#50fa7b>get</span>(3).<span style=color:#50fa7b>orElseThrow</span>(RuntimeException::<span style=color:#ff79c6>new</span>).<span style=color:#50fa7b>getName</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    assertEquals(<span style=color:#f1fa8c>&#34;pair3&#34;</span>, minNameOfThree);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Finally, you can nest downstream elements as much as you would like. Here, we map the ids to a collection of Integers, which are the length() value
of the name field in SimplePair. This can be a little difficult to wrap your head around at first&ndash;basically, we are collecting a Map&lt;> of ids to objects, then
we are collecting to the List into a Map&lt;>, where the map is a map of the lengths of the name property (say that five times fast):</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>@Test
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>groupingBy_mapsToMaps</span>() {
</span></span><span style=display:flex><span>    addDuplicatePairs();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    Map<span style=color:#ff79c6>&lt;</span>Integer, Map<span style=color:#ff79c6>&lt;</span>Integer, List<span style=color:#ff79c6>&lt;</span>SimplePair<span style=color:#ff79c6>&gt;&gt;&gt;</span> mapToSetOfLengths <span style=color:#ff79c6>=</span> simplePairs.<span style=color:#50fa7b>stream</span>().<span style=color:#50fa7b>collect</span>(Collectors.<span style=color:#50fa7b>groupingBy</span>(
</span></span><span style=display:flex><span>            SimplePair::getId,
</span></span><span style=display:flex><span>            Collectors.<span style=color:#50fa7b>groupingBy</span>(sp <span style=color:#ff79c6>-&gt;</span> sp.<span style=color:#50fa7b>getName</span>().<span style=color:#50fa7b>length</span>(), Collectors.<span style=color:#50fa7b>toList</span>())
</span></span><span style=display:flex><span>    ));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    Map<span style=color:#ff79c6>&lt;</span>Integer, List<span style=color:#ff79c6>&lt;</span>SimplePair<span style=color:#ff79c6>&gt;&gt;</span> lengthsToSimplePairsWithId1 <span style=color:#ff79c6>=</span> mapToSetOfLengths.<span style=color:#50fa7b>get</span>(1);
</span></span><span style=display:flex><span>    Map<span style=color:#ff79c6>&lt;</span>Integer, List<span style=color:#ff79c6>&lt;</span>SimplePair<span style=color:#ff79c6>&gt;&gt;</span> lengthsToSimplePairsWithId3 <span style=color:#ff79c6>=</span> mapToSetOfLengths.<span style=color:#50fa7b>get</span>(3);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    assertEquals(1, lengthsToSimplePairsWithId1.<span style=color:#50fa7b>size</span>());
</span></span><span style=display:flex><span>    assertEquals(3, lengthsToSimplePairsWithId3.<span style=color:#50fa7b>size</span>());
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This process can get pretty confusing, and it&rsquo;s not likely to be helpful in the vast majority of situations. Getting too cute with downstream elements could leave anyone else who looks at the code (including you) with a lot of questions&ndash;which takes up valuable time. But, it is one obscure tool to throw in the garage.</p><p>For a slightly less obscure example, but still fairly out there, we turn to <code>Collectors.mapping(..)</code>, which collects the mapping downstream
into a collection of your choosing. Here, we&rsquo;ll collect a list of length() properties in the downstream SimplePair element:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>@Test
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>groupingBy_mappingToMoreDownstreamElements</span>() {
</span></span><span style=display:flex><span>    addDuplicatePairs();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    Map<span style=color:#ff79c6>&lt;</span>Integer, List<span style=color:#ff79c6>&lt;</span>Integer<span style=color:#ff79c6>&gt;&gt;</span> mapIdsToSetOfLengths <span style=color:#ff79c6>=</span> simplePairs.<span style=color:#50fa7b>stream</span>().<span style=color:#50fa7b>collect</span>(Collectors.<span style=color:#50fa7b>groupingBy</span>(
</span></span><span style=display:flex><span>            SimplePair::getId,
</span></span><span style=display:flex><span>            Collectors.<span style=color:#50fa7b>mapping</span>(sp <span style=color:#ff79c6>-&gt;</span> sp.<span style=color:#50fa7b>getName</span>().<span style=color:#50fa7b>length</span>(), Collectors.<span style=color:#50fa7b>toList</span>())
</span></span><span style=display:flex><span>    ));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    assertEquals(5, mapIdsToSetOfLengths.<span style=color:#50fa7b>get</span>(3).<span style=color:#50fa7b>get</span>(0).<span style=color:#50fa7b>intValue</span>());
</span></span><span style=display:flex><span>    assertEquals(13, mapIdsToSetOfLengths.<span style=color:#50fa7b>get</span>(3).<span style=color:#50fa7b>get</span>(1).<span style=color:#50fa7b>intValue</span>());
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><footer><div class="pb-14 taxonomy-list tags-list"><a href=/tags/java/ alt=Java>Java
</a><a href=/tags/java-stream-api/ alt="Java Stream Api">Java Stream Api</a></div></footer></article></main><footer class="pt-5 pb-10 grid gap-3 sm:grid-cols-2"><div class="text-xs font-semibold text-gray-500 order-2 sm:order-1">© 2018-2025 —
<a href=https://www.nickolasfisher.com/>Nick Fisher's tech blog</a></div><div class="order-1 sm:order-2"><ul class="flex sm:justify-end gap-5"><li><a href=https://www.linkedin.com/in/nick-fisher-software/ target=_blank rel="noopener noreferrer">LinkedIn</a></li><li><a href=https://github.com/nfisher23 target=_blank rel="noopener noreferrer">GitHub</a></li></ul></div></footer></body></html>