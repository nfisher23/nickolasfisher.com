<!doctype html><html lang=en-US class="scroll-smooth dark"><head><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>The Java Stream API: Creating Custom, Lazy, Infinite Streams</title>
<meta name=description content="You can find the sample code from this post on GitHub.
There are a few built in ways to create your own custom streams. While many collections offer a direct .stream() method,
you can also use Stream.of(..) to just make one in place:"><link rel=canonical href=https://www.nickolasfisher.com/blog/the-java-stream-api-creating-custom-lazy-infinite-streams/><link rel=robots href=/robots.txt><link rel=icon type=image/x-icon href=/img/nficon.png><script type=text/javascript src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type=text/x-mathjax-config>MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });</script><link rel=stylesheet href="https://www.nickolasfisher.com/css/app.min.dee9c4afb37cb95c5d39c976614ef6f95398bcba4b6e73066c44de2a3a6543ed.css"></head><body class="max-w-screen-md mx-auto px-2.5"><div class=header><header class="flex flex-col sm:flex-row items-center gap-5 sm:gap-10 pt-16 py-12"><div class="flex-none w-20 h-20 rounded-full overflow-hidden"><a href=https://www.nickolasfisher.com/><img srcset="/img/profile-picture_hu4241499301404582006.jpg 80w" src=/img/profile-picture.jpg width=386 height=345 alt="Nick Fisher's tech blog"></a></div><div class="flex flex-col gap-5"><a href=https://www.nickolasfisher.com/><h1 id=site-title>Nick Fisher's tech blog</h1></a><nav><ul><li><a href=/>home</a></li><li><a href=/blog>blog</a></li><li><a href=/about>about</a></li><li><a href=/tags>Tags</a></li></ul></nav></div></header><button class=toggle-theme aria-label="Toggle Theme" title="Toggle Theme" onclick=toggleTheme()>
<span class="theme-icon light"><svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386-1.591 1.591M21 12h-2.25m-.386 6.364-1.591-1.591M12 18.75V21m-4.773-4.227-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75.0 11-7.5.0 3.75 3.75.0 017.5.0z"/></svg> </span><span class="theme-icon dark"><svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718.0 0118 15.75c-5.385.0-9.75-4.365-9.75-9.75.0-1.33.266-2.597.748-3.752A9.753 9.753.0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753.0 009.002-5.998z"/></svg> </span></button>
<script>document.addEventListener("DOMContentLoaded",function(){const e=localStorage.getItem("theme");setTheme(!e||e==="light"?"light":e)});function setTheme(e){const t=document.querySelector("html");localStorage.setItem("theme",e),e==="light"?(t.classList.contains("dark")&&document.querySelector("html").classList.remove("dark"),document.querySelector(".theme-icon.light").style.display="none",document.querySelector(".theme-icon.dark").style.display="block"):(t.classList.contains("dark")||document.querySelector("html").classList.add("dark"),document.querySelector(".theme-icon.dark").style.display="none",document.querySelector(".theme-icon.light").style.display="block")}function toggleTheme(){const e=localStorage.getItem("theme");setTheme(e==="light"?"dark":"light")}</script></div><main id=content><article class="flex flex-col gap-10"><header class="flex flex-col gap-2"><h2 class=title-large>The Java Stream API: Creating Custom, Lazy, Infinite Streams</h2><div class=meta><time datetime="2018-10-20 13:50:54 +0000 UTC" title='Sat, Oct 20, 2018, 1:50 PM UTC'>20/10/2018 - Estimated reading time: 3 minutes</time></div></header><section><p>You can find the sample code from this post <a href=https://github.com/nfisher23/java_stream_api_samples>on GitHub</a>.</p><p>There are a few built in ways to create your own custom streams. While many collections offer a direct <code>.stream()</code> method,
you can also use <code>Stream.of(..)</code> to just make one in place:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>@Test
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>simpleStream</span>() {
</span></span><span style=display:flex><span>    Stream<span style=color:#ff79c6>&lt;</span>String<span style=color:#ff79c6>&gt;</span> emotions <span style=color:#ff79c6>=</span> Stream.<span style=color:#50fa7b>of</span>(<span style=color:#f1fa8c>&#34;happy&#34;</span>, <span style=color:#f1fa8c>&#34;sad&#34;</span>, <span style=color:#f1fa8c>&#34;ecstatic&#34;</span>, <span style=color:#f1fa8c>&#34;joyful&#34;</span>, <span style=color:#f1fa8c>&#34;exuberant&#34;</span>, <span style=color:#f1fa8c>&#34;jealous&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    List<span style=color:#ff79c6>&lt;</span>String<span style=color:#ff79c6>&gt;</span> listOfJs <span style=color:#ff79c6>=</span> emotions.<span style=color:#50fa7b>filter</span>(emotion <span style=color:#ff79c6>-&gt;</span> emotion.<span style=color:#50fa7b>startsWith</span>(<span style=color:#f1fa8c>&#34;j&#34;</span>)).<span style=color:#50fa7b>collect</span>(Collectors.<span style=color:#50fa7b>toList</span>());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    assertEquals(2, listOfJs.<span style=color:#50fa7b>size</span>());
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Streams in Java are lazy by default. This means that nothing actually happens, and data doesn&rsquo;t actually start flowing, until we ask for it
via terminal operations. For example, if we have our familiar collection of names:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd;font-style:italic>static</span> List<span style=color:#ff79c6>&lt;</span>String<span style=color:#ff79c6>&gt;</span> <span style=color:#50fa7b>getListOfNames</span>() {
</span></span><span style=display:flex><span>    List<span style=color:#ff79c6>&lt;</span>String<span style=color:#ff79c6>&gt;</span> names <span style=color:#ff79c6>=</span> <span style=color:#ff79c6>new</span> ArrayList<span style=color:#ff79c6>&lt;&gt;</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    names.<span style=color:#50fa7b>add</span>(<span style=color:#f1fa8c>&#34;John&#34;</span>);
</span></span><span style=display:flex><span>    names.<span style=color:#50fa7b>add</span>(<span style=color:#f1fa8c>&#34;Jacob&#34;</span>);
</span></span><span style=display:flex><span>    names.<span style=color:#50fa7b>add</span>(<span style=color:#f1fa8c>&#34;Jerry&#34;</span>);
</span></span><span style=display:flex><span>    names.<span style=color:#50fa7b>add</span>(<span style=color:#f1fa8c>&#34;Josephine&#34;</span>);
</span></span><span style=display:flex><span>    names.<span style=color:#50fa7b>add</span>(<span style=color:#f1fa8c>&#34;Janine&#34;</span>);
</span></span><span style=display:flex><span>    names.<span style=color:#50fa7b>add</span>(<span style=color:#f1fa8c>&#34;Alan&#34;</span>);
</span></span><span style=display:flex><span>    names.<span style=color:#50fa7b>add</span>(<span style=color:#f1fa8c>&#34;Beverly&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> names;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>And we run:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>@Test
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>lazyStreams</span>() {
</span></span><span style=display:flex><span>    <span style=color:#6272a4>// nothing gets printed</span>
</span></span><span style=display:flex><span>    Stream<span style=color:#ff79c6>&lt;</span>String<span style=color:#ff79c6>&gt;</span> template <span style=color:#ff79c6>=</span> names.<span style=color:#50fa7b>stream</span>().<span style=color:#50fa7b>peek</span>(System.<span style=color:#50fa7b>out</span>::println).<span style=color:#50fa7b>filter</span>(n <span style=color:#ff79c6>-&gt;</span> n.<span style=color:#50fa7b>length</span>() <span style=color:#ff79c6>&gt;</span> 4);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Nothing gets printed to the console, because the stream has not been terminated, and no data is flowing. For all intensive purposes, nothing tangible has happened (e.g. a meeting at work).</p><p>To get the <code>println()</code> method to execute, you would have to call a terminal operator:</p><pre tabindex=0><code>@Test
public void lazyStreams_withTerminalOperator() {
    Stream&lt;String&gt; template = names.stream().peek(System.out::println).filter(n -&gt; n.length() &gt; 4);

    // execute here
    template.collect(Collectors.toList());
}
</code></pre><p>This concept presents a lot of interesting opportunities. The most obvious that might come to mind would be the idea of infinite streams.
Because nothing gets executed, we can create a template that acts as an &ldquo;infinite&rdquo; stream. One way to do this is via the <code>Stream.generate(..)</code>
method, which takes a Supplier. We can create a count from zero to infinity like so:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>private</span> <span style=color:#8be9fd;font-style:italic>class</span> <span style=color:#50fa7b>SupplyInfinity</span> <span style=color:#8be9fd;font-style:italic>implements</span> Supplier<span style=color:#ff79c6>&lt;</span>Integer<span style=color:#ff79c6>&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>private</span> <span style=color:#8be9fd>int</span> counter <span style=color:#ff79c6>=</span> 0;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    @Override
</span></span><span style=display:flex><span>    <span style=color:#8be9fd;font-style:italic>public</span> Integer <span style=color:#50fa7b>get</span>() {
</span></span><span style=display:flex><span>        <span style=color:#ff79c6>return</span> counter<span style=color:#ff79c6>++</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>@Test
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>infinteStreams_withCustomSupplier</span>() {
</span></span><span style=display:flex><span>    Stream<span style=color:#ff79c6>&lt;</span>Integer<span style=color:#ff79c6>&gt;</span> infinity <span style=color:#ff79c6>=</span> Stream.<span style=color:#50fa7b>generate</span>(<span style=color:#ff79c6>new</span> SupplyInfinity());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    List<span style=color:#ff79c6>&lt;</span>Integer<span style=color:#ff79c6>&gt;</span> collected <span style=color:#ff79c6>=</span> infinity.<span style=color:#50fa7b>limit</span>(100).<span style=color:#50fa7b>collect</span>(Collectors.<span style=color:#50fa7b>toList</span>());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    assertEquals(99, collected.<span style=color:#50fa7b>get</span>(99).<span style=color:#50fa7b>intValue</span>());
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Calling <code>limit(..)</code>, predictably, limits the number of elements in the stream. So here, we generate the numbers 0 to 99.</p><p>Streams are lazy, which means that a data point is pulled from the beginning of the stream and drawn through the stream only when it has to.
This means that infinite streams still get processed one element at a time. For example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>@Test
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>verifyLazinessOfStream</span>() {
</span></span><span style=display:flex><span>    Stream.<span style=color:#50fa7b>iterate</span>(0.<span style=color:#50fa7b>0</span>, num <span style=color:#ff79c6>-&gt;</span> num <span style=color:#ff79c6>+</span> (<span style=color:#ff79c6>new</span> Random()).<span style=color:#50fa7b>nextInt</span>(2) <span style=color:#ff79c6>-</span> .<span style=color:#50fa7b>5</span>)
</span></span><span style=display:flex><span>            .<span style=color:#50fa7b>peek</span>(num <span style=color:#ff79c6>-&gt;</span> System.<span style=color:#50fa7b>out</span>.<span style=color:#50fa7b>println</span>(<span style=color:#f1fa8c>&#34;getting &#34;</span> <span style=color:#ff79c6>+</span> num))
</span></span><span style=display:flex><span>            .<span style=color:#50fa7b>limit</span>(5).<span style=color:#50fa7b>collect</span>(Collectors.<span style=color:#50fa7b>toList</span>());
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>This prints out one hundred random elements, even though we&rsquo;re calling <code>peek(..)</code> before we tell the stream to limit the results to five.</p><p>We can also create an infinite stream using the <code>Stream.iterate(..)</code> method. Here, you pass in a seed value, then a method to act on each subsequent value, which gets computed from the
previous value. So, if we want to get the numbers 0 to 99, we would start the iterator with zero and add one to it each time:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java><span style=display:flex><span>@Test
</span></span><span style=display:flex><span><span style=color:#8be9fd;font-style:italic>public</span> <span style=color:#8be9fd>void</span> <span style=color:#50fa7b>infiniteStreams_withIterate</span>() {
</span></span><span style=display:flex><span>    Stream<span style=color:#ff79c6>&lt;</span>Integer<span style=color:#ff79c6>&gt;</span> infinity <span style=color:#ff79c6>=</span> Stream.<span style=color:#50fa7b>iterate</span>(0, num <span style=color:#ff79c6>-&gt;</span> num <span style=color:#ff79c6>+</span> 1);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    List<span style=color:#ff79c6>&lt;</span>Integer<span style=color:#ff79c6>&gt;</span> collected <span style=color:#ff79c6>=</span> infinity.<span style=color:#50fa7b>limit</span>(100).<span style=color:#50fa7b>collect</span>(Collectors.<span style=color:#50fa7b>toList</span>());
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    assertEquals(99, collected.<span style=color:#50fa7b>get</span>(99).<span style=color:#50fa7b>intValue</span>());
</span></span><span style=display:flex><span>}
</span></span></code></pre></div></section><footer><div class="pb-14 taxonomy-list tags-list"><a href=/tags/java/ alt=Java>Java
</a><a href=/tags/java-stream-api/ alt="Java Stream Api">Java Stream Api</a></div></footer></article></main><footer class="pt-5 pb-10 grid gap-3 sm:grid-cols-2"><div class="text-xs font-semibold text-gray-500 order-2 sm:order-1">© 2018-2025 —
<a href=https://www.nickolasfisher.com/>Nick Fisher's tech blog</a></div><div class="order-1 sm:order-2"><ul class="flex sm:justify-end gap-5"><li><a href=https://www.linkedin.com/in/nick-fisher-software/ target=_blank rel="noopener noreferrer">LinkedIn</a></li><li><a href=https://github.com/nfisher23 target=_blank rel="noopener noreferrer">GitHub</a></li></ul></div></footer></body></html>