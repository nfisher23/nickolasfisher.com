<!DOCTYPE html>
<html lang="en-US" class="scroll-smooth dark">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>

<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>The Java Stream API: How to Work With Optional Types</title>
<meta
  name="description"
  content="You can find the sample code associated with this post on GitHub.
If Java programmers had a generic Facebook page, they would collectively have an &quot;it&#39;s complicated&quot; relationship with the null value."
/>
<link rel="canonical" href="http://localhost:1313/blog/the-java-stream-api-how-to-work-with-optional-types/" />
<link rel="robots" href="/robots.txt" />

<link rel="icon" type="image/x-icon" href="/icons/favicon.ico" />



<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });</script>

<link rel="stylesheet" href="http://localhost:1313/css/app.css" /></head>

  <body class="max-w-screen-md mx-auto px-2.5">
    <div class="header">
      <header class="flex flex-col sm:flex-row items-center gap-5 sm:gap-10 pt-16 py-12">
   


<div class="flex-none w-20 h-20 rounded-full overflow-hidden">
  <a href="http://localhost:1313/">
    <img
      srcset="/img/profile-picture_hu4241499301404582006.jpg 80w"
      src="/img/profile-picture.jpg"
      width="386"
      height="345"
      alt="Nick Fisher&#39;s tech blog"
    />
  </a>
</div>

  
  <div class="flex flex-col gap-5">
    <a href="http://localhost:1313/">
  <h1 id="site-title">Nick Fisher&#39;s tech blog</h1>
</a>
 
    <nav>
  <ul>
     
    
    <li>
      <a href="/" class="">
        Home
      </a>
    </li>
    
    <li>
      <a href="/blog" class="">
        Blog
      </a>
    </li>
    
    <li>
      <a href="/about" class="">
        About me
      </a>
    </li>
    
    <li>
      <a href="/categories" class="">
        Categories
      </a>
    </li>
    
    <li>
      <a href="/tags" class="">
        Tags
      </a>
    </li>
    
  </ul>
</nav>

  </div>
</header>

      <button class="toggle-theme" aria-label="Toggle Theme" title="Toggle Theme" onclick="toggleTheme()">
  <span class="theme-icon light"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
</svg> </span>
  <span class="theme-icon dark"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
</svg> </span>
</button>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const theme = localStorage.getItem('theme');

    if (!theme || theme === 'light') {
      setTheme('light');
    } else {
      setTheme(theme);
    }
  });

  function setTheme(theme) {
    const html = document.querySelector('html');
    localStorage.setItem('theme', theme);

    if (theme === 'light') {
      if (html.classList.contains('dark')) {
        document.querySelector('html').classList.remove('dark');
      }

      document.querySelector('.theme-icon.light').style.display = 'none';
      document.querySelector('.theme-icon.dark').style.display = 'block';
    } else {
      if (!html.classList.contains('dark')) {
        document.querySelector('html').classList.add('dark');
      }

      document.querySelector('.theme-icon.dark').style.display = 'none';
      document.querySelector('.theme-icon.light').style.display = 'block';
    }
  }

  function toggleTheme() {
    const theme = localStorage.getItem('theme');

    if (theme === 'light') {
      setTheme('dark');
    } else {
      setTheme('light');
    }
  }
</script>
    </div>
  
    <main id="content">

<article class="flex flex-col gap-10">
  <header class="flex flex-col gap-2">
    <h2 class="title-large">The Java Stream API: How to Work With Optional Types</h2>

    <div class="meta">
      
      <time datetime="2018-10-20 21:59:38 &#43;0000 UTC" title='Sat, Oct 20, 2018, 9:59 PM UTC'>
        20/10/2018 - Estimated reading time: 4 minutes
      </time>

       
      
    </div>
  </header>

  

  <section><p>You can find the sample code associated with this post <a href="https://github.com/nfisher23/java_stream_api_samples">on GitHub</a>.</p>
<p>If Java programmers had a generic Facebook page, they would collectively have an &quot;it's complicated&quot; relationship with the null value.</p>
<p>Constantly having to check for null values can certainly be a real boon, both in the readability of your code as well as in the hidden implication that not
checking for null means something might blow up. Of course, you could enforce contracts that say to never return null, but there are unfortunately, valid use cases for null.
For example, if you query for an Account using a primary key and there is no account in the database, letting the method responsible for that
return an empty Account value would be disingenuous&ndash;it's not that the Account had empty fields, after all, but that there wasn't an Account at all.</p>
<p>The Java Stream API has provided a thoughtful solution to this problem through its Optional&lt;T&gt; type. The Optional&lt;T&gt; types allows us to more easily
specify behavior that we want to take place if a value exists or not.</p>
<p>For example, working with our familiar set of names:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> List<span style="color:#ff79c6">&amp;</span>lt;String<span style="color:#ff79c6">&amp;</span>gt; getListOfNames() {
</span></span><span style="display:flex;"><span>    List<span style="color:#ff79c6">&amp;</span>lt;String<span style="color:#ff79c6">&amp;</span>gt; names <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> ArrayList<span style="color:#ff79c6">&amp;</span>lt;<span style="color:#ff79c6">&amp;</span>gt;();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    names.<span style="color:#50fa7b">add</span>(<span style="color:#ff79c6">&amp;</span>#34;John<span style="color:#ff79c6">&amp;</span>#34;);
</span></span><span style="display:flex;"><span>    names.<span style="color:#50fa7b">add</span>(<span style="color:#ff79c6">&amp;</span>#34;Jacob<span style="color:#ff79c6">&amp;</span>#34;);
</span></span><span style="display:flex;"><span>    names.<span style="color:#50fa7b">add</span>(<span style="color:#ff79c6">&amp;</span>#34;Jerry<span style="color:#ff79c6">&amp;</span>#34;);
</span></span><span style="display:flex;"><span>    names.<span style="color:#50fa7b">add</span>(<span style="color:#ff79c6">&amp;</span>#34;Josephine<span style="color:#ff79c6">&amp;</span>#34;);
</span></span><span style="display:flex;"><span>    names.<span style="color:#50fa7b">add</span>(<span style="color:#ff79c6">&amp;</span>#34;Janine<span style="color:#ff79c6">&amp;</span>#34;);
</span></span><span style="display:flex;"><span>    names.<span style="color:#50fa7b">add</span>(<span style="color:#ff79c6">&amp;</span>#34;Alan<span style="color:#ff79c6">&amp;</span>#34;);
</span></span><span style="display:flex;"><span>    names.<span style="color:#50fa7b">add</span>(<span style="color:#ff79c6">&amp;</span>#34;Beverly<span style="color:#ff79c6">&amp;</span>#34;);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> names;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>We can select the last element, sorted by case, with the
max(String::comparingToIgnoreCase) declaration. When we do that, we get an Optional:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>Optional<span style="color:#ff79c6">&amp;</span>lt;String<span style="color:#ff79c6">&amp;</span>gt; maxName <span style="color:#ff79c6">=</span> names.<span style="color:#50fa7b">stream</span>().<span style="color:#50fa7b">max</span>(String::compareToIgnoreCase);
</span></span></code></pre></div><p>Now, if we didn't get a maximum name&ndash;which might happen if the collection were empty&ndash;the Optional would be empty. But if we did, the Optional would contain a value.
One way to deal with that is with the <code>OrElse(..)</code> method, which says &quot;if there is a value in the Optional, give me that value. If there is not a value in the Optional, then give me the value I pass in
to the OrElse method:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Test
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">optional_max</span>() {
</span></span><span style="display:flex;"><span>    Optional<span style="color:#ff79c6">&amp;</span>lt;String<span style="color:#ff79c6">&amp;</span>gt; maxName <span style="color:#ff79c6">=</span> names.<span style="color:#50fa7b">stream</span>().<span style="color:#50fa7b">max</span>(String::compareToIgnoreCase);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    assertEquals(<span style="color:#ff79c6">&amp;</span>#34;Josephine<span style="color:#ff79c6">&amp;</span>#34;, maxName.<span style="color:#50fa7b">orElse</span>(<span style="color:#ff79c6">&amp;</span>#34;<span style="color:#ff79c6">&amp;</span>#34;));
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Above, we can see that Josephine is the max string, i.e. the one last alphabetically in the collection. But what if there is no value? The behavior is predictable:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Test
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">optional_orElse</span>() {
</span></span><span style="display:flex;"><span>    Optional<span style="color:#ff79c6">&amp;</span>lt;String<span style="color:#ff79c6">&amp;</span>gt; doesntExist <span style="color:#ff79c6">=</span> names.<span style="color:#50fa7b">stream</span>().<span style="color:#50fa7b">filter</span>(name <span style="color:#ff79c6">-&amp;</span>gt; name.<span style="color:#50fa7b">startsWith</span>(<span style="color:#ff79c6">&amp;</span>#34;Z<span style="color:#ff79c6">&amp;</span>#34;)).<span style="color:#50fa7b">findAny</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    assertEquals(<span style="color:#ff79c6">&amp;</span>#34;<span style="color:#ff79c6">default</span><span style="color:#ff79c6">&amp;</span>#34;, doesntExist.<span style="color:#50fa7b">orElse</span>(<span style="color:#ff79c6">&amp;</span>#34;<span style="color:#ff79c6">default</span><span style="color:#ff79c6">&amp;</span>#34;));
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Sometimes, if the Optional&lt;T&gt; is empty, we want to run a method that generates a value for use. We can do that with <code>OrElseGet(..)</code>,
which takes a Supplier&lt;T&gt;. Here, we will compute the current time value as a String:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Test
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">optional_orElseGet</span>() {
</span></span><span style="display:flex;"><span>    Optional<span style="color:#ff79c6">&amp;</span>lt;String<span style="color:#ff79c6">&amp;</span>gt; doesntExist <span style="color:#ff79c6">=</span> names.<span style="color:#50fa7b">stream</span>().<span style="color:#50fa7b">filter</span>(name <span style="color:#ff79c6">-&amp;</span>gt; name.<span style="color:#50fa7b">startsWith</span>(<span style="color:#ff79c6">&amp;</span>#34;Z<span style="color:#ff79c6">&amp;</span>#34;)).<span style="color:#50fa7b">findAny</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    String stringTime <span style="color:#ff79c6">=</span> doesntExist.<span style="color:#50fa7b">orElseGet</span>(() <span style="color:#ff79c6">-&amp;</span>gt; Instant.<span style="color:#50fa7b">now</span>().<span style="color:#50fa7b">toString</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    System.<span style="color:#50fa7b">out</span>.<span style="color:#50fa7b">println</span>(stringTime);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>If we don't get a value in an Optional, we might want to throw a custom exception. Without Optionals, our code would just throw a
NullPointerException, which might be too vague for us to easily find a solution to. We can throw a custom exception with
<code>OrElseThrow(..)</code>. Here, we will throw a RuntimeException:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Test(expected <span style="color:#ff79c6">=</span> RuntimeException.<span style="color:#50fa7b">class</span>)
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">optional_orElseThrow</span>() {
</span></span><span style="display:flex;"><span>    Optional<span style="color:#ff79c6">&amp;</span>lt;String<span style="color:#ff79c6">&amp;</span>gt; doesntExist <span style="color:#ff79c6">=</span> names.<span style="color:#50fa7b">stream</span>().<span style="color:#50fa7b">filter</span>(name <span style="color:#ff79c6">-&amp;</span>gt; name.<span style="color:#50fa7b">startsWith</span>(<span style="color:#ff79c6">&amp;</span>#34;Z<span style="color:#ff79c6">&amp;</span>#34;)).<span style="color:#50fa7b">findAny</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    doesntExist.<span style="color:#50fa7b">orElseThrow</span>(() <span style="color:#ff79c6">-&amp;</span>gt; <span style="color:#ff79c6">new</span> RuntimeException(<span style="color:#ff79c6">&amp;</span>#34;No names starting with <span style="color:#ff79c6">&amp;</span>#39;Z<span style="color:#ff79c6">&amp;</span>#39; in the collection<span style="color:#ff79c6">&amp;</span>#34;));
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Perhaps the most useful of the methods we can run on an Optional&lt;T&gt; is <code>ifPresent(..)</code>. <code>ifPresent(..)</code> runs only if the Optional
contains a value, does nothing otherwise, and it takes a Consumer&lt;T&gt;. If we have a real simple Consumer that simply saves the value you
pass into it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">private</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">SimpleConsumer</span> <span style="color:#8be9fd;font-style:italic">implements</span> Consumer<span style="color:#ff79c6">&amp;</span>lt;String<span style="color:#ff79c6">&amp;</span>gt; {
</span></span><span style="display:flex;"><span>    String internalValue <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">null</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Override
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">accept</span>(String s) {
</span></span><span style="display:flex;"><span>        internalValue <span style="color:#ff79c6">=</span> s;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>We can then validate that the method does, in fact, run, with a test like so:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Test
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">optional_ifPresent_exists</span>() {
</span></span><span style="display:flex;"><span>    Optional<span style="color:#ff79c6">&amp;</span>lt;String<span style="color:#ff79c6">&amp;</span>gt; alan <span style="color:#ff79c6">=</span> names.<span style="color:#50fa7b">stream</span>().<span style="color:#50fa7b">filter</span>(name <span style="color:#ff79c6">-&amp;</span>gt; name.<span style="color:#50fa7b">equals</span>(<span style="color:#ff79c6">&amp;</span>#34;Alan<span style="color:#ff79c6">&amp;</span>#34;)).<span style="color:#50fa7b">findFirst</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    SimpleConsumer shouldRun <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> SimpleConsumer();
</span></span><span style="display:flex;"><span>    alan.<span style="color:#50fa7b">ifPresent</span>(shouldRun);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    assertEquals(<span style="color:#ff79c6">&amp;</span>#34;Alan<span style="color:#ff79c6">&amp;</span>#34;, shouldRun.<span style="color:#50fa7b">internalValue</span>);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Whereas it does nothing if there isn't a value:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Test
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">optional_ifPresent_DNE</span>() {
</span></span><span style="display:flex;"><span>    Optional<span style="color:#ff79c6">&amp;</span>lt;String<span style="color:#ff79c6">&amp;</span>gt; notHere <span style="color:#ff79c6">=</span> names.<span style="color:#50fa7b">stream</span>().<span style="color:#50fa7b">filter</span>(name <span style="color:#ff79c6">-&amp;</span>gt; name.<span style="color:#50fa7b">equals</span>(<span style="color:#ff79c6">&amp;</span>#34;Not a Real Name<span style="color:#ff79c6">&amp;</span>#34;)).<span style="color:#50fa7b">findFirst</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    notHere.<span style="color:#50fa7b">ifPresent</span>(name <span style="color:#ff79c6">-&amp;</span>gt; { <span style="color:#ff79c6">throw</span> <span style="color:#ff79c6">new</span> RuntimeException(<span style="color:#ff79c6">&amp;</span>#34;<span style="color:#ff79c6">this</span> exception won<span style="color:#ff79c6">&amp;</span>#39;t get thrown<span style="color:#ff79c6">&amp;</span>#34;); });
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>There are other methods we can run on Optionals as well, which have parallel concepts to Streams. In many ways, it's fair to think of
an Optional&lt;T&gt; as a Stream with zero or one elements. We can map the value, if there is one, like so:</p>
<pre tabindex="0"><code>@Test
public void optional_map() {
    Optional&amp;lt;String&amp;gt; alan = names.stream().filter(name -&amp;gt; name.equals(&amp;#34;Alan&amp;#34;)).findFirst();

    Optional&amp;lt;String&amp;gt; firstChar = alan.map(name -&amp;gt; name.substring(0, 1));

    assertEquals(&amp;#34;A&amp;#34;, firstChar.orElseThrow(RuntimeException::new));
}
</code></pre></section>

  
    
  

    
  


  <footer>
    
  </footer>
</article>


    </main><footer class="pt-5 pb-10 grid gap-3 sm:grid-cols-2">
    <div class="text-xs font-semibold text-gray-500 order-2 sm:order-1">
  © 2018-2025 —
  <a href="http://localhost:1313/">Nick Fisher&#39;s tech blog</a> 
</div>

    <div class="order-1 sm:order-2">
  <ul class="flex sm:justify-end gap-5">
    
    
    <li>    
      <a href="https://www.linkedin.com/in/nick-fisher-software/" target="_blank" rel="noopener noreferrer">LinkedIn</a>
    </li>
    
    <li>    
      <a href="https://github.com/nfisher23" target="_blank" rel="noopener noreferrer">GitHub</a>
    </li>
    
    
  </ul>
</div>

</footer></body>
</html>
