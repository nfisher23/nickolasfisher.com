<!DOCTYPE html>
<html lang="en-US" class="scroll-smooth dark">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>

<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>The Java Stream API: Parallel Streams</title>
<meta
  name="description"
  content="The sample code for this post can be found on GitHub.
Parallel Streams are simple to generate in Java. Instead of calling .stream(), you simply call parallelStream(). Here, we&#39;ll take our familiar list of names:"
/>
<link rel="canonical" href="http://localhost:1313/blog/the-java-stream-api-parallel-streams/" />
<link rel="robots" href="/robots.txt" />

<link rel="icon" type="image/x-icon" href="/img/nficon.png" />



<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });</script>

<link rel="stylesheet" href="http://localhost:1313/css/app.css" /></head>

  <body class="max-w-screen-md mx-auto px-2.5">
    <div class="header">
      <header class="flex flex-col sm:flex-row items-center gap-5 sm:gap-10 pt-16 py-12">
   


<div class="flex-none w-20 h-20 rounded-full overflow-hidden">
  <a href="http://localhost:1313/">
    <img
      srcset="/img/profile-picture_hu4241499301404582006.jpg 80w"
      src="/img/profile-picture.jpg"
      width="386"
      height="345"
      alt="Nick Fisher&#39;s tech blog"
    />
  </a>
</div>

  
  <div class="flex flex-col gap-5">
    <a href="http://localhost:1313/">
  <h1 id="site-title">Nick Fisher&#39;s tech blog</h1>
</a>
 
    <nav>
  <ul>
     
    
    <li>
      <a href="/" class="">
        home
      </a>
    </li>
    
    <li>
      <a href="/blog" class="">
        blog
      </a>
    </li>
    
    <li>
      <a href="/about" class="">
        about
      </a>
    </li>
    
    <li>
      <a href="/tags" class="">
        Tags
      </a>
    </li>
    
  </ul>
</nav>

  </div>
</header>

      <button class="toggle-theme" aria-label="Toggle Theme" title="Toggle Theme" onclick="toggleTheme()">
  <span class="theme-icon light"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
</svg> </span>
  <span class="theme-icon dark"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
</svg> </span>
</button>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const theme = localStorage.getItem('theme');

    if (!theme || theme === 'light') {
      setTheme('light');
    } else {
      setTheme(theme);
    }
  });

  function setTheme(theme) {
    const html = document.querySelector('html');
    localStorage.setItem('theme', theme);

    if (theme === 'light') {
      if (html.classList.contains('dark')) {
        document.querySelector('html').classList.remove('dark');
      }

      document.querySelector('.theme-icon.light').style.display = 'none';
      document.querySelector('.theme-icon.dark').style.display = 'block';
    } else {
      if (!html.classList.contains('dark')) {
        document.querySelector('html').classList.add('dark');
      }

      document.querySelector('.theme-icon.dark').style.display = 'none';
      document.querySelector('.theme-icon.light').style.display = 'block';
    }
  }

  function toggleTheme() {
    const theme = localStorage.getItem('theme');

    if (theme === 'light') {
      setTheme('dark');
    } else {
      setTheme('light');
    }
  }
</script>
    </div>
  
    <main id="content">

<article class="flex flex-col gap-10">
  <header class="flex flex-col gap-2">
    <h2 class="title-large">The Java Stream API: Parallel Streams</h2>

    <div class="meta">
      
      <time datetime="2018-10-21 20:03:56 &#43;0000 UTC" title='Sun, Oct 21, 2018, 8:03 PM UTC'>
        21/10/2018 - Estimated reading time: 2 minutes
      </time>

       
      
    </div>
  </header>

  

  <section><p>The sample code for this post can be found <a href="https://github.com/nfisher23/java_stream_api_samples">on GitHub</a>.</p>
<p>Parallel Streams are simple to generate in Java. Instead of calling .stream(), you simply call parallelStream(). Here, we'll take our familiar list of names:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> List<span style="color:#ff79c6">&amp;</span>lt;String<span style="color:#ff79c6">&amp;</span>gt; getListOfNames() {
</span></span><span style="display:flex;"><span>    List<span style="color:#ff79c6">&amp;</span>lt;String<span style="color:#ff79c6">&amp;</span>gt; names <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> ArrayList<span style="color:#ff79c6">&amp;</span>lt;<span style="color:#ff79c6">&amp;</span>gt;();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    names.<span style="color:#50fa7b">add</span>(<span style="color:#ff79c6">&amp;</span>#34;John<span style="color:#ff79c6">&amp;</span>#34;);
</span></span><span style="display:flex;"><span>    names.<span style="color:#50fa7b">add</span>(<span style="color:#ff79c6">&amp;</span>#34;Jacob<span style="color:#ff79c6">&amp;</span>#34;);
</span></span><span style="display:flex;"><span>    names.<span style="color:#50fa7b">add</span>(<span style="color:#ff79c6">&amp;</span>#34;Jerry<span style="color:#ff79c6">&amp;</span>#34;);
</span></span><span style="display:flex;"><span>    names.<span style="color:#50fa7b">add</span>(<span style="color:#ff79c6">&amp;</span>#34;Josephine<span style="color:#ff79c6">&amp;</span>#34;);
</span></span><span style="display:flex;"><span>    names.<span style="color:#50fa7b">add</span>(<span style="color:#ff79c6">&amp;</span>#34;Janine<span style="color:#ff79c6">&amp;</span>#34;);
</span></span><span style="display:flex;"><span>    names.<span style="color:#50fa7b">add</span>(<span style="color:#ff79c6">&amp;</span>#34;Alan<span style="color:#ff79c6">&amp;</span>#34;);
</span></span><span style="display:flex;"><span>    names.<span style="color:#50fa7b">add</span>(<span style="color:#ff79c6">&amp;</span>#34;Beverly<span style="color:#ff79c6">&amp;</span>#34;);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> names;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>And count them in parallel:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Test
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">countingInParallel</span>() {
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd">long</span> parallelCount <span style="color:#ff79c6">=</span> names.<span style="color:#50fa7b">parallelStream</span>().<span style="color:#50fa7b">filter</span>(name <span style="color:#ff79c6">-&amp;</span>gt; name.<span style="color:#50fa7b">startsWith</span>(<span style="color:#ff79c6">&amp;</span>#34;J<span style="color:#ff79c6">&amp;</span>#34;)).<span style="color:#50fa7b">count</span>();
</span></span><span style="display:flex;"><span>    assertEquals(5, parallelCount);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Parallel Streams are best used for lots of data, but the same gotchas that exist in all concurrent programming still apply. For example,
using our <a href="https://nickolasfisher.com/blog/The-Java-Stream-API-Generating-Fibonacci-Numbers">Fibonacci Stream generator</a>, if we find the first
Fibonacci number over 5000 in a synchronous manner, we can always find the same number later:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Test
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">fibonacci_predictableWhenSynchronous</span>() {
</span></span><span style="display:flex;"><span>    Stream<span style="color:#ff79c6">&amp;</span>lt;Integer<span style="color:#ff79c6">&amp;</span>gt; fibonaccis_1 <span style="color:#ff79c6">=</span> Stream.<span style="color:#50fa7b">generate</span>(<span style="color:#ff79c6">new</span> SupplyFibonacci());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Integer firstFibOver5K <span style="color:#ff79c6">=</span> fibonaccis_1.<span style="color:#50fa7b">peek</span>(System.<span style="color:#50fa7b">out</span>::println)
</span></span><span style="display:flex;"><span>            .<span style="color:#50fa7b">filter</span>(num <span style="color:#ff79c6">-&amp;</span>gt; num <span style="color:#ff79c6">&amp;</span>gt;<span style="color:#ff79c6">=</span> 500000).<span style="color:#50fa7b">findFirst</span>().<span style="color:#50fa7b">orElseThrow</span>(RuntimeException::<span style="color:#ff79c6">new</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Stream<span style="color:#ff79c6">&amp;</span>lt;Integer<span style="color:#ff79c6">&amp;</span>gt; fibonaccis_2 <span style="color:#ff79c6">=</span> Stream.<span style="color:#50fa7b">generate</span>(<span style="color:#ff79c6">new</span> SupplyFibonacci());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Integer stillFirstFibOver5K <span style="color:#ff79c6">=</span> fibonaccis_2
</span></span><span style="display:flex;"><span>            .<span style="color:#50fa7b">filter</span>(num <span style="color:#ff79c6">-&amp;</span>gt; num.<span style="color:#50fa7b">intValue</span>() <span style="color:#ff79c6">==</span> firstFibOver5K)
</span></span><span style="display:flex;"><span>            .<span style="color:#50fa7b">findFirst</span>().<span style="color:#50fa7b">orElseThrow</span>(RuntimeException::<span style="color:#ff79c6">new</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    assertEquals(firstFibOver5K, stillFirstFibOver5K);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>However, if we try to do the same thing in parallel, since the Fibonacci Supplier shares state, the chance of getting something deterministic isn't possible. This test passes and fails unpredictably because it manipulates the shared state (in this case of parallel, we likely wouldn't be computing Fibonacci numbers at all):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Test
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">badUseOfParallel_thisIsUnpredictable</span>() {
</span></span><span style="display:flex;"><span>    Stream<span style="color:#ff79c6">&amp;</span>lt;Integer<span style="color:#ff79c6">&amp;</span>gt; fibonaccis_1 <span style="color:#ff79c6">=</span> Stream.<span style="color:#50fa7b">generate</span>(<span style="color:#ff79c6">new</span> SupplyFibonacci());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Integer firstFibOver5K <span style="color:#ff79c6">=</span> fibonaccis_1
</span></span><span style="display:flex;"><span>            .<span style="color:#50fa7b">parallel</span>()
</span></span><span style="display:flex;"><span>            .<span style="color:#50fa7b">peek</span>(System.<span style="color:#50fa7b">out</span>::println)
</span></span><span style="display:flex;"><span>            .<span style="color:#50fa7b">filter</span>(num <span style="color:#ff79c6">-&amp;</span>gt; num <span style="color:#ff79c6">&amp;</span>gt;<span style="color:#ff79c6">=</span> 500000)
</span></span><span style="display:flex;"><span>            .<span style="color:#50fa7b">findAny</span>()
</span></span><span style="display:flex;"><span>            .<span style="color:#50fa7b">orElseThrow</span>(RuntimeException::<span style="color:#ff79c6">new</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Stream<span style="color:#ff79c6">&amp;</span>lt;Integer<span style="color:#ff79c6">&amp;</span>gt; fibonaccis_2 <span style="color:#ff79c6">=</span> Stream.<span style="color:#50fa7b">generate</span>(<span style="color:#ff79c6">new</span> SupplyFibonacci());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Integer stillFirstFibOver5K <span style="color:#ff79c6">=</span> fibonaccis_2
</span></span><span style="display:flex;"><span>            .<span style="color:#50fa7b">parallel</span>()
</span></span><span style="display:flex;"><span>            .<span style="color:#50fa7b">peek</span>(System.<span style="color:#50fa7b">out</span>::println)
</span></span><span style="display:flex;"><span>            .<span style="color:#50fa7b">filter</span>(num <span style="color:#ff79c6">-&amp;</span>gt; num <span style="color:#ff79c6">&amp;</span>gt;<span style="color:#ff79c6">=</span> 500000)
</span></span><span style="display:flex;"><span>            .<span style="color:#50fa7b">findAny</span>()
</span></span><span style="display:flex;"><span>            .<span style="color:#50fa7b">orElseThrow</span>(RuntimeException::<span style="color:#ff79c6">new</span>);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    assertEquals(firstFibOver5K, stillFirstFibOver5K);
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>However, one *cheap* lunch is that large collections will be auto-magically broken down into smaller collections and operated on in parallel. If we have, for example,
a list of numbers from 0 to (whatever):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> List<span style="color:#ff79c6">&amp;</span>lt;Integer<span style="color:#ff79c6">&amp;</span>gt; generateLargeList(<span style="color:#8be9fd">int</span> max) {
</span></span><span style="display:flex;"><span>    List<span style="color:#ff79c6">&amp;</span>lt;Integer<span style="color:#ff79c6">&amp;</span>gt; ints <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> ArrayList<span style="color:#ff79c6">&amp;</span>lt;<span style="color:#ff79c6">&amp;</span>gt;();
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">for</span> (<span style="color:#8be9fd">int</span> i <span style="color:#ff79c6">=</span> 0; i <span style="color:#ff79c6">&amp;</span>lt; max; i<span style="color:#ff79c6">&amp;</span>#43;<span style="color:#ff79c6">&amp;</span>#43;) {
</span></span><span style="display:flex;"><span>        ints.<span style="color:#50fa7b">add</span>(i);
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">return</span> ints;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>We could then filter them in parallel, and the parallel streams will retain the ordering after we are done:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Test
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">parallelStreams_orderedCollectionsRemainOrdered</span>() {
</span></span><span style="display:flex;"><span>    List<span style="color:#ff79c6">&amp;</span>lt;Integer<span style="color:#ff79c6">&amp;</span>gt; largeSequentialList <span style="color:#ff79c6">=</span> generateLargeList(100000);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    List<span style="color:#ff79c6">&amp;</span>lt;Integer<span style="color:#ff79c6">&amp;</span>gt; collectedInOrder <span style="color:#ff79c6">=</span> largeSequentialList.<span style="color:#50fa7b">parallelStream</span>()
</span></span><span style="display:flex;"><span>            .<span style="color:#50fa7b">filter</span>(num <span style="color:#ff79c6">-&amp;</span>gt; num <span style="color:#ff79c6">&amp;</span>gt;<span style="color:#ff79c6">=</span> 1000)
</span></span><span style="display:flex;"><span>            .<span style="color:#50fa7b">peek</span>(System.<span style="color:#50fa7b">out</span>::println)
</span></span><span style="display:flex;"><span>            .<span style="color:#50fa7b">collect</span>(Collectors.<span style="color:#50fa7b">toList</span>());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6272a4">// verify order</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ff79c6">for</span> (<span style="color:#8be9fd">int</span> i <span style="color:#ff79c6">=</span> 1; i <span style="color:#ff79c6">&amp;</span>lt; collectedInOrder.<span style="color:#50fa7b">size</span>(); i<span style="color:#ff79c6">&amp;</span>#43;<span style="color:#ff79c6">&amp;</span>#43;) {
</span></span><span style="display:flex;"><span>        assertTrue(collectedInOrder.<span style="color:#50fa7b">get</span>(i) <span style="color:#ff79c6">&amp;</span>gt; collectedInOrder.<span style="color:#50fa7b">get</span>(i <span style="color:#ff79c6">-</span> 1));
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Finally, there are a number of collectors that work concurrently. If you want to collect into a map concurrently, you do so with
.groupingByConcurrent(..):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Test
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">parallelStreams_concurrentMaps</span>() {
</span></span><span style="display:flex;"><span>    ConcurrentMap<span style="color:#ff79c6">&amp;</span>lt;Integer, List<span style="color:#ff79c6">&amp;</span>lt;String<span style="color:#ff79c6">&amp;</span>gt;<span style="color:#ff79c6">&amp;</span>gt; mapToNamesInParallel <span style="color:#ff79c6">=</span>
</span></span><span style="display:flex;"><span>            names.<span style="color:#50fa7b">parallelStream</span>()
</span></span><span style="display:flex;"><span>                    .<span style="color:#50fa7b">collect</span>(Collectors.<span style="color:#50fa7b">groupingByConcurrent</span>(String::length));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    assertTrue(mapToNamesInParallel.<span style="color:#50fa7b">get</span>(4).<span style="color:#50fa7b">contains</span>(<span style="color:#ff79c6">&amp;</span>#34;Alan<span style="color:#ff79c6">&amp;</span>#34;));
</span></span><span style="display:flex;"><span>    assertTrue(mapToNamesInParallel.<span style="color:#50fa7b">get</span>(4).<span style="color:#50fa7b">contains</span>(<span style="color:#ff79c6">&amp;</span>#34;John<span style="color:#ff79c6">&amp;</span>#34;));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    ConcurrentMap<span style="color:#ff79c6">&amp;</span>lt;Integer, Long<span style="color:#ff79c6">&amp;</span>gt; mapOfCountsInParallel <span style="color:#ff79c6">=</span> names.<span style="color:#50fa7b">parallelStream</span>()
</span></span><span style="display:flex;"><span>            .<span style="color:#50fa7b">collect</span>(Collectors.<span style="color:#50fa7b">groupingByConcurrent</span>(String::length, Collectors.<span style="color:#50fa7b">counting</span>()));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    assertEquals(2, mapOfCountsInParallel.<span style="color:#50fa7b">get</span>(4).<span style="color:#50fa7b">intValue</span>());
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></section>

  
    
  

    
  


  <footer>
    
      <div class="pb-14 taxonomy-list tags-list">
      
        <a href="/tags/java/" alt="Java">
          Java
        </a>
      
        <a href="/tags/java-stream-api/" alt="Java Stream Api">
          Java Stream Api
        </a>
      
      </div>
    
  </footer>
</article>


    </main><footer class="pt-5 pb-10 grid gap-3 sm:grid-cols-2">
    <div class="text-xs font-semibold text-gray-500 order-2 sm:order-1">
  © 2018-2025 —
  <a href="http://localhost:1313/">Nick Fisher&#39;s tech blog</a> 
</div>

    <div class="order-1 sm:order-2">
  <ul class="flex sm:justify-end gap-5">
    
    
    <li>    
      <a href="https://www.linkedin.com/in/nick-fisher-software/" target="_blank" rel="noopener noreferrer">LinkedIn</a>
    </li>
    
    <li>    
      <a href="https://github.com/nfisher23" target="_blank" rel="noopener noreferrer">GitHub</a>
    </li>
    
    
  </ul>
</div>

</footer></body>
</html>
