<!DOCTYPE html>
<html lang="en-US" class="scroll-smooth dark">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>

<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Working with Lists in Redis using Lettuce and Webflux</title>
<meta
  name="description"
  content="As of this writing, there are a solid twenty or so commands you can execute against redis for the list data type. This article will be walking through some of the more common operations you are likely to need when interacting with redis and lists using lettuce, and the source code can be found on Github."
/>
<link rel="canonical" href="http://localhost:1313/blog/working-with-lists-in-redis-using-lettuce-and-webflux/" />
<link rel="robots" href="/robots.txt" />

<link rel="icon" type="image/x-icon" href="/img/nficon.png" />



<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });</script>

<link rel="stylesheet" href="http://localhost:1313/css/app.css" /></head>

  <body class="max-w-screen-md mx-auto px-2.5">
    <div class="header">
      <header class="flex flex-col sm:flex-row items-center gap-5 sm:gap-10 pt-16 py-12">
   


<div class="flex-none w-20 h-20 rounded-full overflow-hidden">
  <a href="http://localhost:1313/">
    <img
      srcset="/img/profile-picture_hu4241499301404582006.jpg 80w"
      src="/img/profile-picture.jpg"
      width="386"
      height="345"
      alt="Nick Fisher&#39;s tech blog"
    />
  </a>
</div>

  
  <div class="flex flex-col gap-5">
    <a href="http://localhost:1313/">
  <h1 id="site-title">Nick Fisher&#39;s tech blog</h1>
</a>
 
    <nav>
  <ul>
     
    
    <li>
      <a href="/" class="">
        home
      </a>
    </li>
    
    <li>
      <a href="/blog" class="">
        blog
      </a>
    </li>
    
    <li>
      <a href="/about" class="">
        about
      </a>
    </li>
    
    <li>
      <a href="/tags" class="">
        Tags
      </a>
    </li>
    
  </ul>
</nav>

  </div>
</header>

      <button class="toggle-theme" aria-label="Toggle Theme" title="Toggle Theme" onclick="toggleTheme()">
  <span class="theme-icon light"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
</svg> </span>
  <span class="theme-icon dark"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
</svg> </span>
</button>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const theme = localStorage.getItem('theme');

    if (!theme || theme === 'light') {
      setTheme('light');
    } else {
      setTheme(theme);
    }
  });

  function setTheme(theme) {
    const html = document.querySelector('html');
    localStorage.setItem('theme', theme);

    if (theme === 'light') {
      if (html.classList.contains('dark')) {
        document.querySelector('html').classList.remove('dark');
      }

      document.querySelector('.theme-icon.light').style.display = 'none';
      document.querySelector('.theme-icon.dark').style.display = 'block';
    } else {
      if (!html.classList.contains('dark')) {
        document.querySelector('html').classList.add('dark');
      }

      document.querySelector('.theme-icon.dark').style.display = 'none';
      document.querySelector('.theme-icon.light').style.display = 'block';
    }
  }

  function toggleTheme() {
    const theme = localStorage.getItem('theme');

    if (theme === 'light') {
      setTheme('dark');
    } else {
      setTheme('light');
    }
  }
</script>
    </div>
  
    <main id="content">

<article class="flex flex-col gap-10">
  <header class="flex flex-col gap-2">
    <h2 class="title-large">Working with Lists in Redis using Lettuce and Webflux</h2>

    <div class="meta">
      
      <time datetime="2021-04-11 21:14:08 &#43;0000 UTC" title='Sun, Apr 11, 2021, 9:14 PM UTC'>
        11/04/2021 - Estimated reading time: 3 minutes
      </time>

       
      
    </div>
  </header>

  

  <section><p>As of this writing, there are a solid <a href="https://redis.io/commands/#list">twenty or so commands you can execute against redis for the list data type</a>. This article will be walking through some of the more common operations you are likely to need when interacting with redis and lists using lettuce, and <a href="https://github.com/nfisher23/reactive-programming-webflux">the source code can be found on Github</a>.</p>
<p>Building off of a previous post where we <a href="https://nickolasfisher.com/blog/How-to-use-a-Redis-Test-Container-with-LettuceSpring-Boot-Webflux">set up a redis test container for testing lettuce</a>, we can take that setup and teardown code and make it a base abstract class for reuse:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Testcontainers
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">abstract</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">BaseSetupAndTeardownRedis</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Container
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> GenericContainer genericContainer <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> GenericContainer(
</span></span><span style="display:flex;"><span>            DockerImageName.<span style="color:#50fa7b">parse</span>(<span style="color:#ff79c6">&amp;</span>#34;redis:5.<span style="color:#50fa7b">0</span>.<span style="color:#50fa7b">3</span><span style="color:#ff79c6">-</span>alpine<span style="color:#ff79c6">&amp;</span>#34;)
</span></span><span style="display:flex;"><span>    ).<span style="color:#50fa7b">withExposedPorts</span>(6379);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">protected</span> RedisClient redisClient;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @BeforeEach
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">setupRedisClient</span>() {
</span></span><span style="display:flex;"><span>        redisClient <span style="color:#ff79c6">=</span> RedisClient.<span style="color:#50fa7b">create</span>(<span style="color:#ff79c6">&amp;</span>#34;redis:<span style="color:#6272a4">//&amp;#34; &amp;#43; genericContainer.getHost() &amp;#43; &amp;#34;:&amp;#34; &amp;#43; genericContainer.getMappedPort(6379));</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @AfterEach
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">removeAllDataFromRedis</span>() {
</span></span><span style="display:flex;"><span>        redisClient.<span style="color:#50fa7b">connect</span>().<span style="color:#50fa7b">reactive</span>().<span style="color:#50fa7b">flushall</span>().<span style="color:#50fa7b">block</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This just starts our redis container, configures our redis client to communicate with it by default, then deletes all the data out of redis after each test case has run. With this in place, we can start writing some test cases demonstrating how we can interact with lists in redis.</p>
<h3 id="push-and-pop">Push and Pop</h3>
<p>One of the more common things you're likely to do against redis lists is just adding and removing elements from the &quot;left&quot; or &quot;right&quot;. We'll demonstrate how to remove from the left here:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    @Test
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">addAndRemoveFromTheLeft</span>() {
</span></span><span style="display:flex;"><span>        RedisReactiveCommands<span style="color:#ff79c6">&amp;</span>lt;String, String<span style="color:#ff79c6">&amp;</span>gt; redisReactiveCommands <span style="color:#ff79c6">=</span> redisClient.<span style="color:#50fa7b">connect</span>().<span style="color:#50fa7b">reactive</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        StepVerifier.<span style="color:#50fa7b">create</span>(redisReactiveCommands.<span style="color:#50fa7b">lpush</span>(<span style="color:#ff79c6">&amp;</span>#34;list<span style="color:#ff79c6">-</span>key<span style="color:#ff79c6">&amp;</span>#34;, <span style="color:#ff79c6">&amp;</span>#34;fourth<span style="color:#ff79c6">-</span>element<span style="color:#ff79c6">&amp;</span>#34;, <span style="color:#ff79c6">&amp;</span>#34;third<span style="color:#ff79c6">-</span>element<span style="color:#ff79c6">&amp;</span>#34;))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">expectNextMatches</span>(sizeOfList <span style="color:#ff79c6">-&amp;</span>gt; 2L <span style="color:#ff79c6">==</span> sizeOfList)
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">verifyComplete</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        StepVerifier.<span style="color:#50fa7b">create</span>(redisReactiveCommands.<span style="color:#50fa7b">lpush</span>(<span style="color:#ff79c6">&amp;</span>#34;list<span style="color:#ff79c6">-</span>key<span style="color:#ff79c6">&amp;</span>#34;,<span style="color:#ff79c6">&amp;</span>#34;second<span style="color:#ff79c6">-</span>element<span style="color:#ff79c6">&amp;</span>#34;, <span style="color:#ff79c6">&amp;</span>#34;first<span style="color:#ff79c6">-</span>element<span style="color:#ff79c6">&amp;</span>#34;))
</span></span><span style="display:flex;"><span>                <span style="color:#6272a4">// pushes to the left of the same list</span>
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">expectNextMatches</span>(sizeOfList <span style="color:#ff79c6">-&amp;</span>gt; 4L <span style="color:#ff79c6">==</span> sizeOfList)
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">verifyComplete</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        StepVerifier.<span style="color:#50fa7b">create</span>(redisReactiveCommands.<span style="color:#50fa7b">lpop</span>(<span style="color:#ff79c6">&amp;</span>#34;list<span style="color:#ff79c6">-</span>key<span style="color:#ff79c6">&amp;</span>#34;))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">expectNextMatches</span>(poppedElement <span style="color:#ff79c6">-&amp;</span>gt; <span style="color:#ff79c6">&amp;</span>#34;first<span style="color:#ff79c6">-</span>element<span style="color:#ff79c6">&amp;</span>#34;.<span style="color:#50fa7b">equals</span>(poppedElement))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">verifyComplete</span>();
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>We insert elements four, three, two, then one from left to right. This leads to a list that looks like <strong>first-element -&gt; second-element -&gt; third-element -&gt; fourth-element</strong>. we then pop an element off the &quot;left&quot; of the list to grab the first element, then verify that is indeed what we're getting.</p>
<h3 id="blocking-get">Blocking Get</h3>
<p>This one is more interesting. The <strong>blpop</strong> operation will block until an element becomes available [for a specified number of seconds]. If one doesn't become available in time, it will release itself. Here's an example where we execute a <strong>blpop</strong> and we then push an element into the list about half a second later, asserting that the amount of time that took was at least half a second [ <em>ish</em>. I made it 400 ms mostly out of paranoia]:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    @Test
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">blockingGet</span>() {
</span></span><span style="display:flex;"><span>        RedisReactiveCommands<span style="color:#ff79c6">&amp;</span>lt;String, String<span style="color:#ff79c6">&amp;</span>gt; redisReactiveCommands1 <span style="color:#ff79c6">=</span> redisClient.<span style="color:#50fa7b">connect</span>().<span style="color:#50fa7b">reactive</span>();
</span></span><span style="display:flex;"><span>        RedisReactiveCommands<span style="color:#ff79c6">&amp;</span>lt;String, String<span style="color:#ff79c6">&amp;</span>gt; redisReactiveCommands2 <span style="color:#ff79c6">=</span> redisClient.<span style="color:#50fa7b">connect</span>().<span style="color:#50fa7b">reactive</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd">long</span> startingTime <span style="color:#ff79c6">=</span> Instant.<span style="color:#50fa7b">now</span>().<span style="color:#50fa7b">toEpochMilli</span>();
</span></span><span style="display:flex;"><span>        StepVerifier.<span style="color:#50fa7b">create</span>(Mono.<span style="color:#50fa7b">zip</span>(
</span></span><span style="display:flex;"><span>                    redisReactiveCommands1.<span style="color:#50fa7b">blpop</span>(1, <span style="color:#ff79c6">&amp;</span>#34;list<span style="color:#ff79c6">-</span>key<span style="color:#ff79c6">&amp;</span>#34;).<span style="color:#50fa7b">switchIfEmpty</span>(Mono.<span style="color:#50fa7b">just</span>(KeyValue.<span style="color:#50fa7b">empty</span>(<span style="color:#ff79c6">&amp;</span>#34;list<span style="color:#ff79c6">-</span>key<span style="color:#ff79c6">&amp;</span>#34;))),
</span></span><span style="display:flex;"><span>                    Mono.<span style="color:#50fa7b">delay</span>(Duration.<span style="color:#50fa7b">ofMillis</span>(500)).<span style="color:#50fa7b">then</span>(redisReactiveCommands2.<span style="color:#50fa7b">lpush</span>(<span style="color:#ff79c6">&amp;</span>#34;list<span style="color:#ff79c6">-</span>key<span style="color:#ff79c6">&amp;</span>#34;, <span style="color:#ff79c6">&amp;</span>#34;an<span style="color:#ff79c6">-</span>element<span style="color:#ff79c6">&amp;</span>#34;))
</span></span><span style="display:flex;"><span>                ).<span style="color:#50fa7b">map</span>(tuple <span style="color:#ff79c6">-&amp;</span>gt; tuple.<span style="color:#50fa7b">getT1</span>().<span style="color:#50fa7b">getValue</span>())
</span></span><span style="display:flex;"><span>            )
</span></span><span style="display:flex;"><span>            .<span style="color:#50fa7b">expectNextMatches</span>(value <span style="color:#ff79c6">-&amp;</span>gt; <span style="color:#ff79c6">&amp;</span>#34;an<span style="color:#ff79c6">-</span>element<span style="color:#ff79c6">&amp;</span>#34;.<span style="color:#50fa7b">equals</span>(value))
</span></span><span style="display:flex;"><span>            .<span style="color:#50fa7b">verifyComplete</span>();
</span></span><span style="display:flex;"><span>        <span style="color:#8be9fd">long</span> endingTime <span style="color:#ff79c6">=</span> Instant.<span style="color:#50fa7b">now</span>().<span style="color:#50fa7b">toEpochMilli</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        assertTrue(endingTime <span style="color:#ff79c6">-</span> startingTime <span style="color:#ff79c6">&amp;</span>gt; 400);
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><h3 id="range-of-elements">Range of Elements</h3>
<p>If you want to just look at any given range of elements, you can do that with <strong>lrange</strong>. This command will iterate from left to right and pull out elements as it finds them between the indices that you specify:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    @Test
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">getRange</span>() {
</span></span><span style="display:flex;"><span>        RedisReactiveCommands<span style="color:#ff79c6">&amp;</span>lt;String, String<span style="color:#ff79c6">&amp;</span>gt; redisReactiveCommands <span style="color:#ff79c6">=</span> redisClient.<span style="color:#50fa7b">connect</span>().<span style="color:#50fa7b">reactive</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        StepVerifier.<span style="color:#50fa7b">create</span>(redisReactiveCommands.<span style="color:#50fa7b">lpush</span>(<span style="color:#ff79c6">&amp;</span>#34;list<span style="color:#ff79c6">-</span>key<span style="color:#ff79c6">&amp;</span>#34;, <span style="color:#ff79c6">&amp;</span>#34;third<span style="color:#ff79c6">-</span>element<span style="color:#ff79c6">&amp;</span>#34;, <span style="color:#ff79c6">&amp;</span>#34;second<span style="color:#ff79c6">-</span>element<span style="color:#ff79c6">&amp;</span>#34;, <span style="color:#ff79c6">&amp;</span>#34;first<span style="color:#ff79c6">-</span>element<span style="color:#ff79c6">&amp;</span>#34;))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">expectNextMatches</span>(sizeOfList <span style="color:#ff79c6">-&amp;</span>gt; 3L <span style="color:#ff79c6">==</span> sizeOfList)
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">verifyComplete</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        StepVerifier.<span style="color:#50fa7b">create</span>(redisReactiveCommands.<span style="color:#50fa7b">lrange</span>(<span style="color:#ff79c6">&amp;</span>#34;list<span style="color:#ff79c6">-</span>key<span style="color:#ff79c6">&amp;</span>#34;, 0, 1))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">expectNextMatches</span>(first <span style="color:#ff79c6">-&amp;</span>gt; <span style="color:#ff79c6">&amp;</span>#34;first<span style="color:#ff79c6">-</span>element<span style="color:#ff79c6">&amp;</span>#34;.<span style="color:#50fa7b">equals</span>(first))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">expectNextMatches</span>(second <span style="color:#ff79c6">-&amp;</span>gt; <span style="color:#ff79c6">&amp;</span>#34;second<span style="color:#ff79c6">-</span>element<span style="color:#ff79c6">&amp;</span>#34;.<span style="color:#50fa7b">equals</span>(second))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">verifyComplete</span>();
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>It's important to note that for very large lists, this operation could take more time than you would like, because redis lists are implemented as linked lists. Therefore getting elements towards the middle of the list will be a <code>O(N)</code> operation.</p>
</section>

  
    
  

    
  


  <footer>
    
      <div class="pb-14 taxonomy-list tags-list">
      
        <a href="/tags/distributed-systems/" alt="Distributed Systems">
          Distributed Systems
        </a>
      
        <a href="/tags/spring/" alt="Spring">
          Spring
        </a>
      
        <a href="/tags/reactive/" alt="Reactive">
          Reactive
        </a>
      
        <a href="/tags/webflux/" alt="Webflux">
          Webflux
        </a>
      
        <a href="/tags/lettuce/" alt="Lettuce">
          Lettuce
        </a>
      
        <a href="/tags/redis/" alt="Redis">
          Redis
        </a>
      
      </div>
    
  </footer>
</article>


    </main><footer class="pt-5 pb-10 grid gap-3 sm:grid-cols-2">
    <div class="text-xs font-semibold text-gray-500 order-2 sm:order-1">
  © 2018-2025 —
  <a href="http://localhost:1313/">Nick Fisher&#39;s tech blog</a> 
</div>

    <div class="order-1 sm:order-2">
  <ul class="flex sm:justify-end gap-5">
    
    
    <li>    
      <a href="https://www.linkedin.com/in/nick-fisher-software/" target="_blank" rel="noopener noreferrer">LinkedIn</a>
    </li>
    
    <li>    
      <a href="https://github.com/nfisher23" target="_blank" rel="noopener noreferrer">GitHub</a>
    </li>
    
    
  </ul>
</div>

</footer></body>
</html>
