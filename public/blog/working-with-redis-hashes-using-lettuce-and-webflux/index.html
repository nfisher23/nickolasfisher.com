<!DOCTYPE html>
<html lang="en-US" class="scroll-smooth dark">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>

<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Working with Redis Hashes using Lettuce And Webflux</title>
<meta
  name="description"
  content="There are about 15 or so commands you can execute against redis for hash types as of this writing. This article will demonstrate some of the more common operations you&#39;re likely to need when using lettuce as your client."
/>
<link rel="canonical" href="http://localhost:1313/blog/working-with-redis-hashes-using-lettuce-and-webflux/" />
<link rel="robots" href="/robots.txt" />

<link rel="icon" type="image/x-icon" href="/icons/favicon.ico" />



<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });</script>

<link rel="stylesheet" href="http://localhost:1313/css/app.css" /></head>

  <body class="max-w-screen-md mx-auto px-2.5">
    <div class="header">
      <header class="flex flex-col sm:flex-row items-center gap-5 sm:gap-10 pt-16 py-12">
   


<div class="flex-none w-20 h-20 rounded-full overflow-hidden">
  <a href="http://localhost:1313/">
    <img
      srcset="/img/profile-picture_hu4241499301404582006.jpg 80w"
      src="/img/profile-picture.jpg"
      width="386"
      height="345"
      alt="Nick Fisher&#39;s tech blog"
    />
  </a>
</div>

  
  <div class="flex flex-col gap-5">
    <a href="http://localhost:1313/">
  <h1 id="site-title">Nick Fisher&#39;s tech blog</h1>
</a>
 
    <nav>
  <ul>
     
    
    <li>
      <a href="/" class="">
        Home
      </a>
    </li>
    
    <li>
      <a href="/blog" class="">
        Blog
      </a>
    </li>
    
    <li>
      <a href="/about" class="">
        About me
      </a>
    </li>
    
    <li>
      <a href="/categories" class="">
        Categories
      </a>
    </li>
    
    <li>
      <a href="/tags" class="">
        Tags
      </a>
    </li>
    
  </ul>
</nav>

  </div>
</header>

      <button class="toggle-theme" aria-label="Toggle Theme" title="Toggle Theme" onclick="toggleTheme()">
  <span class="theme-icon light"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
</svg> </span>
  <span class="theme-icon dark"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
</svg> </span>
</button>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const theme = localStorage.getItem('theme');

    if (!theme || theme === 'light') {
      setTheme('light');
    } else {
      setTheme(theme);
    }
  });

  function setTheme(theme) {
    const html = document.querySelector('html');
    localStorage.setItem('theme', theme);

    if (theme === 'light') {
      if (html.classList.contains('dark')) {
        document.querySelector('html').classList.remove('dark');
      }

      document.querySelector('.theme-icon.light').style.display = 'none';
      document.querySelector('.theme-icon.dark').style.display = 'block';
    } else {
      if (!html.classList.contains('dark')) {
        document.querySelector('html').classList.add('dark');
      }

      document.querySelector('.theme-icon.dark').style.display = 'none';
      document.querySelector('.theme-icon.light').style.display = 'block';
    }
  }

  function toggleTheme() {
    const theme = localStorage.getItem('theme');

    if (theme === 'light') {
      setTheme('dark');
    } else {
      setTheme('light');
    }
  }
</script>
    </div>
  
    <main id="content">

<article class="flex flex-col gap-10">
  <header class="flex flex-col gap-2">
    <h2 class="title-large">Working with Redis Hashes using Lettuce And Webflux</h2>

    <div class="meta">
      
      <time datetime="2021-04-11 22:26:29 &#43;0000 UTC" title='Sun, Apr 11, 2021, 10:26 PM UTC'>
        11/04/2021 - Estimated reading time: 3 minutes
      </time>

       
      
    </div>
  </header>

  

  <section><p>There are about <a href="https://redis.io/commands/#hash">15 or so commands you can execute against redis for hash types</a> as of this writing. This article will demonstrate some of the more common operations you're likely to need when using lettuce as your client.</p>
<p>To start with, you're going to want to make sure you have either an <a href="https://nickolasfisher.com/blog/How-to-use-Embedded-Redis-to-Test-a-Lettuce-Client-in-Spring-Boot-Webflux">embedded redis instance configured with lettuce</a> or a <a href="https://nickolasfisher.com/blog/How-to-use-a-Redis-Test-Container-with-LettuceSpring-Boot-Webflux">redis test container configured for lettuce</a>, which will make what follows much more straightforward to grok. And the source code for what follows <a href="https://github.com/nfisher23/reactive-programming-webflux">can be found on Github</a>.</p>
<p>Hashes in redis are basically just objects. There's a key to get to the object, then buried within that initial key are a bunch of other keys that point to values. Another way to think of hashes are a key that points to a bunch of key/value pairs, all of which are string values.</p>
<h3 id="set-and-get-all">Set and Get All</h3>
<p>The easiest way to get started is to set a hash object and then get all of those key/value pairs:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">HashesTest</span> <span style="color:#8be9fd;font-style:italic">extends</span> BaseSetupAndTeardownRedis {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Test
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">setSingleHashAndGetWholeHash</span>() {
</span></span><span style="display:flex;"><span>        RedisReactiveCommands<span style="color:#ff79c6">&amp;</span>lt;String, String<span style="color:#ff79c6">&amp;</span>gt; redisReactiveCommands <span style="color:#ff79c6">=</span> redisClient.<span style="color:#50fa7b">connect</span>().<span style="color:#50fa7b">reactive</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Mono<span style="color:#ff79c6">&amp;</span>lt;String<span style="color:#ff79c6">&amp;</span>gt; multiSetMono <span style="color:#ff79c6">=</span> redisReactiveCommands.<span style="color:#50fa7b">hmset</span>(<span style="color:#ff79c6">&amp;</span>#34;hash<span style="color:#ff79c6">-</span>set<span style="color:#ff79c6">-</span>key<span style="color:#ff79c6">&amp;</span>#34;, Map.<span style="color:#50fa7b">of</span>(
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">&amp;</span>#34;key<span style="color:#ff79c6">-</span>1<span style="color:#ff79c6">&amp;</span>#34;, <span style="color:#ff79c6">&amp;</span>#34;value<span style="color:#ff79c6">-</span>1<span style="color:#ff79c6">&amp;</span>#34;,
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">&amp;</span>#34;key<span style="color:#ff79c6">-</span>2<span style="color:#ff79c6">&amp;</span>#34;, <span style="color:#ff79c6">&amp;</span>#34;value<span style="color:#ff79c6">-</span>2<span style="color:#ff79c6">&amp;</span>#34;,
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">&amp;</span>#34;key<span style="color:#ff79c6">-</span>3<span style="color:#ff79c6">&amp;</span>#34;, <span style="color:#ff79c6">&amp;</span>#34;value<span style="color:#ff79c6">-</span>3<span style="color:#ff79c6">&amp;</span>#34;
</span></span><span style="display:flex;"><span>        ));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        StepVerifier.<span style="color:#50fa7b">create</span>(multiSetMono)
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">expectNextMatches</span>(response <span style="color:#ff79c6">-&amp;</span>gt; <span style="color:#ff79c6">&amp;</span>#34;OK<span style="color:#ff79c6">&amp;</span>#34;.<span style="color:#50fa7b">equals</span>(response))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">verifyComplete</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Mono<span style="color:#ff79c6">&amp;</span>lt;List<span style="color:#ff79c6">&amp;</span>lt;KeyValue<span style="color:#ff79c6">&amp;</span>lt;String, String<span style="color:#ff79c6">&amp;</span>gt;<span style="color:#ff79c6">&amp;</span>gt;<span style="color:#ff79c6">&amp;</span>gt; allKeyValuesMono <span style="color:#ff79c6">=</span> redisReactiveCommands.<span style="color:#50fa7b">hgetall</span>(<span style="color:#ff79c6">&amp;</span>#34;hash<span style="color:#ff79c6">-</span>set<span style="color:#ff79c6">-</span>key<span style="color:#ff79c6">&amp;</span>#34;).<span style="color:#50fa7b">collectList</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        StepVerifier.<span style="color:#50fa7b">create</span>(allKeyValuesMono)
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">expectNextMatches</span>(keyValues <span style="color:#ff79c6">-&amp;</span>gt; keyValues.<span style="color:#50fa7b">size</span>() <span style="color:#ff79c6">==</span> 3
</span></span><span style="display:flex;"><span>                    <span style="color:#ff79c6">&amp;</span>amp;<span style="color:#ff79c6">&amp;</span>amp; keyValues.<span style="color:#50fa7b">stream</span>()
</span></span><span style="display:flex;"><span>                        .<span style="color:#50fa7b">anyMatch</span>(keyValue <span style="color:#ff79c6">-&amp;</span>gt; keyValue.<span style="color:#50fa7b">getValue</span>().<span style="color:#50fa7b">equals</span>(<span style="color:#ff79c6">&amp;</span>#34;value<span style="color:#ff79c6">-</span>2<span style="color:#ff79c6">&amp;</span>#34;)
</span></span><span style="display:flex;"><span>                                <span style="color:#ff79c6">&amp;</span>amp;<span style="color:#ff79c6">&amp;</span>amp; keyValue.<span style="color:#50fa7b">getKey</span>().<span style="color:#50fa7b">equals</span>(<span style="color:#ff79c6">&amp;</span>#34;key<span style="color:#ff79c6">-</span>2<span style="color:#ff79c6">&amp;</span>#34;))
</span></span><span style="display:flex;"><span>                )
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">verifyComplete</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Note that the <strong>BaseSetupAndTeardownRedis</strong> abstract base class does what it says it does: sets up redis and tears it down when we're done. For details on how that works, you can refer to the related post about <a href="https://nickolasfisher.com/blog/Working-with-Lists-in-Redis-using-Lettuce-and-Webflux">working with list data types in redis using lettuce</a>.</p>
<p>The above example shows that we can set key/value pairs inside of our key. In this case we set three values, we then use a method that enumerates all the key/value pairs inside of our previously defined hash set and asserts that they were set up correctly.</p>
<h3 id="getting-and-setting-individual-fields">Getting and Setting Individual Fields</h3>
<p>The real value of hashes are going to come from manipulating individual fields inside of the hash. For example, let's start with the same set of data we did in the previous example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    @Test
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">getAndSetSingleValueInHash</span>() {
</span></span><span style="display:flex;"><span>        RedisReactiveCommands<span style="color:#ff79c6">&amp;</span>lt;String, String<span style="color:#ff79c6">&amp;</span>gt; redisReactiveCommands <span style="color:#ff79c6">=</span> redisClient.<span style="color:#50fa7b">connect</span>().<span style="color:#50fa7b">reactive</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Mono<span style="color:#ff79c6">&amp;</span>lt;String<span style="color:#ff79c6">&amp;</span>gt; multiSetMono <span style="color:#ff79c6">=</span> redisReactiveCommands.<span style="color:#50fa7b">hmset</span>(<span style="color:#ff79c6">&amp;</span>#34;hash<span style="color:#ff79c6">-</span>set<span style="color:#ff79c6">-</span>key<span style="color:#ff79c6">&amp;</span>#34;, Map.<span style="color:#50fa7b">of</span>(
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">&amp;</span>#34;key<span style="color:#ff79c6">-</span>1<span style="color:#ff79c6">&amp;</span>#34;, <span style="color:#ff79c6">&amp;</span>#34;value<span style="color:#ff79c6">-</span>1<span style="color:#ff79c6">&amp;</span>#34;,
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">&amp;</span>#34;key<span style="color:#ff79c6">-</span>2<span style="color:#ff79c6">&amp;</span>#34;, <span style="color:#ff79c6">&amp;</span>#34;value<span style="color:#ff79c6">-</span>2<span style="color:#ff79c6">&amp;</span>#34;,
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">&amp;</span>#34;key<span style="color:#ff79c6">-</span>3<span style="color:#ff79c6">&amp;</span>#34;, <span style="color:#ff79c6">&amp;</span>#34;value<span style="color:#ff79c6">-</span>3<span style="color:#ff79c6">&amp;</span>#34;
</span></span><span style="display:flex;"><span>        ));
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        StepVerifier.<span style="color:#50fa7b">create</span>(multiSetMono)
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">expectNextMatches</span>(response <span style="color:#ff79c6">-&amp;</span>gt; <span style="color:#ff79c6">&amp;</span>#34;OK<span style="color:#ff79c6">&amp;</span>#34;.<span style="color:#50fa7b">equals</span>(response))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">verifyComplete</span>();
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>We can then set and get individual fields inside of that hash set with something like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>        StepVerifier.<span style="color:#50fa7b">create</span>(redisReactiveCommands.<span style="color:#50fa7b">hget</span>(<span style="color:#ff79c6">&amp;</span>#34;hash<span style="color:#ff79c6">-</span>set<span style="color:#ff79c6">-</span>key<span style="color:#ff79c6">&amp;</span>#34;, <span style="color:#ff79c6">&amp;</span>#34;key<span style="color:#ff79c6">-</span>1<span style="color:#ff79c6">&amp;</span>#34;))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">expectNextMatches</span>(val <span style="color:#ff79c6">-&amp;</span>gt; val.<span style="color:#50fa7b">equals</span>(<span style="color:#ff79c6">&amp;</span>#34;value<span style="color:#ff79c6">-</span>1<span style="color:#ff79c6">&amp;</span>#34;))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">verifyComplete</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        StepVerifier.<span style="color:#50fa7b">create</span>(redisReactiveCommands.<span style="color:#50fa7b">hset</span>(<span style="color:#ff79c6">&amp;</span>#34;hash<span style="color:#ff79c6">-</span>set<span style="color:#ff79c6">-</span>key<span style="color:#ff79c6">&amp;</span>#34;, <span style="color:#ff79c6">&amp;</span>#34;key<span style="color:#ff79c6">-</span>2<span style="color:#ff79c6">&amp;</span>#34;, <span style="color:#ff79c6">&amp;</span>#34;<span style="color:#ff79c6">new</span><span style="color:#ff79c6">-</span>value<span style="color:#ff79c6">-</span>2<span style="color:#ff79c6">&amp;</span>#34;))
</span></span><span style="display:flex;"><span>                <span style="color:#6272a4">// returns false if no new fields were added--in this case we&amp;#39;re changing an existing field</span>
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">expectNextMatches</span>(response <span style="color:#ff79c6">-&amp;</span>gt; <span style="color:#ff79c6">!</span>response)
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">verifyComplete</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        StepVerifier.<span style="color:#50fa7b">create</span>(redisReactiveCommands.<span style="color:#50fa7b">hget</span>(<span style="color:#ff79c6">&amp;</span>#34;hash<span style="color:#ff79c6">-</span>set<span style="color:#ff79c6">-</span>key<span style="color:#ff79c6">&amp;</span>#34;, <span style="color:#ff79c6">&amp;</span>#34;key<span style="color:#ff79c6">-</span>2<span style="color:#ff79c6">&amp;</span>#34;))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">expectNextMatches</span>(val <span style="color:#ff79c6">-&amp;</span>gt; <span style="color:#ff79c6">&amp;</span>#34;<span style="color:#ff79c6">new</span><span style="color:#ff79c6">-</span>value<span style="color:#ff79c6">-</span>2<span style="color:#ff79c6">&amp;</span>#34;.<span style="color:#50fa7b">equals</span>(val))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">verifyComplete</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// different value in the same hash is unchanged</span>
</span></span><span style="display:flex;"><span>        StepVerifier.<span style="color:#50fa7b">create</span>(redisReactiveCommands.<span style="color:#50fa7b">hget</span>(<span style="color:#ff79c6">&amp;</span>#34;hash<span style="color:#ff79c6">-</span>set<span style="color:#ff79c6">-</span>key<span style="color:#ff79c6">&amp;</span>#34;, <span style="color:#ff79c6">&amp;</span>#34;key<span style="color:#ff79c6">-</span>1<span style="color:#ff79c6">&amp;</span>#34;))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">expectNextMatches</span>(val <span style="color:#ff79c6">-&amp;</span>gt; <span style="color:#ff79c6">&amp;</span>#34;value<span style="color:#ff79c6">-</span>1<span style="color:#ff79c6">&amp;</span>#34;.<span style="color:#50fa7b">equals</span>(val))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">verifyComplete</span>();
</span></span></code></pre></div><p>We get <strong>key-1</strong>, then change the value under <strong>key-2</strong>, then we verify that both the value under <strong>key-2</strong> was changed, but also that the value under our <strong>key-1</strong> was left unchanged.</p>
<p>While there are many more operations available to you [linked at the top of this article], you should be in pretty good shape after this introduction, and I'll leave you to it.</p>
</section>

  
    
  

    
  


  <footer>
    
  </footer>
</article>


    </main><footer class="pt-5 pb-10 grid gap-3 sm:grid-cols-2">
    <div class="text-xs font-semibold text-gray-500 order-2 sm:order-1">
  © 2018-2025 —
  <a href="http://localhost:1313/">Nick Fisher&#39;s tech blog</a> 
</div>

    <div class="order-1 sm:order-2">
  <ul class="flex sm:justify-end gap-5">
    
    
    <li>    
      <a href="https://www.linkedin.com/in/nick-fisher-software/" target="_blank" rel="noopener noreferrer">LinkedIn</a>
    </li>
    
    <li>    
      <a href="https://github.com/nfisher23" target="_blank" rel="noopener noreferrer">GitHub</a>
    </li>
    
    
  </ul>
</div>

</footer></body>
</html>
