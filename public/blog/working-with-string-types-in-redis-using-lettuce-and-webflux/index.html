<!DOCTYPE html>
<html lang="en-US" class="scroll-smooth dark">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>

<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Working with String Types in Redis using Lettuce and Webflux</title>
<meta
  name="description"
  content="The source code for what follows can be found on Github.
There are, as of this writing, 27 different string operations available in the redis API. Lettuce appears to have interfaces that directly support all of them."
/>
<link rel="canonical" href="http://localhost:1313/blog/working-with-string-types-in-redis-using-lettuce-and-webflux/" />
<link rel="robots" href="/robots.txt" />

<link rel="icon" type="image/x-icon" href="/icons/favicon.ico" />



<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">MathJax.Hub.Config({ tex2jax: { inlineMath: [['$','$'], ['\\(','\\)']] } });</script>

<link rel="stylesheet" href="http://localhost:1313/css/app.css" /></head>

  <body class="max-w-screen-md mx-auto px-2.5">
    <div class="header">
      <header class="flex flex-col sm:flex-row items-center gap-5 sm:gap-10 pt-16 py-12">
   


<div class="flex-none w-20 h-20 rounded-full overflow-hidden">
  <a href="http://localhost:1313/">
    <img
      srcset="/img/profile-picture_hu4241499301404582006.jpg 80w"
      src="/img/profile-picture.jpg"
      width="386"
      height="345"
      alt="Nick Fisher&#39;s tech blog"
    />
  </a>
</div>

  
  <div class="flex flex-col gap-5">
    <a href="http://localhost:1313/">
  <h1 id="site-title">Nick Fisher&#39;s tech blog</h1>
</a>
 
    <nav>
  <ul>
     
    
    <li>
      <a href="/" class="">
        Home
      </a>
    </li>
    
    <li>
      <a href="/blog" class="">
        Blog
      </a>
    </li>
    
    <li>
      <a href="/about" class="">
        About me
      </a>
    </li>
    
    <li>
      <a href="/categories" class="">
        Categories
      </a>
    </li>
    
    <li>
      <a href="/tags" class="">
        Tags
      </a>
    </li>
    
  </ul>
</nav>

  </div>
</header>

      <button class="toggle-theme" aria-label="Toggle Theme" title="Toggle Theme" onclick="toggleTheme()">
  <span class="theme-icon light"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M12 3v2.25m6.364.386l-1.591 1.591M21 12h-2.25m-.386 6.364l-1.591-1.591M12 18.75V21m-4.773-4.227l-1.591 1.591M5.25 12H3m4.227-4.773L5.636 5.636M15.75 12a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0z" />
</svg> </span>
  <span class="theme-icon dark"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" d="M21.752 15.002A9.718 9.718 0 0118 15.75c-5.385 0-9.75-4.365-9.75-9.75 0-1.33.266-2.597.748-3.752A9.753 9.753 0 003 11.25C3 16.635 7.365 21 12.75 21a9.753 9.753 0 009.002-5.998z" />
</svg> </span>
</button>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const theme = localStorage.getItem('theme');

    if (!theme || theme === 'light') {
      setTheme('light');
    } else {
      setTheme(theme);
    }
  });

  function setTheme(theme) {
    const html = document.querySelector('html');
    localStorage.setItem('theme', theme);

    if (theme === 'light') {
      if (html.classList.contains('dark')) {
        document.querySelector('html').classList.remove('dark');
      }

      document.querySelector('.theme-icon.light').style.display = 'none';
      document.querySelector('.theme-icon.dark').style.display = 'block';
    } else {
      if (!html.classList.contains('dark')) {
        document.querySelector('html').classList.add('dark');
      }

      document.querySelector('.theme-icon.dark').style.display = 'none';
      document.querySelector('.theme-icon.light').style.display = 'block';
    }
  }

  function toggleTheme() {
    const theme = localStorage.getItem('theme');

    if (theme === 'light') {
      setTheme('dark');
    } else {
      setTheme('light');
    }
  }
</script>
    </div>
  
    <main id="content">

<article class="flex flex-col gap-10">
  <header class="flex flex-col gap-2">
    <h2 class="title-large">Working with String Types in Redis using Lettuce and Webflux</h2>

    <div class="meta">
      
      <time datetime="2021-04-11 19:01:16 &#43;0000 UTC" title='Sun, Apr 11, 2021, 7:01 PM UTC'>
        11/04/2021 - Estimated reading time: 4 minutes
      </time>

       
      
    </div>
  </header>

  

  <section><p>The source code for what follows <a href="https://github.com/nfisher23/reactive-programming-webflux">can be found on Github</a>.</p>
<p>There are, as of this writing, <a href="https://redis.io/commands/#string">27 different string operations available in the redis API</a>. Lettuce appears to have interfaces that directly support all of them.</p>
<p>This article will walk you through some of the more common commands and how to use them against a redis instance.</p>
<h3 id="setting-up-the-test-suite">Setting up the Test Suite</h3>
<p>We're going to build off of previous work where we <a href="https://nickolasfisher.com/blog/How-to-use-a-Redis-Test-Container-with-LettuceSpring-Boot-Webflux">set up a redis test container to test lettuce</a>, and assuming you have cloned that project and are following along with the right dependencies, I will make a new test class that for now just creates the test container, configured a redis client against that container, and flushes [removes in redis lingo] all the data from redis after each test method runs:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>@Testcontainers
</span></span><span style="display:flex;"><span><span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">class</span> <span style="color:#50fa7b">StringTypesTest</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @Container
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd;font-style:italic">static</span> GenericContainer genericContainer <span style="color:#ff79c6">=</span> <span style="color:#ff79c6">new</span> GenericContainer(
</span></span><span style="display:flex;"><span>            DockerImageName.<span style="color:#50fa7b">parse</span>(<span style="color:#ff79c6">&amp;</span>#34;redis:5.<span style="color:#50fa7b">0</span>.<span style="color:#50fa7b">3</span><span style="color:#ff79c6">-</span>alpine<span style="color:#ff79c6">&amp;</span>#34;)
</span></span><span style="display:flex;"><span>    ).<span style="color:#50fa7b">withExposedPorts</span>(6379);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">private</span> RedisClient redisClient;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @BeforeEach
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">setupRedisClient</span>() {
</span></span><span style="display:flex;"><span>        redisClient <span style="color:#ff79c6">=</span> RedisClient.<span style="color:#50fa7b">create</span>(<span style="color:#ff79c6">&amp;</span>#34;redis:<span style="color:#6272a4">//&amp;#34; &amp;#43; genericContainer.getHost() &amp;#43; &amp;#34;:&amp;#34; &amp;#43; genericContainer.getMappedPort(6379));</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    @AfterEach
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">removeAllDataFromRedis</span>() {
</span></span><span style="display:flex;"><span>        redisClient.<span style="color:#50fa7b">connect</span>().<span style="color:#50fa7b">reactive</span>().<span style="color:#50fa7b">flushall</span>().<span style="color:#50fa7b">block</span>();
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>With this in place, we can begin hacking away.</p>
<h3 id="set-get-and-additional-arguments">Set, Get, and Additional Arguments</h3>
<p>This is straightforward:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    @Test
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">setAndGet</span>() {
</span></span><span style="display:flex;"><span>        RedisReactiveCommands<span style="color:#ff79c6">&amp;</span>lt;String, String<span style="color:#ff79c6">&amp;</span>gt; redisReactiveCommands <span style="color:#ff79c6">=</span> redisClient.<span style="color:#50fa7b">connect</span>().<span style="color:#50fa7b">reactive</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// vanilla get and set</span>
</span></span><span style="display:flex;"><span>        StepVerifier.<span style="color:#50fa7b">create</span>(redisReactiveCommands.<span style="color:#50fa7b">set</span>(<span style="color:#ff79c6">&amp;</span>#34;some<span style="color:#ff79c6">-</span>key<span style="color:#ff79c6">-</span>1<span style="color:#ff79c6">&amp;</span>#34;, <span style="color:#ff79c6">&amp;</span>#34;some<span style="color:#ff79c6">-</span>value<span style="color:#ff79c6">-</span>1<span style="color:#ff79c6">&amp;</span>#34;))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">expectNextMatches</span>(response <span style="color:#ff79c6">-&amp;</span>gt; <span style="color:#ff79c6">&amp;</span>#34;OK<span style="color:#ff79c6">&amp;</span>#34;.<span style="color:#50fa7b">equals</span>(response)).<span style="color:#50fa7b">verifyComplete</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        StepVerifier.<span style="color:#50fa7b">create</span>(redisReactiveCommands.<span style="color:#50fa7b">get</span>(<span style="color:#ff79c6">&amp;</span>#34;some<span style="color:#ff79c6">-</span>key<span style="color:#ff79c6">-</span>1<span style="color:#ff79c6">&amp;</span>#34;))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">expectNextMatches</span>(response <span style="color:#ff79c6">-&amp;</span>gt; <span style="color:#ff79c6">&amp;</span>#34;some<span style="color:#ff79c6">-</span>value<span style="color:#ff79c6">-</span>1<span style="color:#ff79c6">&amp;</span>#34;.<span style="color:#50fa7b">equals</span>(response))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">verifyComplete</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// adding an additional argument like nx will cause it to return nothing if it doesn&amp;#39;t get set</span>
</span></span><span style="display:flex;"><span>        StepVerifier.<span style="color:#50fa7b">create</span>(redisReactiveCommands.<span style="color:#50fa7b">set</span>(<span style="color:#ff79c6">&amp;</span>#34;some<span style="color:#ff79c6">-</span>key<span style="color:#ff79c6">-</span>1<span style="color:#ff79c6">&amp;</span>#34;, <span style="color:#ff79c6">&amp;</span>#34;some<span style="color:#ff79c6">-</span>value<span style="color:#ff79c6">-</span>2<span style="color:#ff79c6">&amp;</span>#34;, <span style="color:#ff79c6">new</span> SetArgs().<span style="color:#50fa7b">nx</span>()))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">verifyComplete</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// prove the value is the same</span>
</span></span><span style="display:flex;"><span>        StepVerifier.<span style="color:#50fa7b">create</span>(redisReactiveCommands.<span style="color:#50fa7b">get</span>(<span style="color:#ff79c6">&amp;</span>#34;some<span style="color:#ff79c6">-</span>key<span style="color:#ff79c6">-</span>1<span style="color:#ff79c6">&amp;</span>#34;))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">expectNextMatches</span>(response <span style="color:#ff79c6">-&amp;</span>gt; <span style="color:#ff79c6">&amp;</span>#34;some<span style="color:#ff79c6">-</span>value<span style="color:#ff79c6">-</span>1<span style="color:#ff79c6">&amp;</span>#34;.<span style="color:#50fa7b">equals</span>(response))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">verifyComplete</span>();
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>We set <strong>some-key-1</strong> to have <strong>some-value-1</strong>, and verify it's there. We then use the NX argument, which only sets the value if it doesn't exist. We then verify that, because the key was just set, it is not overwritten, by getting it again and asserting the value</p>
<h3 id="set-nx-and-set-ex">Set NX and Set EX</h3>
<p>If we don't like that interface of adding an additional argument for set nx, set ex, etc., then lettuce does provide a slightly more intuitive interface:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    @Test
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">setNx</span>() <span style="color:#8be9fd;font-style:italic">throws</span> Exception {
</span></span><span style="display:flex;"><span>        RedisReactiveCommands<span style="color:#ff79c6">&amp;</span>lt;String, String<span style="color:#ff79c6">&amp;</span>gt; redisReactiveCommands <span style="color:#ff79c6">=</span> redisClient.<span style="color:#50fa7b">connect</span>().<span style="color:#50fa7b">reactive</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        StepVerifier.<span style="color:#50fa7b">create</span>(redisReactiveCommands.<span style="color:#50fa7b">setnx</span>(<span style="color:#ff79c6">&amp;</span>#34;key<span style="color:#ff79c6">-</span>1<span style="color:#ff79c6">&amp;</span>#34;, <span style="color:#ff79c6">&amp;</span>#34;value<span style="color:#ff79c6">-</span>1<span style="color:#ff79c6">&amp;</span>#34;))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">expectNextMatches</span>(success <span style="color:#ff79c6">-&amp;</span>gt; success)
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">verifyComplete</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        StepVerifier.<span style="color:#50fa7b">create</span>(redisReactiveCommands.<span style="color:#50fa7b">setnx</span>(<span style="color:#ff79c6">&amp;</span>#34;key<span style="color:#ff79c6">-</span>1<span style="color:#ff79c6">&amp;</span>#34;, <span style="color:#ff79c6">&amp;</span>#34;value<span style="color:#ff79c6">-</span>2<span style="color:#ff79c6">&amp;</span>#34;))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">expectNextMatches</span>(success <span style="color:#ff79c6">-&amp;</span>gt; <span style="color:#ff79c6">!</span>success)
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">verifyComplete</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        StepVerifier.<span style="color:#50fa7b">create</span>(redisReactiveCommands.<span style="color:#50fa7b">setex</span>(<span style="color:#ff79c6">&amp;</span>#34;key<span style="color:#ff79c6">-</span>1<span style="color:#ff79c6">&amp;</span>#34;, 1, <span style="color:#ff79c6">&amp;</span>#34;value<span style="color:#ff79c6">-</span>1<span style="color:#ff79c6">&amp;</span>#34;))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">expectNextMatches</span>(response <span style="color:#ff79c6">-&amp;</span>gt; <span style="color:#ff79c6">&amp;</span>#34;OK<span style="color:#ff79c6">&amp;</span>#34;.<span style="color:#50fa7b">equals</span>(response))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">verifyComplete</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6272a4">// key-1 expires in 1 second</span>
</span></span><span style="display:flex;"><span>        Thread.<span style="color:#50fa7b">sleep</span>(1500);
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        StepVerifier.<span style="color:#50fa7b">create</span>(redisReactiveCommands.<span style="color:#50fa7b">get</span>(<span style="color:#ff79c6">&amp;</span>#34;key<span style="color:#ff79c6">-</span>1<span style="color:#ff79c6">&amp;</span>#34;))
</span></span><span style="display:flex;"><span>                <span style="color:#6272a4">// no value</span>
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">verifyComplete</span>();
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>We show that trying to set a value that already exists with the nx option fails, and that setting a value with the ex option will indeed expire it within the specified period of time.</p>
<h3 id="append">Append</h3>
<p><strong>append</strong> will append a string to an existing string, then return the length of the existing string:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    @Test
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">append</span>() {
</span></span><span style="display:flex;"><span>        RedisReactiveCommands<span style="color:#ff79c6">&amp;</span>lt;String, String<span style="color:#ff79c6">&amp;</span>gt; redisReactiveCommands <span style="color:#ff79c6">=</span> redisClient.<span style="color:#50fa7b">connect</span>().<span style="color:#50fa7b">reactive</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        StepVerifier.<span style="color:#50fa7b">create</span>(redisReactiveCommands.<span style="color:#50fa7b">set</span>(<span style="color:#ff79c6">&amp;</span>#34;key<span style="color:#ff79c6">-</span>10<span style="color:#ff79c6">&amp;</span>#34;, <span style="color:#ff79c6">&amp;</span>#34;value<span style="color:#ff79c6">-</span>10<span style="color:#ff79c6">&amp;</span>#34;))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">expectNextMatches</span>(response <span style="color:#ff79c6">-&amp;</span>gt; <span style="color:#ff79c6">&amp;</span>#34;OK<span style="color:#ff79c6">&amp;</span>#34;.<span style="color:#50fa7b">equals</span>(response))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">verifyComplete</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        StepVerifier.<span style="color:#50fa7b">create</span>(redisReactiveCommands.<span style="color:#50fa7b">append</span>(<span style="color:#ff79c6">&amp;</span>#34;key<span style="color:#ff79c6">-</span>10<span style="color:#ff79c6">&amp;</span>#34;, <span style="color:#ff79c6">&amp;</span>#34;<span style="color:#ff79c6">-</span>more<span style="color:#ff79c6">-</span>stuff<span style="color:#ff79c6">&amp;</span>#34;))
</span></span><span style="display:flex;"><span>                <span style="color:#6272a4">// length of new value is returned</span>
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">expectNextMatches</span>(response <span style="color:#ff79c6">-&amp;</span>gt; 19L <span style="color:#ff79c6">==</span> response)
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">verifyComplete</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        StepVerifier.<span style="color:#50fa7b">create</span>(redisReactiveCommands.<span style="color:#50fa7b">get</span>(<span style="color:#ff79c6">&amp;</span>#34;key<span style="color:#ff79c6">-</span>10<span style="color:#ff79c6">&amp;</span>#34;))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">expectNextMatches</span>(response <span style="color:#ff79c6">-&amp;</span>gt;
</span></span><span style="display:flex;"><span>                        <span style="color:#ff79c6">&amp;</span>#34;value<span style="color:#ff79c6">-</span>10<span style="color:#ff79c6">-</span>more<span style="color:#ff79c6">-</span>stuff<span style="color:#ff79c6">&amp;</span>#34;.<span style="color:#50fa7b">equals</span>(response))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">verifyComplete</span>();
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>We set a key to work with, then append <strong>-more-stuff</strong> to the value, then assert that we get the right length returned and finally make sure the new value looks correct.</p>
<h3 id="incrby">IncrBy</h3>
<p><strong>incrby</strong> increments the value associated with that key by the specified amount. So if the value is 7 and we <strong>incrby</strong> 8, we should get 15:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    @Test
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">incrBy</span>() {
</span></span><span style="display:flex;"><span>        RedisReactiveCommands<span style="color:#ff79c6">&amp;</span>lt;String, String<span style="color:#ff79c6">&amp;</span>gt; redisReactiveCommands <span style="color:#ff79c6">=</span> redisClient.<span style="color:#50fa7b">connect</span>().<span style="color:#50fa7b">reactive</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        StepVerifier.<span style="color:#50fa7b">create</span>(redisReactiveCommands.<span style="color:#50fa7b">set</span>(<span style="color:#ff79c6">&amp;</span>#34;key<span style="color:#ff79c6">-</span>counter<span style="color:#ff79c6">&amp;</span>#34;, <span style="color:#ff79c6">&amp;</span>#34;7<span style="color:#ff79c6">&amp;</span>#34;))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">expectNextMatches</span>(response <span style="color:#ff79c6">-&amp;</span>gt; <span style="color:#ff79c6">&amp;</span>#34;OK<span style="color:#ff79c6">&amp;</span>#34;.<span style="color:#50fa7b">equals</span>(response))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">verifyComplete</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        StepVerifier.<span style="color:#50fa7b">create</span>(redisReactiveCommands.<span style="color:#50fa7b">incrby</span>(<span style="color:#ff79c6">&amp;</span>#34;key<span style="color:#ff79c6">-</span>counter<span style="color:#ff79c6">&amp;</span>#34;, 8L))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">expectNextMatches</span>(val <span style="color:#ff79c6">-&amp;</span>gt; 15 <span style="color:#ff79c6">==</span> val)
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">verifyComplete</span>();
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>Here, we assert exactly that, 7 + 8 is indeed 15 and it is returned to us by redis.</p>
<h3 id="mget-and-mset">MGET and MSET</h3>
<p><strong>mset</strong> and <strong>mget</strong> are just the multiples version of <strong>get</strong> and <strong>set</strong>. If we <strong>mset</strong> then we are setting multiple keys at once. If we <strong>mget</strong> then we are getting multiple values from the keys at once:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-java" data-lang="java"><span style="display:flex;"><span>    @Test
</span></span><span style="display:flex;"><span>    <span style="color:#8be9fd;font-style:italic">public</span> <span style="color:#8be9fd">void</span> <span style="color:#50fa7b">mget</span>() {
</span></span><span style="display:flex;"><span>        RedisReactiveCommands<span style="color:#ff79c6">&amp;</span>lt;String, String<span style="color:#ff79c6">&amp;</span>gt; redisReactiveCommands <span style="color:#ff79c6">=</span> redisClient.<span style="color:#50fa7b">connect</span>().<span style="color:#50fa7b">reactive</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        StepVerifier.<span style="color:#50fa7b">create</span>(redisReactiveCommands.<span style="color:#50fa7b">mset</span>(Map.<span style="color:#50fa7b">of</span>(
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">&amp;</span>#34;key<span style="color:#ff79c6">-</span>1<span style="color:#ff79c6">&amp;</span>#34;, <span style="color:#ff79c6">&amp;</span>#34;val<span style="color:#ff79c6">-</span>1<span style="color:#ff79c6">&amp;</span>#34;,
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">&amp;</span>#34;key<span style="color:#ff79c6">-</span>2<span style="color:#ff79c6">&amp;</span>#34;, <span style="color:#ff79c6">&amp;</span>#34;val<span style="color:#ff79c6">-</span>2<span style="color:#ff79c6">&amp;</span>#34;,
</span></span><span style="display:flex;"><span>                <span style="color:#ff79c6">&amp;</span>#34;key<span style="color:#ff79c6">-</span>3<span style="color:#ff79c6">&amp;</span>#34;, <span style="color:#ff79c6">&amp;</span>#34;val<span style="color:#ff79c6">-</span>3<span style="color:#ff79c6">&amp;</span>#34;
</span></span><span style="display:flex;"><span>        )))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">expectNextMatches</span>(response <span style="color:#ff79c6">-&amp;</span>gt; <span style="color:#ff79c6">&amp;</span>#34;OK<span style="color:#ff79c6">&amp;</span>#34;.<span style="color:#50fa7b">equals</span>(response))
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">verifyComplete</span>();
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        Flux<span style="color:#ff79c6">&amp;</span>lt;KeyValue<span style="color:#ff79c6">&amp;</span>lt;String, String<span style="color:#ff79c6">&amp;</span>gt;<span style="color:#ff79c6">&amp;</span>gt; mgetValuesFlux <span style="color:#ff79c6">=</span> redisReactiveCommands.<span style="color:#50fa7b">mget</span>(<span style="color:#ff79c6">&amp;</span>#34;key<span style="color:#ff79c6">-</span>1<span style="color:#ff79c6">&amp;</span>#34;, <span style="color:#ff79c6">&amp;</span>#34;key<span style="color:#ff79c6">-</span>2<span style="color:#ff79c6">&amp;</span>#34;, <span style="color:#ff79c6">&amp;</span>#34;key<span style="color:#ff79c6">-</span>3<span style="color:#ff79c6">&amp;</span>#34;);
</span></span><span style="display:flex;"><span>        StepVerifier.<span style="color:#50fa7b">create</span>(mgetValuesFlux.<span style="color:#50fa7b">collectList</span>())
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">expectNextMatches</span>(collectedValues <span style="color:#ff79c6">-&amp;</span>gt;
</span></span><span style="display:flex;"><span>                        collectedValues.<span style="color:#50fa7b">size</span>() <span style="color:#ff79c6">==</span> 3
</span></span><span style="display:flex;"><span>                            <span style="color:#ff79c6">&amp;</span>amp;<span style="color:#ff79c6">&amp;</span>amp; collectedValues.<span style="color:#50fa7b">stream</span>()
</span></span><span style="display:flex;"><span>                                .<span style="color:#50fa7b">anyMatch</span>(stringStringKeyValue <span style="color:#ff79c6">-&amp;</span>gt;
</span></span><span style="display:flex;"><span>                                        stringStringKeyValue.<span style="color:#50fa7b">getKey</span>().<span style="color:#50fa7b">equals</span>(<span style="color:#ff79c6">&amp;</span>#34;key<span style="color:#ff79c6">-</span>1<span style="color:#ff79c6">&amp;</span>#34;)
</span></span><span style="display:flex;"><span>                                                <span style="color:#ff79c6">&amp;</span>amp;<span style="color:#ff79c6">&amp;</span>amp; stringStringKeyValue.<span style="color:#50fa7b">getValue</span>().<span style="color:#50fa7b">equals</span>(<span style="color:#ff79c6">&amp;</span>#34;val<span style="color:#ff79c6">-</span>1<span style="color:#ff79c6">&amp;</span>#34;)
</span></span><span style="display:flex;"><span>                                )
</span></span><span style="display:flex;"><span>                )
</span></span><span style="display:flex;"><span>                .<span style="color:#50fa7b">verifyComplete</span>();
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>We set three keys and values in the same command using <strong>mset</strong>, then use <strong>mget</strong> to assert that we do in fact get three keys and values in response. The interface returns a flux, so to simplify it we just collect the flux into a mono containing a list of all the emitted items.</p>
<p>You can feel free to explore the previously linked other string commands that redis exposes via its API, but this should be a good start.</p>
</section>

  
    
  

    
  


  <footer>
    
  </footer>
</article>


    </main><footer class="pt-5 pb-10 grid gap-3 sm:grid-cols-2">
    <div class="text-xs font-semibold text-gray-500 order-2 sm:order-1">
  © 2018-2025 —
  <a href="http://localhost:1313/">Nick Fisher&#39;s tech blog</a> 
</div>

    <div class="order-1 sm:order-2">
  <ul class="flex sm:justify-end gap-5">
    
    
    <li>    
      <a href="https://www.linkedin.com/in/nick-fisher-software/" target="_blank" rel="noopener noreferrer">LinkedIn</a>
    </li>
    
    <li>    
      <a href="https://github.com/nfisher23" target="_blank" rel="noopener noreferrer">GitHub</a>
    </li>
    
    
  </ul>
</div>

</footer></body>
</html>
