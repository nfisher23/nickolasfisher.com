<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Lettuce on Nick Fisher's tech blog</title><link>https://www.nickolasfisher.com/tags/lettuce/</link><description>Recent content in Lettuce on Nick Fisher's tech blog</description><generator>Hugo</generator><language>en-US</language><copyright>2018-{year}</copyright><lastBuildDate>Sat, 01 May 2021 15:22:58 +0000</lastBuildDate><atom:link href="https://www.nickolasfisher.com/tags/lettuce/index.xml" rel="self" type="application/rss+xml"/><item><title>An Introduction to Redis Streams via Lettuce</title><link>https://www.nickolasfisher.com/blog/an-introduction-to-redis-streams-via-lettuce/</link><pubDate>Sat, 01 May 2021 15:22:58 +0000</pubDate><guid>https://www.nickolasfisher.com/blog/an-introduction-to-redis-streams-via-lettuce/</guid><description>&lt;p>The source code for this article &lt;a href="https://github.com/nfisher23/reactive-programming-webflux">can be found on Github&lt;/a>.&lt;/p>
&lt;p>&lt;a href="https://redis.io/topics/streams-intro">Redis streams&lt;/a> are an interesting data structure that act as a sort of go-between for list and pub/sub operations: It&amp;rsquo;s like &lt;a href="https://nickolasfisher.com/blog/Working-with-Lists-in-Redis-using-Lettuce-and-Webflux">a list&lt;/a> in the sense that anything pushed onto the stream is retained, it&amp;rsquo;s like &lt;a href="https://nickolasfisher.com/blog/How-to-Publish-and-Subscribe-to-Redis-Using-Lettuce">pub/sub&lt;/a> in the sense that multiple consumers can see what is happening to it. There are many other features of streams that are covered in that article, but that&amp;rsquo;s at least how you can think of it at the start.&lt;/p></description></item><item><title>Using Redis as a Distributed Lock with Lettuce</title><link>https://www.nickolasfisher.com/blog/using-redis-as-a-distributed-lock-with-lettuce/</link><pubDate>Sat, 01 May 2021 14:44:31 +0000</pubDate><guid>https://www.nickolasfisher.com/blog/using-redis-as-a-distributed-lock-with-lettuce/</guid><description>&lt;p>The source code for this article &lt;a href="https://github.com/nfisher23/reactive-programming-webflux">can be found on Github&lt;/a>.&lt;/p>
&lt;p>Using Redis as a best effort locking mechanism can be very useful in practice, to prevent two logical threads from clobbering each other. While redis locking is certainly not perfect, and &lt;a href="https://martin.kleppmann.com/2016/02/08/how-to-do-distributed-locking.html">you shouldn&amp;rsquo;t use redis locking if the underlying operation can&amp;rsquo;t be occasionally done twice&lt;/a>, it can still be useful for that &amp;ldquo;best effort, do this once&amp;rdquo; use case.&lt;/p></description></item><item><title>Subscribing to Channels in Clustered Redis With Lettuce</title><link>https://www.nickolasfisher.com/blog/subscribing-to-channels-in-clustered-redis-with-lettuce/</link><pubDate>Sun, 25 Apr 2021 18:43:42 +0000</pubDate><guid>https://www.nickolasfisher.com/blog/subscribing-to-channels-in-clustered-redis-with-lettuce/</guid><description>&lt;p>We already know &lt;a href="https://nickolasfisher.com/blog/Subscribing-to-Redis-Channels-with-Java-Spring-Boot-and-Lettuce">how to subscribe to redis using lettuce&lt;/a> when it&amp;rsquo;s not running in clustered mode. If it&amp;rsquo;s running in clustered mode, it&amp;rsquo;s not terribly different, but I did discover one thing that is interesting, which is the subject of this article.&lt;/p></description></item><item><title>Pre Loading Lua Scripts into Clustered Redis with Lettuce</title><link>https://www.nickolasfisher.com/blog/pre-loading-lua-scripts-into-clustered-redis-with-lettuce/</link><pubDate>Sun, 25 Apr 2021 17:37:07 +0000</pubDate><guid>https://www.nickolasfisher.com/blog/pre-loading-lua-scripts-into-clustered-redis-with-lettuce/</guid><description>&lt;p>The source code for what follows &lt;a href="https://github.com/nfisher23/reactive-programming-webflux">can be found on github&lt;/a>.&lt;/p>
&lt;p>In a previous article, we showed how to &lt;a href="https://nickolasfisher.com/blog/Pre-Loading-a-Lua-Script-into-Redis-With-Lettuce">efficiently execute a lua script in redis using lettuce&lt;/a>. To really scale our caching solution horizontally [and elegantly deal with many scaling headaches], we will also want to make sure we can execute our lua scripts against clustered redis, which as we&amp;rsquo;ll see here is pretty straightforward.&lt;/p></description></item><item><title>Optimistic Locking in Redis with Reactive Lettuce</title><link>https://www.nickolasfisher.com/blog/optimistic-locking-in-redis-with-reactive-lettuce/</link><pubDate>Sat, 24 Apr 2021 21:32:36 +0000</pubDate><guid>https://www.nickolasfisher.com/blog/optimistic-locking-in-redis-with-reactive-lettuce/</guid><description>&lt;p>The source code for what follows &lt;a href="https://github.com/nfisher23/reactive-programming-webflux">can be found on Github&lt;/a>.&lt;/p>
&lt;p>Optimistic Locking in Redis is one of the only reasons to want to use transactions, in my opinion. You can ensure a grouping of atomic operations only occur if a watched key does not change out from underneath you. On the CLI, this might start with:&lt;/p></description></item><item><title>Redis Transactions, Reactive Lettuce: Buyer Beware</title><link>https://www.nickolasfisher.com/blog/redis-transactions-reactive-lettuce-buyer-beware/</link><pubDate>Sat, 24 Apr 2021 20:48:04 +0000</pubDate><guid>https://www.nickolasfisher.com/blog/redis-transactions-reactive-lettuce-buyer-beware/</guid><description>&lt;p>The source code for what follows &lt;a href="https://github.com/nfisher23/reactive-programming-webflux">can be found on Github&lt;/a>.&lt;/p>
&lt;p>Redis Transactions do not operate exactly the way you would expect if you&amp;rsquo;re coming from a relational database management system like MySQL or postrgres. It&amp;rsquo;s mostly useful for optimistic locking, but honestly there are better ways to accomplish many of the things you&amp;rsquo;re probably trying to, like &lt;a href="https://nickolasfisher.com/blog/How-to-Run-a-Lua-Script-against-Redis-using-Lettuce">running a lua script with arguments&lt;/a> [which is guaranteed to be atomic]. The &lt;a href="https://redis.io/topics/transactions">documentation on transactions in redis&lt;/a> describes some of the caveats, the biggest one probably being that it does not support rollbacks, only commits or discards.&lt;/p></description></item><item><title>Subscribing to Redis Channels with Java, Spring Boot, and Lettuce</title><link>https://www.nickolasfisher.com/blog/subscribing-to-redis-channels-with-java-spring-boot-and-lettuce/</link><pubDate>Sat, 24 Apr 2021 20:05:52 +0000</pubDate><guid>https://www.nickolasfisher.com/blog/subscribing-to-redis-channels-with-java-spring-boot-and-lettuce/</guid><description>&lt;p>The source code for what follows &lt;a href="https://github.com/nfisher23/reactive-programming-webflux">can be found on Github&lt;/a>.&lt;/p>
&lt;p>Pub/Sub in redis allows a publisher to send things to subscribers without knowing who is actually subscribed. In a previous post, we covered &lt;a href="https://nickolasfisher.com/blog/How-to-Publish-and-Subscribe-to-Redis-Using-Lettuce">a simple unit test for publishing and subscribing to lettuce&lt;/a>, but if you want to have a subscription initialized on application startup, and respond to events, we&amp;rsquo;ll have to do a bit more, which I&amp;rsquo;ll demonstrate here.&lt;/p></description></item><item><title>Pre Loading a Lua Script into Redis With Lettuce</title><link>https://www.nickolasfisher.com/blog/pre-loading-a-lua-script-into-redis-with-lettuce/</link><pubDate>Sat, 24 Apr 2021 18:05:29 +0000</pubDate><guid>https://www.nickolasfisher.com/blog/pre-loading-a-lua-script-into-redis-with-lettuce/</guid><description>&lt;p>The source code for what follows &lt;a href="https://github.com/nfisher23/reactive-programming-webflux">can be found on Github&lt;/a>.&lt;/p>
&lt;p>In my last article on &lt;a href="https://nickolasfisher.com/blog/How-to-Run-a-Lua-Script-against-Redis-using-Lettuce">running a lua script against redis with lettuce&lt;/a>, we just sent the entire script [that redis will execute atomically] along with the arguments every time. For very small scripts this is unlikely to be a problem, but there is definitely a more efficient way to do this, using &lt;a href="https://redis.io/commands/evalsha">EVALSHA&lt;/a>.&lt;/p></description></item><item><title>How to Run a Lua Script against Redis using Lettuce</title><link>https://www.nickolasfisher.com/blog/how-to-run-a-lua-script-against-redis-using-lettuce/</link><pubDate>Sat, 24 Apr 2021 16:55:51 +0000</pubDate><guid>https://www.nickolasfisher.com/blog/how-to-run-a-lua-script-against-redis-using-lettuce/</guid><description>&lt;p>The source code for what follows &lt;a href="https://github.com/nfisher23/reactive-programming-webflux">can be found on Github&lt;/a>.&lt;/p>
&lt;p>Running a lua script against redis is done using &lt;a href="https://redis.io/commands/eval">EVAL&lt;/a>. The primary benefit of using a lua script is that the entire script is guaranteed to be run at once, and nothing else will interfere with it [it&amp;rsquo;s atomic]. This allows for operating on multiple keys, or check-then-set type operations on the same key.&lt;/p></description></item><item><title>How to Publish and Subscribe to Redis Using Lettuce</title><link>https://www.nickolasfisher.com/blog/how-to-publish-and-subscribe-to-redis-using-lettuce/</link><pubDate>Sat, 24 Apr 2021 16:37:18 +0000</pubDate><guid>https://www.nickolasfisher.com/blog/how-to-publish-and-subscribe-to-redis-using-lettuce/</guid><description>&lt;p>The source code for what follows &lt;a href="https://github.com/nfisher23/reactive-programming-webflux">can be found on Github&lt;/a>.&lt;/p>
&lt;p>Subscribing to topics in redis allows for a &lt;em>fanout&lt;/em> behavior, where any number of subscribers can be notified of a message from a publisher.&lt;/p></description></item><item><title>Expiring Individual Elements in a Redis Set</title><link>https://www.nickolasfisher.com/blog/expiring-individual-elements-in-a-redis-set/</link><pubDate>Sun, 18 Apr 2021 20:13:11 +0000</pubDate><guid>https://www.nickolasfisher.com/blog/expiring-individual-elements-in-a-redis-set/</guid><description>&lt;p>The source code for what follows &lt;a href="https://github.com/nfisher23/reactive-programming-webflux">can be found on Github&lt;/a>.&lt;/p>
&lt;p>Redis does not allow you to set the expiration on individual members in a set, it only allows you to set an expiration on the entire set itself. If you want to have a sort of expiry on individual elements in a set, this article shares a workaround to that problem that works well in practice. Because I have already written a lot of &lt;a href="https://nickolasfisher.com/blog/How-to-use-Embedded-Redis-to-Test-a-Lettuce-Client-in-Spring-Boot-Webflux">boilerplate code for testing any redis operation using lettuce&lt;/a>, I&amp;rsquo;m going to be showing you this technique using a reactive lettuce client, however the basic concept should transfer easily to any other client.&lt;/p></description></item><item><title>Lettuce, MSETNX, and Clustered Redis</title><link>https://www.nickolasfisher.com/blog/lettuce-msetnx-and-clustered-redis/</link><pubDate>Sat, 17 Apr 2021 09:35:41 +0000</pubDate><guid>https://www.nickolasfisher.com/blog/lettuce-msetnx-and-clustered-redis/</guid><description>&lt;p>The source code for what follows &lt;a href="https://github.com/nfisher23/reactive-programming-webflux">can be found on Github&lt;/a>.&lt;/p>
&lt;p>&lt;a href="https://redis.io/commands/msetnx">MSETNX&lt;/a> when you&amp;rsquo;re working with a single redis primary node is simple enough to understand: it sets all of the key/value pairs, or none at all. If one of the keys already exists in the cluster, then all of them are rejected.&lt;/p></description></item><item><title>A Guide to Operating on Sorted Sets in Redis with Lettuce</title><link>https://www.nickolasfisher.com/blog/a-guide-to-operating-on-sorted-sets-in-redis-with-lettuce/</link><pubDate>Sat, 17 Apr 2021 08:15:31 +0000</pubDate><guid>https://www.nickolasfisher.com/blog/a-guide-to-operating-on-sorted-sets-in-redis-with-lettuce/</guid><description>&lt;p>Sorted Sets in redis are one of my personal favorite tools when operating at scale. As of this writing, &lt;a href="https://redis.io/commands/#sorted_set">there are over 30 unique operations you can perform against sorted sets in redis&lt;/a>. This article will focus on some of the more common ones you&amp;rsquo;re going to need to know, and it will use a reactive lettuce client to demonstrate them.&lt;/p></description></item><item><title>A Guide to Operating on Multiple Sets in Redis with Lettuce</title><link>https://www.nickolasfisher.com/blog/a-guide-to-operating-on-multiple-sets-in-redis-with-lettuce/</link><pubDate>Sat, 17 Apr 2021 08:12:31 +0000</pubDate><guid>https://www.nickolasfisher.com/blog/a-guide-to-operating-on-multiple-sets-in-redis-with-lettuce/</guid><description>&lt;p>In the last article, we showed how to do some of the most common single set operations against redis, this article will focus on operating on multiple sets using a lettuce client against redis. Specifically, we&amp;rsquo;ll focus on subtracting, intersecting, and adding sets. The source code for what follows &lt;a href="https://github.com/nfisher23/reactive-programming-webflux">can be found on Github&lt;/a>.&lt;/p></description></item><item><title>A Guide to Simple Set Operations in Redis with Lettuce</title><link>https://www.nickolasfisher.com/blog/a-guide-to-simple-set-operations-in-redis-with-lettuce/</link><pubDate>Sat, 17 Apr 2021 08:09:37 +0000</pubDate><guid>https://www.nickolasfisher.com/blog/a-guide-to-simple-set-operations-in-redis-with-lettuce/</guid><description>&lt;p>There are, as of this writing, about &lt;a href="https://redis.io/commands/#set">15 distinct operations available to someone wanting to work with sets in redis&lt;/a>. This article seeks to cover some of the more basic ones using a reactive lettuce client, and &lt;a href="https://nickolasfisher.com/blog/A-Guide-to-Operating-on-Multiple-Sets-in-Redis-with-Lettuce">a follow up article&lt;/a> will seek to deal with explaining some of the more common operations against multiple sets, rather than a single set in this case.&lt;/p></description></item><item><title>Working with Redis Hashes using Lettuce And Webflux</title><link>https://www.nickolasfisher.com/blog/working-with-redis-hashes-using-lettuce-and-webflux/</link><pubDate>Sun, 11 Apr 2021 22:26:29 +0000</pubDate><guid>https://www.nickolasfisher.com/blog/working-with-redis-hashes-using-lettuce-and-webflux/</guid><description>&lt;p>There are about &lt;a href="https://redis.io/commands/#hash">15 or so commands you can execute against redis for hash types&lt;/a> as of this writing. This article will demonstrate some of the more common operations you&amp;rsquo;re likely to need when using lettuce as your client.&lt;/p></description></item><item><title>Working with Lists in Redis using Lettuce and Webflux</title><link>https://www.nickolasfisher.com/blog/working-with-lists-in-redis-using-lettuce-and-webflux/</link><pubDate>Sun, 11 Apr 2021 21:14:08 +0000</pubDate><guid>https://www.nickolasfisher.com/blog/working-with-lists-in-redis-using-lettuce-and-webflux/</guid><description>&lt;p>As of this writing, there are a solid &lt;a href="https://redis.io/commands/#list">twenty or so commands you can execute against redis for the list data type&lt;/a>. This article will be walking through some of the more common operations you are likely to need when interacting with redis and lists using lettuce, and &lt;a href="https://github.com/nfisher23/reactive-programming-webflux">the source code can be found on Github&lt;/a>.&lt;/p></description></item><item><title>Working with String Types in Redis using Lettuce and Webflux</title><link>https://www.nickolasfisher.com/blog/working-with-string-types-in-redis-using-lettuce-and-webflux/</link><pubDate>Sun, 11 Apr 2021 19:01:16 +0000</pubDate><guid>https://www.nickolasfisher.com/blog/working-with-string-types-in-redis-using-lettuce-and-webflux/</guid><description>&lt;p>The source code for what follows &lt;a href="https://github.com/nfisher23/reactive-programming-webflux">can be found on Github&lt;/a>.&lt;/p>
&lt;p>There are, as of this writing, &lt;a href="https://redis.io/commands/#string">27 different string operations available in the redis API&lt;/a>. Lettuce appears to have interfaces that directly support all of them.&lt;/p></description></item><item><title>Using Hashtags in Clustered Redis with Lettuce and Webflux</title><link>https://www.nickolasfisher.com/blog/using-hashtags-in-clustered-redis-with-lettuce-and-webflux/</link><pubDate>Sun, 11 Apr 2021 16:12:09 +0000</pubDate><guid>https://www.nickolasfisher.com/blog/using-hashtags-in-clustered-redis-with-lettuce-and-webflux/</guid><description>&lt;p>In clustered redis, any non hash tagged key can be sent unpredictably [well, actually predictably, if you know the formula] to any given primary node in the cluster. The very basic way it works is:&lt;/p></description></item><item><title>Breaking down Lettuce MSET Commands in Clustered Redis</title><link>https://www.nickolasfisher.com/blog/breaking-down-lettuce-mset-commands-in-clustered-redis/</link><pubDate>Sat, 10 Apr 2021 23:26:07 +0000</pubDate><guid>https://www.nickolasfisher.com/blog/breaking-down-lettuce-mset-commands-in-clustered-redis/</guid><description>&lt;p>To follow along with this post, it would be best if you have already &lt;a href="https://nickolasfisher.com/blog/Bootstrap-a-Local-Sharded-Redis-Cluster-in-Five-Minutes">set up your local redis cluster&lt;/a> and know how to &lt;a href="https://nickolasfisher.com/blog/Configuring-Lettuce-to-work-with-Clustered-Redis">connect to a redis cluster and interact with it via Lettuce&lt;/a>. And the source code for what follows &lt;a href="https://github.com/nfisher23/reactive-programming-webflux">can be found on Github&lt;/a>.&lt;/p></description></item><item><title>Configuring Lettuce/Webflux to work with Clustered Redis</title><link>https://www.nickolasfisher.com/blog/configuring-lettucewebflux-to-work-with-clustered-redis/</link><pubDate>Sat, 10 Apr 2021 22:27:54 +0000</pubDate><guid>https://www.nickolasfisher.com/blog/configuring-lettucewebflux-to-work-with-clustered-redis/</guid><description>&lt;p>Lettuce has some pretty nice out of the box support for working with clustered redis. This combination&amp;ndash;a reactive client and application along with clustered redis&amp;ndash;is about as scalable, performant, and resilient as things can get in distributed systems [though there are other tradeoffs which are not the subject of this post].&lt;/p></description></item><item><title>How to Configure Lettuce to use Redis Read Replicas in Spring Boot Webflux</title><link>https://www.nickolasfisher.com/blog/how-to-configure-lettuce-to-use-redis-read-replicas-in-spring-boot-webflux/</link><pubDate>Sun, 28 Mar 2021 19:22:27 +0000</pubDate><guid>https://www.nickolasfisher.com/blog/how-to-configure-lettuce-to-use-redis-read-replicas-in-spring-boot-webflux/</guid><description>&lt;p>The source code for this post &lt;a href="https://github.com/nfisher23/reactive-programming-webflux">can be found on Github&lt;/a>.&lt;/p>
&lt;p>Lettuce supports reading from redis replicas, but with the caveat that it doesn&amp;rsquo;t [out of the box] provide you with the fine-grained control over &lt;em>when&lt;/em> to read from the replicas that you&amp;rsquo;re likely to want.&lt;/p></description></item><item><title>How to Configure Lettuce to connect to a local Redis Instance with Webflux</title><link>https://www.nickolasfisher.com/blog/how-to-configure-lettuce-to-connect-to-a-local-redis-instance-with-webflux/</link><pubDate>Sun, 28 Mar 2021 17:49:16 +0000</pubDate><guid>https://www.nickolasfisher.com/blog/how-to-configure-lettuce-to-connect-to-a-local-redis-instance-with-webflux/</guid><description>&lt;p>The source code for this post &lt;a href="https://github.com/nfisher23/reactive-programming-webflux/tree/master/reactive-redis">can be found on Github&lt;/a>.&lt;/p>
&lt;p>In a previous post, we detailed &lt;a href="https://nickolasfisher.com/blog/How-to-use-a-Redis-Test-Container-with-LettuceSpring-Boot-Webflux">how to write integration tests for lettuce clients in spring boot webflux&lt;/a> using a redis test container. That&amp;rsquo;s fine and well when you&amp;rsquo;re just writing code for a quick feedback loop, but is useless when it comes to running the application in real life. This post will start up redis locally and then explain how to best connect to it using lettuce in webflux.&lt;/p></description></item><item><title>How to use a Redis Test Container with Lettuce/Spring Boot Webflux</title><link>https://www.nickolasfisher.com/blog/how-to-use-a-redis-test-container-with-lettucespring-boot-webflux/</link><pubDate>Sat, 27 Mar 2021 23:52:07 +0000</pubDate><guid>https://www.nickolasfisher.com/blog/how-to-use-a-redis-test-container-with-lettucespring-boot-webflux/</guid><description>&lt;p>The source code for this post &lt;a href="https://github.com/nfisher23/reactive-programming-webflux/tree/master/reactive-redis">can be found on Github&lt;/a>.&lt;/p>
&lt;p>Another way to write integration tests for code that verifies your interactions with redis actually make sense is to use a &lt;a href="https://www.testcontainers.org/">test container&lt;/a>. This framework assumes you have docker up and running, but if you do it will pull a specified container image [typically you&amp;rsquo;ll just use docker hub, though it&amp;rsquo;s important to note that they rate limit you, so don&amp;rsquo;t go overboard], then you can interact with that container in your integration tests.&lt;/p></description></item></channel></rss>